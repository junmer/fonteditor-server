define("ttf/util/contour2svg",["require"],function(){function e(e){if(!e.length)return"";for(var t,i,n,r=[],o=0,a=e.length;a>o;o++){if(t=e[o],i=0===o?e[a-1]:e[o-1],n=o===a-1?e[0]:e[o+1],0===o)if(t.onCurve)r.push("M"+t.x+" "+t.y);else if(i.onCurve)r.push("M"+i.x+" "+i.y);else r.push("M"+(i.x+t.x)/2+" "+(i.y+t.y)/2);if(t.onCurve&&n.onCurve)r.push("L"+n.x+" "+n.y);else if(!t.onCurve)if(n.onCurve)r.push("Q"+t.x+" "+t.y+" "+n.x+" "+n.y);else r.push("Q"+t.x+" "+t.y+" "+(t.x+n.x)/2+" "+(t.y+n.y)/2)}return r.push("Z"),r.join(" ")}return e}),define("ttf/util/contours2svg",["require","./contour2svg"],function(require){function e(e){if(!e.length)return"";else return e.map(function(e){return t(e)}).join("")}var t=require("./contour2svg");return e}),define("graphics/transform",["require"],function(){function e(e,t,i,n,r,o,a){for(var s,u,f,h=0,c=e.length;c>h;h++)f=e[h],s=f.x,u=f.y,f.x=s*t+u*n+o,f.y=s*i+u*r+a;return e}return e}),define("common/lang",["require"],function(){function e(e){var t=[].slice.call(arguments,1);return function(){var i=t.concat([].slice.call(arguments));return e.apply(this,i)}}function t(e){return function(){return Function.call.apply(e,arguments)}}function i(e,t){var i=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,i.concat(Array.prototype.slice.call(arguments)))}}function n(e,t){var i=function(){};i.prototype=t.prototype;var n=e.prototype,r=e.prototype=new i;return Object.keys(n).forEach(function(e){r[e]=n[e]}),e.prototype.constructor=e,e}function r(e,t){for(var i=1,n=arguments.length;n>i;i++)if(t=arguments[i]){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]}else;return e}function o(e,t,i){if(!t)return e;else return i=i||Object.keys(t),i.forEach(function(i){if(e.hasOwnProperty(i))if(e[i]&&"object"==typeof e[i]&&t[i]&&"object"==typeof t[i])o(e[i],t[i]);else e[i]=t[i]}),e}function a(e){if(!e||"object"!=typeof e)return e;var t=e;if(f.isArray(e))t=e.slice().map(a);else if(f.isObject(e)&&"isPrototypeOf"in e){t={};for(var i in e)if(c.call(e,i))t[i]=a(e[i])}return t}function s(e,t){var i,n,r,o,a=0,s=function(){a=new Date,r=null,o=e.apply(i,n)};return function(){var u=new Date,f=t-(u-a);if(i=this,n=arguments,0>=f)clearTimeout(r),r=null,a=u,o=e.apply(i,n);else if(!r)r=setTimeout(s,f);return o}}function u(e,t,i){var n,r;return function(){var o=this,a=arguments,s=function(){if(n=null,!i)r=e.apply(o,a)},u=i&&!n;if(clearTimeout(n),n=setTimeout(s,t),u)r=e.apply(o,a);return r}}var f={},h=h||Object.prototype.toString;["String","Array","Function","Date","Object"].forEach(function(e){f["is"+e]=function(t){return null!=t&&h.call(t).slice(8,-1)===e}});var c=Object.prototype.hasOwnProperty,exports={extend:r,overwrite:o,bind:i,inherits:n,curry:e,uncurry:t,clone:a,throttle:s,debounce:u};return r(exports,f),exports}),define("ttf/util/glyf2svg",["require","./contour2svg","./contours2svg","graphics/transform","common/lang"],function(require){function e(e,o){if(!e)return"";var a=[];if(!e.compound){if(e.contours&&e.contours.length)a.push(i(e.contours))}else{var s=e.glyfs;s.forEach(function(e){var i=o.glyf[e.glyphIndex];if(i)for(var s=r.clone(i.contours),u=e.transform,f=0,h=s.length;h>f;f++)n(s[f],u.a,u.b,u.c,u.d,u.e,u.f),a.push(t(s[f]))})}return a.join(" ")}var t=require("./contour2svg"),i=require("./contours2svg"),n=require("graphics/transform"),r=require("common/lang");return e}),define("common/string",["require"],function(){var e={decodeHTML:function(e){var t=String(e).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return t.replace(/&#([\d]+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},encodeHTML:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},getLength:function(e){return String(e).replace(/[^\x00-\xff]/g,"11").length},cut:function(e,t,i){i=i||"",e=String(e);for(var n=0,r=e.length,o=0;r>o;o++)if(n+=e.charCodeAt(o)>255?2:1,n>t)return e.slice(0,o)+i;return e+i},format:function(e,t){return e.replace(/\$\{([\w.]+)\}/g,function(e,i){for(var n,r=i.split("."),o=t;null!=o&&(n=r.shift());)o=o[n];return null!=o?o:""})},pad:function(e,t,i){if(e=String(e),e.length>t)return e.slice(e.length-t);else return new Array(t-e.length+1).join(i||"0")+e},hashcode:function(e){if(!e)return 0;for(var t=0,i=0,n=e.length;n>i;i++)t=34359738367&31*t+e.charCodeAt(i);return t}};return e}),define("common/observable",["require","./lang"],function(require){var e=require("./lang").extend,t={on:function(e,t){if("function"==typeof e)t=e,e="*";this._listeners=this._listeners||{};var i=this._listeners[e]||[];if(i.indexOf(t)<0)t.$type=e,i.push(t);return this._listeners[e]=i,this},once:function(e,t){var i=function(i){t.call(this,i),this.un(e,t)};return this.on(e,i),this},un:function(e,t){if("function"==typeof e)t=e,e="*";else if("undefined"==typeof e)return delete this._listeners,this._listeners={},this;this._listeners=this._listeners||{};var i=this._listeners[e];if(i)if(t){var n=i.indexOf(t);if(~n)delete i[n]}else i.length=0,delete this._listeners[e];return this},fire:function(e,t){this._listeners=this._listeners||{};var i=this._listeners[e];if(i){var n=this;i.forEach(function(i){t=t||{},t.type=e,i.call(n,t)})}if("*"!==e)this.fire("*",t);return this}},i={mixin:function(i){if(void 0===i)return i;else return e(i,t)}};return i}),define("render/capture/Mouse",["require","common/lang","common/observable"],function(require){function e(e){return e.offsetX||e.layerX||e.clientX}function t(e){return e.offsetY||e.layerY||e.clientY}function i(i){return{x:e(i),y:t(i),which:i.which,ctrlKey:i.ctrlKey||i.metaKey,metaKey:i.metaKey,altKey:i.altKey,shiftKey:i.shiftKey,originEvent:i}}function n(e){if(e.stopPropagation(),e.preventDefault)e.preventDefault();else e.returnValue=!1}function r(e){if(!1!==this.events.mousedown){n(e);var t=i(e);if(this.startX=t.x,this.startY=t.y,this.startTime=Date.now(),this.isDown=!0,this.fire("down",t),3===e.which)this.fire("rightdown",t)}}function o(e){if(n(e),!1!==this.events.dblclick)this.fire("dblclick",i(e))}function a(e){if(!1!==this.events.mousemove){n(e);var t=i(e);if(this.fire("move",t),this.isDown&&!1!==this.events.drag){if(t.startX=this.startX,t.startY=this.startY,t.deltaX=t.x-this.startX,t.deltaY=t.y-this.startY,Math.abs(t.deltaX)>=this.dragDelta||Math.abs(t.deltaY)>=this.dragDelta)if(!this.isDragging)this.isDragging=!0,this.fire("dragstart",t);if(this.isDragging)this.fire("drag",t)}}}function s(e){if(!1!==this.events.mouseup){n(e);var t=i(e);if(t.time=Date.now()-this.startTime,this.fire("up",t),3===e.which)this.fire("rightup",t);if(this.isDown&&this.isDragging&&!1!==this.events.drag)t.deltaX=t.x-this.startX,t.deltaY=t.y-this.startY,this.isDragging=!1,this.fire("dragend",t);else if(this.isDown&&!this.isDragging&&!1!==this.events.click)this.isDragging=!1,this.fire("click",t);this.isDown=!1}}function u(e){if(!1!==this.events.mousewheel){n(e);var t=0;if(e.wheelDelta)t=e.wheelDelta/120;else if(e.detail)t=-e.detail/3;var r=i(e);r.delta=t,this.fire("wheel",r)}}function f(e){if(!1!==this.events.mouseover)n(e),this.fire("over")}function h(e){if(!1!==this.events.mouseout)n(e),this.fire("out")}function c(e,t){this.main=e,t=t||{},this.events=t.events||{},this.dragDelta=2,this.handlers={mousewheel:d.bind(u,this),mousemove:d.bind(a,this),mousedown:d.bind(r,this),dblclick:d.bind(o,this),mouseover:d.bind(f,this),mouseout:d.bind(h,this),mouseup:d.bind(s,this)},this.start()}var d=require("common/lang"),l=require("common/observable");return c.prototype={constructor:c,start:function(){if(!this.listening){this.listening=!0;var e=this.main;e.addEventListener("DOMMouseScroll",this.handlers.mousewheel,!1),e.addEventListener("mousewheel",this.handlers.mousewheel,!1),e.addEventListener("mousemove",this.handlers.mousemove,!1),e.addEventListener("mousedown",this.handlers.mousedown,!1),e.addEventListener("dblclick",this.handlers.dblclick,!1),e.addEventListener("mouseover",this.handlers.mouseover,!1),e.addEventListener("mouseout",this.handlers.mouseout,!1),document.addEventListener("mouseup",this.handlers.mouseup,!1)}return this},stop:function(){if(this.listening){this.listening=!1;var e=this.main;e.removeEventListener("DOMMouseScroll",this.handlers.mousewheel),e.removeEventListener("mousewheel",this.handlers.mousewheel),e.removeEventListener("mousemove",this.handlers.mousemove),e.removeEventListener("mousedown",this.handlers.mousedown),e.removeEventListener("click",this.handlers.click),e.removeEventListener("dblclick",this.handlers.dblclick),e.removeEventListener("mouseover",this.handlers.mouseover),e.removeEventListener("mouseout",this.handlers.mouseout),document.removeEventListener("mouseup",this.handlers.mouseup)}return this},isListening:function(){return!!this.listening},dispose:function(){this.stop(),this.un(),this.main=this.events=null}},l.mixin(c.prototype),c}),define("fonteditor/widget/glyfviewer",["require","ttf/util/glyf2svg","common/string","common/lang","render/capture/Mouse","common/observable"],function(require){function e(e,t,i){var n={index:i.index,compound:e.compound?"compound":"",selected:i.selected?"selected":"",editing:i.editing?"editing":"",modify:e.modify,unitsPerEm:i.unitsPerEm,descent:i.descent,unicode:(e.unicode||[]).map(function(e){return"$"+e.toString(16).toUpperCase()}).join(","),name:e.name,fillColor:i.color?'style="fill:'+i.color+'"':""},r="";if(r=h(e,t))n.d='d="'+r+'"';return c.format(p,n)}function t(t){var i=t.head.unitsPerEm,n=i+t.hhea.descent,r={},o=this.selectedList||[];o.forEach(function(e){r[e]=!0});var a="",s=this.options.color,u=this.getEditing(),f=this.page*this.options.pageSize,h=f+this.options.pageSize,c=t.glyf.slice(f,h);c.forEach(function(o,h){var c=f+h;a+=e(o,t,{index:c,unitsPerEm:i,descent:n,selected:r[c],editing:u===c,color:s})}),this.main.html(a)}function i(t,i){var n=t.head.unitsPerEm,r=n+t.hhea.descent,o={},a=this.selectedList||[];a.forEach(function(e){o[e]=!0});var s=this.main,u=this.options.color,f=this.getEditing();i.forEach(function(i){var a=e(t.glyf[i],t,{index:i,unitsPerEm:n,descent:r,selected:o[i],editing:f===i,color:u}),h=s.find('[data-index="'+i+'"]');if(h.length)$(a).insertBefore(h),h.remove()})}function n(e){e.stopPropagation();var t=$(e.target),i=t.attr("data-action"),n=t.parent("[data-index]"),r=+n.attr("data-index");if("del"===i){if(!window.confirm("确定删除字形么？"))return;n.remove();var o=this.selectedList.indexOf(r);if(o>=0)this.selectedList.splice(o,1)}else if("edit"===i)this.setEditing(r);this.fire(i,{list:[r]})}function r(e,t,i){if(!t&&!i)this.main.children().removeClass("selected");this.main.children().each(function(i,n){var r=$(n),o=r.offset(),a={x:o.left+r.width()/2,y:o.top+r.height()/2};if(a.x>=e.x&&a.x<=e.x+e.width&&a.y>=e.y&&a.y<=e.y+e.height)if(t)r.toggleClass("selected");else r.addClass("selected")}),this.fire("selection:change")}function o(e){var t=this;e.ctrlKey=e.ctrlKey||e.metaKey;var i;if(t.listening)if(65===e.keyCode&&e.ctrlKey)t.main.children().addClass("selected"),t.fire("selection:change");else if(90===e.keyCode&&e.ctrlKey)e.stopPropagation(),t.fire("undo");else if(89===e.keyCode&&e.ctrlKey)e.stopPropagation(),t.fire("redo");else if(27===e.keyCode)e.stopPropagation(),t.clearSelected(),t.clearEditing(),t.fire("selection:change");else if(37===e.keyCode)t.fire("moveleft");else if(39===e.keyCode)t.fire("moveright");else if(46===e.keyCode||88===e.keyCode&&e.ctrlKey){if(e.stopPropagation(),i=t.getSelected(),i.length){t.clearSelected();var n=i.indexOf(t.getEditing());if(n>=0)t.clearEditing();t.fire("selection:change"),t.fire(46===e.keyCode?"del":"cut",{list:i})}}else if(67===e.keyCode&&e.ctrlKey)if(i=t.getSelected(),i.length)t.fire("copy",{list:i})}function a(){var e=this;e.main.on("click","[data-index]",function(){$(this).toggleClass("selected"),e.fire("selection:change")}).on("click","[data-action]",d.bind(n,this)),e.downlistener=d.bind(o,this),e.capture=new l(e.main.get(0),{events:{dblclick:!1,mousewheel:!1,mouseover:!1,mouseout:!1}}),e.capture.on("dragstart",function(t){$("#selection-range").show(),e.main.addClass("no-hover"),e.startX=t.originEvent.pageX,e.startY=t.originEvent.pageY});var t=function(t){var i=t.originEvent.pageX,n=t.originEvent.pageY;$("#selection-range").css({left:Math.min(e.startX,i),top:Math.min(e.startY,n),width:Math.abs(e.startX-i),height:Math.abs(e.startY-n)})};e.capture.on("drag",t),e.capture.on("dragend",function(t){$("#selection-range").hide(),e.main.removeClass("no-hover");var i=t.originEvent.pageX,n=t.originEvent.pageY,o=Math.abs(e.startX-i),a=Math.abs(e.startY-n);if(!(20>o&&20>a))r.call(e,{x:Math.min(e.startX,i),y:Math.min(e.startY,n),width:o,height:a},t.ctrlKey,t.shiftKey)})}function s(){var e=[];return this.main.find(".selected").each(function(t,i){e.push(+i.getAttribute("data-index"))}),e}function u(){var e=this.commandMenu,t=this;t.on("selection:change",d.debounce(function(){var i=s.call(t);if(t.selectedList=i,i.length)e.enableCommands(["copy","cut","del"]),e[1===i.length?"enableCommands":"disableCommands"](["setting-font"]);else e.disableCommands(["copy","cut","del","setting-font"])},100));var i=d.debounce(function(){t.focus()},20);e.on("command",function(e){var n=e.command;if("paste"===n||"adjust-pos"===n||"adjust-glyf"===n)t.fire(n);else{var r=t.getSelected();if("cut"===n||"del"===n)t.clearSelected();t.fire(n,{list:r})}i()})}function f(e,t){if(this.options=d.extend({color:"",shapeSize:"normal",pageSize:100},t),this.main=$(e),this.mode="list",this.page=0,this.selectedList=[],a.call(this),this.options.commandMenu)this.commandMenu=this.options.commandMenu,delete this.options.commandMenu,u.call(this)}var h=require("ttf/util/glyf2svg"),c=require("common/string"),d=require("common/lang"),l=require("render/capture/Mouse"),p='<div data-index="${index}" class="glyf-item ${compound} ${modify} ${selected} ${editing}"><i data-action="edit" class="ico i-edit" title="编辑"></i><i data-action="del" class="ico i-del" title="删除"></i><svg class="glyf" viewbox="0 0 ${unitsPerEm} ${unitsPerEm}"><g transform="scale(1, -1) translate(0, -${descent}) scale(0.95, 0.95) "><path class="path" ${fillColor} ${d}/></g></svg><div data-field="unicode" class="unicode" title="${unicode}">${unicode}</div><div data-field="name" class="name" title="${name}">${name}</div></div>';return f.prototype.focus=function(){if(!this.listening)this.listening=!0,document.body.addEventListener("keydown",this.downlistener)},f.prototype.blur=function(){if(this.listening)this.listening=!1,document.body.removeEventListener("keydown",this.downlistener)},f.prototype.setPage=function(e){this.page=e||0},f.prototype.getPage=function(){return this.page},f.prototype.show=function(e,i){if(i)this.setSelected(i);t.call(this,e),this.fire("selection:change")},f.prototype.refresh=function(e,n){if(!n||0===n.length)t.call(this,e);else i.call(this,e,n)},f.prototype.setSelected=function(e){this.selectedList=e||[]},f.prototype.getSelected=function(){return this.selectedList},f.prototype.clearSelected=function(){this.main.children().removeClass("selected"),this.selectedList=[]},f.prototype.getEditing=function(){return this.editingIndex>=0?this.editingIndex:-1},f.prototype.setEditing=function(e){if(this.clearEditing(),this.editingIndex=e>=0?e:-1,-1!==e)this.main.find('[data-index="'+e+'"]').addClass("editing")},f.prototype.clearEditing=function(){this.main.find(".editing").removeClass("editing"),this.editingIndex=-1},f.prototype.setSetting=function(e){var t=this.options;if(e.shapeSize!==t.shapeSize)this.main.removeClass(t.shapeSize),this.main.addClass(e.shapeSize);var i=!1;if(e.color!==t.color)i=!0;if(e.pageSize!==t.pageSize)i=!0;if(this.options=d.overwrite(t,e),i)this.fire("refresh")},f.prototype.getSetting=function(){return this.options},f.prototype.setMode=function(e){if(this.mode=e||"list",this.commandMenu)this.commandMenu["list"===this.mode?"show":"hide"]()},require("common/observable").mixin(f.prototype),f}),define("render/util/guid",["require"],function(){function e(e){return(e||"render")+"-"+t++}var t=0;return e}),define("graphics/pathIterator",["require"],function(){function e(e,t){for(var i,n,r,o,a=0,s=e.length;s>a;a++){if(i=e[a],n=0===a?e[s-1]:e[a-1],r=a===s-1?e[0]:e[a+1],0===a)if(i.onCurve)o=i;else if(n.onCurve)o=n;else o={x:(n.x+i.x)/2,y:(n.y+i.y)/2};if(i.onCurve&&r.onCurve){if(!1===t("L",i,r,0,a))break;o=r}else if(!i.onCurve)if(r.onCurve){if(!1===t("Q",o,i,r,a))break;o=r}else{var u={x:(i.x+r.x)/2,y:(i.y+r.y)/2};if(!1===t("Q",o,i,u,a))break;o=u}}}return e}),define("graphics/computeBoundingBox",["require","./pathIterator"],function(require){function e(e){if(0===e.length)return!1;for(var t=e[0].x,i=e[0].x,n=e[0].y,r=e[0].y,o=1;o<e.length;o++){var a=e[o];if(a.x<t)t=a.x;if(a.x>i)i=a.x;if(a.y<n)n=a.y;if(a.y>r)r=a.y}return{x:t,y:n,width:i-t,height:r-n}}function t(t,i,n){var r,o=t.x+n.x-2*i.x;if(0===o)r=.5;else r=(t.x-i.x)/o;o=t.y+n.y-2*i.y;var a;if(0===o)a=.5;else a=(t.y-i.y)/o;r=Math.max(Math.min(r,1),0),a=Math.max(Math.min(a,1),0);var s=1-r,u=1-a,f=s*s*t.x+2*s*r*i.x+r*r*n.x,h=s*s*t.y+2*s*r*i.y+r*r*n.y,c=u*u*t.x+2*u*a*i.x+a*a*n.x,d=u*u*t.y+2*u*a*i.y+a*a*n.y;return e([t,n,{x:f,y:h},{x:c,y:d}])}function i(i){var n=[],o=function(e,i,r,o){if("L"===e)n.push(i),n.push(r);else if("Q"===e){var a=t(i,r,o);n.push(a),n.push({x:a.x+a.width,y:a.y+a.height})}};if(1===arguments.length)r(i,function(e,i,r,o){if("L"===e)n.push(i),n.push(r);else if("Q"===e){var a=t(i,r,o);n.push(a),n.push({x:a.x+a.width,y:a.y+a.height})}});else for(var a=0,s=arguments.length;s>a;a++)r(arguments[a],o);return e(n)}function n(t){var i=[];if(1===arguments.length)i=t;else for(var n=0,r=arguments.length;r>n;n++)Array.prototype.splice.apply(i,[i.length,0].concat(arguments[n]));return e(i)}var r=require("./pathIterator");return{computeBounding:e,quadraticBezier:t,computePath:i,computePathBox:n}}),define("render/Layer",["require","./util/guid","common/lang","graphics/computeBoundingBox"],function(require){function e(e){return e=e||{},e.id=e.id||n("shape"),e.type=e.type||"circle",e.layerId=this.id,e}function t(e,t){e.fillStyle=t.fillColor||"black",e.strokeStyle=t.strokeColor||"black",e.lineWidth=t.lineWidth||1,e.font=t.font||"normal 10px arial"}function i(e,t){this.context=e,this.options=r.extend({stroke:!0,fill:!0,thin:!0},t),this.painter=this.options.painter,this.id=this.options.id||n("layer"),this.level=this.options.level,this.shapes=[],this.disabled=!1}var n=require("./util/guid"),r=require("common/lang"),o=require("graphics/computeBoundingBox");return i.prototype={constructor:i,refresh:function(){var e=this.painter.support,i=this.context,n=this.options,r=this.painter.camera;if(i.clearRect(0,0,this.painter.width,this.painter.height),t(i,n),!1!==n.thin)i.translate(-.5,-.5);i.beginPath();for(var o,a,s=this.shapes,u=0,f=s.length;f>u;u++)if(o=s[u],!0!==o.disabled){if(a=e[o.type]){if(1!==r.ratio)a.adjust(o,r);if(o.style){if(!1!==n.fill)i.fill();if(!1!==n.stroke)i.stroke();if(i.beginPath(),t(i,o.style),a.draw(i,o,r),!1!==n.fill||o.style.fill)i.fill();if(!1!==n.stroke||o.style.stroke)i.stroke();t(i,n),i.beginPath()}else a.draw(i,o,r)}}else;if(!1!==n.fill)i.fill();if(!1!==n.stroke)i.stroke();if(!1!==n.thin)i.translate(.5,.5);return this},getShape:function(e){if("string"==typeof e)return this.shapes.filter(function(t){return t.id===e})[0];else if("number"==typeof e)return this.shapes[e];else if("object"==typeof e)return e},addShape:function(t,i){if("string"==typeof t)return i=i||{},i.type=t,t=e.call(this,i),this.shapes.push(t),t;else if("object"==typeof t)return this.shapes.push(t),t;throw"add shape faild"},removeShape:function(e){var t=-1;if("object"==typeof e)t=this.shapes.indexOf(e);else if("string"==typeof e){for(var i=0,n=this.shapes.length;n>i;i++)if(e===this.shapes[i].id){t=i;break}}else if("number"==typeof e)t=e;else throw"need shape id to be removed";if(t>=0&&t<this.shapes.length)return this.shapes.splice(t,1),!0;else return!1},clearShapes:function(){return this.shapes.length=0,this.shapes=[],this},getShapeIn:function(e){for(var t=this.painter.support,i=this.shapes,n=[],r=0,o=i.length;o>r;r++)if(!1!==i[r].selectable&&t[i[r].type].isIn(i[r],e.x,e.y))n.push(i[r]);return n.length?n:!1},adjust:function(e){var t=[];if(e)e=this.getShape(e),t.push(e);else t=this.shapes;for(var i,n=this.painter.support,r=this.painter.camera,o=0,a=t.length;a>o;o++)if(e=t[o],i=n[e.type])if(1!==r.ratio)i.adjust(e,r);return this},move:function(e,t,i){var n=[];if(i)i=this.getShape(i),n.push(i);else n=this.shapes;for(var r,o=this.painter.support,a=0,s=n.length;s>a;a++)if(i=n[a],r=o[i.type])r.move(i,e,t);return this},moveTo:function(e,t,i){var n=[];if(i)i=this.getShape(i),n.push(i);else n=this.shapes;var r,o=this.painter.support,a=this.getBound(n);if(a)for(var s=e-(a.x+a.width/2),u=t-(a.y+a.height/2),f=0,h=n.length;h>f;f++)if(i=n[f],r=o[i.type])r.move(i,s,u);return this},getBound:function(e){if(e=e||this.shapes,0===e.length)return!1;for(var t,i,n=[],r=this.painter.support,a=0,s=e.length;s>a;a++)if(t=e[a],i=r[t.type])if(void 0!==t.x&&void 0!==t.y)n.push(t);else{var u=i.getRect(t);if(u)n.push(u),n.push({x:u.x+u.width,y:u.y+u.height})}return o.computeBounding(n)},createShape:function(t){return e.call(this,t)},dispose:function(){this.main=this.painter=this.context=this.options=null,this.shapes.length=0,this.shapes=null}},i}),define("render/shape/Shape",["require","common/lang"],function(require){function e(e){e=e||{}}function t(e){return i.clone(e)}var i=require("common/lang");return e.prototype={constructor:e,adjust:function(e,t){var i=t.center,n=t.ratio;if("number"==typeof e.x)e.x=n*(e.x-i.x)+i.x;if("number"==typeof e.y)e.y=n*(e.y-i.y)+i.y;if("number"==typeof e.width)e.width=n*e.width;if("number"==typeof e.width)e.height=n*e.height;if("number"==typeof e.r)e.r=n*e.r;return e},move:function(e,t,i){if("number"==typeof e.x)e.x+=t;if("number"==typeof e.y)e.y+=i;return e},getRect:function(){return!1},isIn:function(){return!1},draw:function(){},dispose:function(){}},e.derive=function(t){function n(){e.apply(this,arguments)}return n.constructor=e,i.extend(n.prototype,e.prototype,t),n},e.clone=t,e}),define("render/shape/Circle",["require","./Shape"],function(require){var e={type:"circle",getRect:function(e){return{x:e.x-e.r,y:e.y-e.r,width:2*e.r,height:2*e.r}},isIn:function(e,t,i){return Math.pow(e.x-t,2)+Math.pow(e.y-i,2)<=Math.pow(e.r,2)},draw:function(e,t){e.moveTo(t.x+t.r,t.y),e.arc(t.x,t.y,t.r,0,2*Math.PI,!0)}};return require("./Shape").derive(e)}),define("render/shape/CirclePoint",["require","./Shape"],function(require){var e=2,t={type:"cpoint",getRect:function(t){var i=t.size||e;return{x:t.x-i,y:t.y-i,width:2*i,height:2*i}},isIn:function(t,i,n){var r=t.size||e;return Math.pow(t.x-i,2)+Math.pow(t.y-n,2)<=Math.pow(2*r,2)},draw:function(t,i){var n=i.size||e,r=Math.round(i.x),o=Math.round(i.y);t.moveTo(r+n,o),t.arc(r,o,n,0,2*Math.PI,!0)}};return require("./Shape").derive(t)}),define("render/shape/Point",["require","./Shape"],function(require){var e=6,t={type:"point",getRect:function(t){var i=t.size||e;return{x:t.x-i/2,y:t.y-i/2,width:i,height:i}},isIn:function(t,i,n){var r=t.size||e,o=r,a=r;return i<=t.x+o&&i>=t.x-o&&n<=t.y+a&&n>=t.y-a},draw:function(t,i){var n=Math.round(i.x),r=Math.round(i.y),o=i.size||e,a=o/2,s=o/2;t.moveTo(n-a,r-s),t.lineTo(n+a,r-s),t.lineTo(n+a,r+s),t.lineTo(n-a,r+s),t.lineTo(n-a,r-s)}};return require("./Shape").derive(t)}),define("render/util/dashedLineTo",["require"],function(){function e(e,t,i,n,r,o){o="number"!=typeof o?2:o;var a=n-t,s=r-i,u=Math.floor(Math.sqrt(a*a+s*s)/o);a/=u,s/=u;for(var f=!0,h=0;u>h;++h){if(f)e.moveTo(t,i);else e.lineTo(t,i);f=!f,t+=a,i+=s}e.lineTo(n,r)}return e}),define("render/shape/Rect",["require","../util/dashedLineTo","./Shape"],function(require){var e=require("../util/dashedLineTo"),t={type:"rect",getRect:function(e){return e},isIn:function(e,t,i){var n=e.width,r=e.height;return t<=e.x+n&&t>=e.x&&i<=e.y+r&&i>=e.y},draw:function(t,i){var n=Math.round(i.x),r=Math.round(i.y),o=Math.round(i.width),a=Math.round(i.height);if(i.dashed)e(t,n,r,n+o,r),e(t,n+o,r,n+o,r+a),e(t,n+o,r+a,n,r+a),e(t,n,r+a,n,r);else t.moveTo(n,r),t.lineTo(n+o,r),t.lineTo(n+o,r+a),t.lineTo(n,r+a),t.lineTo(n,r)}};return require("./Shape").derive(t)}),define("graphics/pathAdjust",["require"],function(){function e(e,t,i,n,r){t=void 0===t?1:t,i=void 0===i?1:i;for(var o,a=n||0,s=r||0,u=0,f=e.length;f>u;u++)o=e[u],o.x=t*(o.x+a),o.y=i*(o.y+s);return e}return e}),define("graphics/util",["require"],function(){function e(e){var t=e.x;if(Math.abs(Math.round(t)-t)<2e-5)e.x=Math.round(t);else e.x=Math.round(1e5*e.x)/1e5;if(t=e.y,Math.abs(Math.round(t)-t)<5e-5)e.y=Math.round(t);else e.y=Math.round(1e5*e.y)/1e5;return e}function t(e){if(Math.abs(Math.round(e)-e)<2e-5)return Math.round(e);else return Math.round(1e5*e)/1e5}function i(e,i,n){if(n)return t(i.x)<=t(e.x+e.width)&&t(i.x)>=t(e.x)&&t(i.y)<=t(e.y+e.height)&&t(i.y)>=t(e.y);else return i.x<=e.x+e.width&&i.x>=e.x&&i.y<=e.y+e.height&&i.y>=e.y}return{ceil:t,ceilPoint:e,isPointInBound:i}}),define("graphics/isBoundingBoxCross",["require","./util"],function(require){function e(e,i){var n=t(i,e,!0),r=t(i,{x:e.x+e.width,y:e.y},!0),o=t(i,{x:e.x,y:e.y+e.height},!0),a=t(i,{x:e.x+e.width,y:e.y+e.height},!0);if(n&&r&&o&&a)return 2;var s=t(e,i,!0),u=t(e,{x:i.x+i.width,y:i.y},!0),f=t(e,{x:i.x,y:i.y+i.height},!0),h=t(e,{x:i.x+i.width,y:i.y+i.height},!0);if(s&&u&&f&&h)return 3;if(!1===(n||r||o||a||s||u||f||h))if(e.x>i.x&&e.x<i.x+i.width||e.y>i.y&&e.y<i.y+i.height)return 1;else return!1;return 1}var t=require("./util").isPointInBound;return e}),define("graphics/matrix",["require"],function(){function e(e,t){return e.map(function(e){return e*t})}function t(e,t){return e.map(function(e,i){return e-t[i]})}function i(e,t){return e.map(function(e,i){return e+t[i]})}return{multi:e,minus:t,plus:i}}),define("graphics/isSegmentCross",["require","./isBoundingBoxCross","./util","./matrix"],function(require){function e(e,t,i,n,r){var o=[e,t,i,n].sort(function(e,t){return e[r]<t[r]?-1:1}),a=[];if(o[0][r]===o[1][r])a.push(o[0]),a.push(o[2]);else if(o[2][r]===o[3][r])a.push(o[1]),a.push(o[3]);else if(a.push(o[1]),o[1][r]!==o[2][r])a.push(o[2]);return a}function t(t,o,u,f){var h,c,d;if(o.x<t.x)h=o,o=t,t=h;if(f.x<u.x)h=f,f=u,u=h;var l={x:Math.min(t.x,o.x),y:Math.min(t.y,o.y),width:Math.abs(t.x-o.x),height:Math.abs(t.y-o.y)},p={x:Math.min(u.x,f.x),y:Math.min(u.y,f.y),width:Math.abs(u.x-f.x),height:Math.abs(u.y-f.y)};if(i(l,p)){var g=[o.y-t.y,-(o.x-t.x),t.y*(o.x-t.x)-t.x*(o.y-t.y)],m=[f.y-u.y,-(f.x-u.x),u.y*(f.x-u.x)-u.x*(f.y-u.y)];if(g[1]===m[1]&&0===g[1])if(o.x===f.x)return e(t,o,u,f,"y");else return!1;else if(g[0]===m[0]&&0===g[0])if(o.y===f.y)return e(t,o,u,f,"x");else return!1;else if(g[0]*m[1]===g[1]*m[0])if(g[1]*m[2]===g[2]*m[1])return e(t,o,u,f,"x");else return!1;var y=s(a(g,m[0]),a(m,g[0]));if(d=-y[2]/y[1],0!==g[0])c=-(g[2]+g[1]*d)/g[0];else c=-(m[2]+m[1]*d)/m[0];if(h=n({x:c,y:d}),r(l,h,!0)&&r(p,h,!0))return[h]}return!1}var i=require("./isBoundingBoxCross"),n=require("./util").ceilPoint,r=require("./util").isPointInBound,o=require("./matrix"),a=o.multi,s=o.minus;return t}),define("graphics/isSegmentRayCross",["require","./isSegmentCross"],function(require){function e(e,i,n){return t(e,i,n,{x:1e5,y:n.y})}var t=require("./isSegmentCross");return e}),define("graphics/isInsidePolygon",["require","./isSegmentRayCross"],function(require){function e(e,i){for(var n,r,o,a=0,s=0,u=e.length;u>s;s++)if(n=e[s],r=e[s===u-1?0:s+1],o=t(n,r,i)){if(o.y===i.y)return!0;a+=o.length}return!!(a%2)}var t=require("./isSegmentRayCross");return e}),define("render/shape/Polygon",["require","../util/dashedLineTo","graphics/pathAdjust","graphics/computeBoundingBox","graphics/isInsidePolygon","./Shape"],function(require){var e=require("../util/dashedLineTo"),t=require("graphics/pathAdjust"),i=require("graphics/computeBoundingBox"),n=require("graphics/isInsidePolygon"),r={type:"polygon",adjust:function(e,i){var n=i.ratio,r=i.center.x,o=i.center.y;t(e.points,n,n,-r,-o),t(e.points,1,1,r,o)},move:function(e,i,n){return t(e.points,1,1,i,n),e},getRect:function(e){return i.computeBounding(e.points)},isIn:function(e,t,r){var o=i.computeBounding(e.points);if(t<=o.x+o.width&&t>=o.x&&r<=o.y+o.height&&r>=o.y)return n(e.points,{x:t,y:r});else return!1},draw:function(t,i){var n=i.points;if(n&&!(n.length<2)){var r=0,o=n.length;if(i.dashed){for(;o-1>r;r++)e(t,Math.round(n[r].x),Math.round(n[r].y),Math.round(n[r+1].x),Math.round(n[r+1].y));e(t,Math.round(n[o-1].x),Math.round(n[o-1].y),Math.round(n[0].x),Math.round(n[0].y))}else{for(t.moveTo(Math.round(n[0].x),Math.round(n[0].y)),r=1;o>r;r++)t.lineTo(Math.round(n[r].x),Math.round(n[r].y));t.lineTo(Math.round(n[0].x),Math.round(n[0].y))}}}};return require("./Shape").derive(r)}),define("math/quadraticEquation",["require"],function(){function e(e,t,i){if(0===e)return[-i/t];var n,r;if(0===t){if(0===i)return[0];if(e>0&&0>i||0>e&&i>0)return r=Math.sqrt(-i/e),[r,-r];else return!1}if(0===i)return[0,-t/e];var o=Math.pow(t,2)-4*e*i;if(o>=0)if(n=(-t+Math.sqrt(o,2))/e/2,r=(-t-Math.sqrt(o,2))/e/2,n===r)return[n];else return[n,r];return!1}return e}),define("math/bezierQ2Equation",["require","./quadraticEquation"],function(require){function e(e,i,n){var r=t(e,i,n);if(!r)return r;var o=r.filter(function(e){return e>=0&&1>=e});return o.length?o:!1}var t=require("./quadraticEquation");return e}),define("graphics/isBezierLineCross",["require","../math/bezierQ2Equation","./util"],function(require){function e(e,n,r,o,a){var s;if(o.y===a.y)s=t(e.y+r.y-2*n.y,2*(n.y-e.y),e.y-o.y);else if(o.x===a.x)s=t(e.x+r.x-2*n.x,2*(n.x-e.x),e.x-o.x);else{var u=(a.y-o.y)/(a.x-o.x),f=o.y-u*o.x,h=e.x+r.x-2*n.x,c=2*(n.x-e.x),d=e.x,l=e.y+r.y-2*n.y,p=2*(n.y-e.y),g=e.y;s=t(u*h-l,u*c-p,u*d+f-g)}if(s)return s.map(function(t){return i({x:e.x*Math.pow(1-t,2)+2*n.x*t*(1-t)+r.x*Math.pow(t,2),y:e.y*Math.pow(1-t,2)+2*n.y*t*(1-t)+r.y*Math.pow(t,2)})});else return!1}var t=require("../math/bezierQ2Equation"),i=require("./util").ceilPoint;return e}),define("graphics/isBezierRayCross",["require","./isBezierLineCross"],function(require){function e(e,i,n,r){if(0===((e.y>r.y)+(i.y>r.y)+(n.y>r.y))%3)return!1;var o=t(e,i,n,r,{x:1e5,y:r.y});if(o){var a=o.filter(function(e){return e.x>=r.x});return a.length?a:!1}return!1}var t=require("./isBezierLineCross");return e}),define("graphics/isInsidePath",["require","./pathIterator","./isBezierRayCross","./isSegmentRayCross"],function(require){function e(e,r){var o,a=0;return t(e,function(e,t,s,u){if("L"===e){if(o=n(t,s,r)){if(2===o.length){if(r.x>=Math.min(o[0].x,o[1].x)&&r.x<=Math.max(o[0].x,o[1].x))return a=1,!1;return}if(o[0].x===r.x)return a=1,!1;if(s.y>t.y)a--;else a++}}else if("Q"===e){var f=null,h=null;if(o=i(t,s,u,r)){if(o[0].x===r.x||o[1]&&o[1].x===r.x)return a=1,!1;if(2===o.length)return;if(o=o[0],o.y>t.y&&o.y<s.y)f=t,h=s;else f=s,h=u;if(h.y>f.y)a--;else a++}}}),!!a}var t=require("./pathIterator"),i=require("./isBezierRayCross"),n=require("./isSegmentRayCross");return e}),define("render/util/drawPath",["require"],function(){function e(e,t){for(var i,n,r,o=0,a=t.length;a>o;o++){if(i=t[o],n=0===o?t[a-1]:t[o-1],r=o===a-1?t[0]:t[o+1],0===o)if(i.onCurve)e.moveTo(i.x,i.y);else if(n.onCurve)e.moveTo(n.x,n.y);else e.moveTo((n.x+i.x)/2,(n.y+i.y)/2);if(i.onCurve&&r.onCurve)e.lineTo(r.x,r.y);else if(!i.onCurve)if(r.onCurve)e.quadraticCurveTo(i.x,i.y,r.x,r.y);else e.quadraticCurveTo(i.x,i.y,(i.x+r.x)/2,(i.y+r.y)/2)}}return e}),define("render/shape/Font",["require","./Shape","../../graphics/isInsidePath","graphics/pathAdjust","../util/drawPath","graphics/computeBoundingBox"],function(require){var e=require("./Shape"),t=require("../../graphics/isInsidePath"),i=require("graphics/pathAdjust"),n=require("../util/drawPath"),r=require("graphics/computeBoundingBox"),o={type:"font",adjust:function(e,t){for(var n=t.ratio,r=t.center.x,o=t.center.y,a=e.contours,s=0,u=a.length;u>s;s++)i(a[s],n,n,-r,-o),i(a[s],1,1,r,o);return e},move:function(e,t,n){for(var r=e.contours,o=0,a=r.length;a>o;o++)i(r[o],1,1,t,n);return e},getRect:function(e){return r.computePath.apply(null,e.contours)},isIn:function(e,i,n){var o=r.computePath.apply(null,e.contours);
if(i<=o.x+o.width&&i>=o.x&&n<=o.y+o.height&&n>=o.y)for(var a=e.contours,s=0,u=a.length;u>s;s++)if(t(a[s],{x:i,y:n}))return!0;return!1},draw:function(e,t){for(var i=t.contours,r=0,o=i.length;o>r;r++)n(e,i[r])}};return e.derive(o)}),define("render/shape/Path",["require","../../graphics/isInsidePath","graphics/pathAdjust","../util/drawPath","graphics/computeBoundingBox","./Shape"],function(require){var e=require("../../graphics/isInsidePath"),t=require("graphics/pathAdjust"),i=require("../util/drawPath"),n=require("graphics/computeBoundingBox"),r={type:"path",adjust:function(e,i){var n=i.ratio,r=i.center.x,o=i.center.y;t(e.points,n,n,-r,-o),t(e.points,1,1,r,o)},move:function(e,i,n){return t(e.points,1,1,i,n),e},getRect:function(e){return n.computePath(e.points)},isIn:function(t,i,r){var o=n.computePath(t.points);if(i<=o.x+o.width&&i>=o.x&&r<=o.y+o.height&&r>=o.y)return e(t.points,{x:i,y:r});else return!1},draw:function(e,t){i(e,t.points)}};return require("./Shape").derive(r)}),define("render/util/drawAxis",["require","./dashedLineTo"],function(require){function e(e,i){var n,r=Math.round(i.gap),o=Math.round(e.canvas.width+r),a=Math.round(e.canvas.height+r),s=Math.round(i.x),u=Math.round(i.y);if(!1!==i.showGrid){for(e.beginPath(),e.strokeStyle=i.gapColor||"#A6A6FF",n=u;a>n;n+=r)e.moveTo(0,n),e.lineTo(o,n);for(n=u;n>0;n-=r)e.moveTo(0,n),e.lineTo(o,n);for(n=s;o>n;n+=r)e.moveTo(n,0),e.lineTo(n,a);for(n=s;n>0;n-=r)e.moveTo(n,0),e.lineTo(n,a);e.stroke()}e.beginPath(),e.strokeStyle=i.metricsColor||"red",e.moveTo(0,u),e.lineTo(o,u),e.moveTo(s,0),e.lineTo(s,a);var f=i.metrics,h=i.graduation.thickness||22,c=Object.keys(f);c.forEach(function(i){var n=u-Math.round(f[i]);t(e,0,n,o,n,4)}),e.save(),e.scale(.8,.8),c.forEach(function(t){e.fillText(t,1.25*h,1.25*(u-f[t])-2)}),e.fillText("Baseline",1.25*h,1.25*u-2),e.restore(),e.stroke(),e.stroke()}var t=require("./dashedLineTo");return e}),define("render/shape/Axis",["require","../util/drawAxis","./Shape"],function(require){var e=require("../util/drawAxis"),t={type:"axis",adjust:function(e,t){var i=t.center,n=t.ratio;e.unitsPerEm*=n;var r=e.metrics;return Object.keys(r).forEach(function(e){r[e]*=n}),e.x=n*(e.x-i.x)+i.x,e.y=n*(e.y-i.y)+i.y,e},isIn:function(){return!1},getBound:function(e){return{x:e.x,y:e.y,width:0,height:0}},draw:function(t,i,n){i.gap=(i.graduation.gap||100)*n.scale,t.save(),e(t,i),t.restore(),t.beginPath()}};return require("./Shape").derive(t)}),define("render/util/drawGraduation",["require"],function(){function e(e,t){var i=Math.round(t.x),n=Math.round(t.y),r=e.canvas.width,o=e.canvas.height,a=t.graduation.thickness||20,s=t.graduation.markHeight||3;e.beginPath(),e.fillStyle=t.graduation.markBackgroundColor||"#EEE",e.fillRect(0,0,r,a),e.fillRect(0,0,a,o),e.fill(),e.strokeStyle=t.graduation.markColor||"#000",e.moveTo(a,0),e.lineTo(a,o),e.moveTo(0,a),e.lineTo(r,a),e.stroke();var u,f,h,c,d,l=t.graduation.gap;if(l>=t.gap)u=l/t.gap,f=Math.floor(u)*l/20,h=l/20*Math.floor(u)/u;else{if(u=t.gap/l,f=Math.floor(l/20/u),f>=2)f=2*Math.floor(f/2);else f=1;h=f*u}for(e.fillStyle=e.strokeStyle,c=i,d=0;r>c;d++,c+=h)e.moveTo(c,a-(d%5?s:2*s)),e.lineTo(c,a);for(c=i,d=0;c>a;d++,c-=h)e.moveTo(c,a-(d%5?s:2*s)),e.lineTo(c,a);var p=0;for(c=n,d=0;c>a;d++,c-=h)e.moveTo(a-(d%5?s:2*s),c),e.lineTo(a,c);for(c=n,d=0;o>c;d++,c+=h)e.moveTo(a-(d%5?s:2*s),c),e.lineTo(a,c);for(e.save(),e.fillStyle=t.graduation.color||"#000",e.scale(.8,.8),p=a-8,c=i,d=0;r>c;d++,c+=h)if(0===d%10)e.fillText(f*d,1.25*c-3,1.25*p);for(c=i,d=0;c>a;d++,c-=h)if(0===d%10)e.fillText(-f*d,1.25*c-3,1.25*p);for(p=0,c=n,d=0;c>a;d++,c-=h)if(0===d%10)e.fillText(f*d,1.25*p,1.25*c+3);for(c=n,d=0;o>c;d++,c+=h)if(0===d%10)e.fillText(-f*d,1.25*p,1.25*c+3);e.restore(),e.stroke()}return e}),define("render/shape/Graduation",["require","../util/drawGraduation","./Shape"],function(require){var e=require("../util/drawGraduation"),t={type:"graduation",adjust:function(e){return e},isIn:function(){return!1},draw:function(t,i){t.save(),e(t,i.config),t.restore(),t.beginPath()}};return require("./Shape").derive(t)}),define("render/shape/Line",["require","../util/dashedLineTo","graphics/computeBoundingBox","./Shape"],function(require){var e=require("../util/dashedLineTo"),t=require("graphics/computeBoundingBox"),i={type:"line",adjust:function(e,t){var i=t.center,n=t.ratio;if(void 0!==e.p0.x)e.p0.x=n*(e.p0.x-i.x)+i.x;else e.p0.y=n*(e.p0.y-i.y)+i.y;if(void 0!==e.p1)e.p1.x=n*(e.p1.x-i.x)+i.x,e.p1.y=n*(e.p1.y-i.y)+i.y;return e},move:function(e,t,i){if(void 0!==e.p0.x)e.p0.x+=t;else e.p0.y+=i;if(void 0!==e.p1)e.p1.x+=t,e.p1.y+=i;return e},getRect:function(e){return void 0===e.p1?!1:t.computeBounding([e.p0,e.p1])},isIn:function(e,t,i){if(void 0===e.p1)return void 0!==e.p0.x&&Math.abs(e.p0.x-t)<4||void 0!==e.p0.y&&Math.abs(e.p0.y-i)<4;var n=e.p0.x,r=e.p0.y,o=e.p1.x,a=e.p1.y;return(i-r)*(t-o)===(i-a)*(t-n)},draw:function(t,i){var n,r,o,a;if(void 0===i.p1)if(void 0!==i.p0.x)n=Math.round(i.p0.x),t.moveTo(n,0),t.lineTo(n,t.canvas.height);else r=Math.round(i.p0.y),t.moveTo(0,r),t.lineTo(t.canvas.width,r);else if(n=Math.round(i.p0.x),r=Math.round(i.p0.y),o=Math.round(i.p1.x),a=Math.round(i.p1.y),i.dashed)e(t,n,r,o,a);else t.moveTo(n,r),t.lineTo(o,a)}};return require("./Shape").derive(i)}),define("render/shape/support",["require","./Circle","./CirclePoint","./Point","./Rect","./Polygon","./Font","./Path","./Axis","./Graduation","./Line"],function(require){var e={circle:require("./Circle"),cpoint:require("./CirclePoint"),point:require("./Point"),rect:require("./Rect"),polygon:require("./Polygon"),font:require("./Font"),path:require("./Path"),axis:require("./Axis"),graduation:require("./Graduation"),line:require("./Line")};return e}),define("render/Camera",["require"],function(){function e(e,t,i){this.reset(e,t,i)}return e.prototype.reset=function(e,t,i){this.center=e||{x:0,y:0},this.scale=t||1,this.ratio=i||1},e.prototype.dispose=function(){this.center=this.ratio=this.scale=null},e}),define("render/Painter",["require","./util/guid","./Layer","./shape/support","./Camera","graphics/computeBoundingBox"],function(require){function e(e){var t=document.createElement("canvas"),i=e.level||1;if(t.id=e.id,t.width=e.width,t.height=e.height,t.style.position="absolute",t.style.zIndex=i>u?1:i,e.background)t.style.background=e.background;return t}function t(t){t=t||{},t.id=t.id||n("layer"),t.width=this.width,t.height=this.height,t.level=t.level||1,t.painter=this;var i=e(t);return this.main.appendChild(i),new r(i.getContext("2d"),t)}function i(e,t){this.main=e,this.options=t||{},this.layers=[],this.main.style.position="relative",this.resetSize(),this.camera=new a({x:this.width/2,y:this.height/2});var i={};Object.keys(o).forEach(function(e){i[e]=new o[e]}),this.support=i}var n=require("./util/guid"),r=require("./Layer"),o=require("./shape/support"),a=require("./Camera"),s=require("graphics/computeBoundingBox"),u=1e4;return i.prototype={constructor:i,addSupport:function(e){if(this.support[e.type])throw"exist the same shape type";return this.support[e.type]=e,this},refresh:function(){return this.layers.forEach(function(e){e.refresh()}),this},getLayer:function(e){if("string"==typeof e)return this.layers.filter(function(t){return t.id===e})[0];else if("number"==typeof e)return this.layers[e];else if("object"==typeof e)return e},addLayer:function(e,i){if(e instanceof r)return this.layers.push(e),e;else if("string"==typeof e)return i=i||{},i.id=e,e=t.call(this,i),this.layers.push(e),e;throw"add layer faild"},removeLayer:function(e){var t=-1;if(e instanceof r)t=this.layers.indexOf(e);else if("string"==typeof e){for(var i=0,n=this.layers.length;n>i;i++)if(e===this.layers[i].id){t=i;break}}else if("number"==typeof t)t=t;else throw"need layer id to be removed";if(t>=0&&t<this.layers.length)return e=this.layers[t],e.dispose(),this.main.removeChild(document.getElementById(e.id)),this.layers.splice(t,1),!0;else return!1},getShapeIn:function(e){for(var t=this.layers.filter(function(e){return!e.disabled}),i=0,n=t.length;n>i;i++){var r=t[i].getShapeIn(e);if(r)return r}},adjust:function(e){var t=[];if(e){var i=this.getLayer(e);t.push(i)}else t=this.layers;return t.forEach(function(e){e.adjust()}),this},move:function(e,t,i){var n=[];if(i){var r=this.getLayer(i);n.push(r)}else n=this.layers;return n.forEach(function(i){i.move(e,t)}),this},moveTo:function(e,t,i){var n=[];if(i){var r=this.getLayer(i);n.push(r)}else n=this.layers;var o=[];n.forEach(function(e){var t=e.getBound();if(t)o.push(t),o.push({x:t.x+t.width,y:t.y+t.height})});var a=s.computeBounding(o);if(a){var u=e-(a.x+a.width/2),f=t-(a.y+a.height/2);n.forEach(function(e){e.move(u,f)})}return this},clearShapes:function(){for(var e=this.layers,t=0,i=e.length;i>t;t++)e[t].clearShapes();return this},resetSize:function(){if(this.options.width)this.main.style.width=this.options.width+"px";if(this.options.height)this.main.style.height=this.options.height+"px";var e=this.main.clientWidth,t=this.main.clientHeight;return this.layers.forEach(function(i){document.getElementById(i.id).width=e,document.getElementById(i.id).height=t}),this.width=e,this.height=t,this},getSize:function(){return{width:this.width,height:this.height}},reset:function(){return this.clearShapes(),this.resetSize(),this.camera.reset({x:this.width/2,y:this.height/2}),this},dispose:function(){for(var e=this.layers,t=0,i=e.length;i>t;t++)e[t].dispose(),this.main.removeChild(document.getElementById(e[t].id));this.main=this.layers=this.options=null},createLayer:function(e){return t.call(this,e)}},i}),define("render/capture/Keyboard",["require","common/lang","common/observable"],function(require){function e(e){return{keyCode:e.keyCode,key:o[e.keyCode],ctrlKey:e.ctrlKey||e.metaKey,metaKey:e.metaKey,altKey:e.altKey,shiftKey:e.shiftKey,originEvent:e}}function t(t,i){if(!1!==this.events["key"+Event]){var n=e(i);this.fire("key"+t,n);var r=o[n.keyCode];if(r)this.fire(r+":"+t,n)}}function i(e,i){this.main=e,i=i||{},this.events=i.events||{},this.handlers={keydown:n.bind(t,this,"down"),keyup:n.bind(t,this,"up"),keypress:n.bind(t,this,"press")},this.start()}var n=require("common/lang"),r=require("common/observable"),o={37:"left",38:"up",39:"right",40:"down",13:"enter",27:"esc",8:"backspace",45:"insert",46:"delete",16:"shift",17:"ctrl",18:"alt",36:"home",47:"help",20:"caps",9:"tab"};return i.prototype={constructor:i,start:function(){if(!this.listening){this.listening=!0;var e=document.body;e.addEventListener("keydown",this.handlers.keydown,!1),e.addEventListener("keyup",this.handlers.keyup,!1),e.addEventListener("keypress",this.handlers.keypress,!1)}return this},stop:function(){if(this.listening){this.listening=!1;var e=document.body;e.removeEventListener("keydown",this.handlers.keydown),e.removeEventListener("keyup",this.handlers.keyup),e.removeEventListener("keypress",this.handlers.keypress)}return this},isListening:function(){return!!this.listening},dispose:function(){this.stop(),this.main=this.events=null,this.un()}},r.mixin(i.prototype),i}),define("render/capture/Resize",["require","common/lang","common/observable"],function(require){function e(e){return{originEvent:e}}function t(t){if(!1!==this.events.resize){var i=e(t);this.fire("resize",i)}}function i(e,i){this.main=e,i=i||{},this.events=i.events||{},this.debounce=i.debounce||200,this.handlers={resize:n.debounce(n.bind(t,this),this.debounce)},this.start()}var n=require("common/lang"),r=require("common/observable");return i.prototype={constructor:i,start:function(){if(!this.listening)this.listening=!0,window.addEventListener("resize",this.handlers.resize,!1);return this},stop:function(){if(this.listening)this.listening=!1,window.removeEventListener("resize",this.handlers.resize);return this},isListening:function(){return!!this.listening},dispose:function(){this.stop(),this.main=this.events=null,this.un()}},r.mixin(i.prototype),i}),define("render/Render",["require","common/lang","./util/guid","./Painter","./capture/Mouse","./capture/Keyboard","./capture/Resize","common/observable"],function(require){function e(){this.painter=new r(this.main,this.options.painter),this.capture=new o(this.main,this.options.mouse),this.keyCapture=new a(this.main,this.options.keyboard),this.camera=this.painter.camera;var e=this;if(this.options.enableScale)this.capture.on("wheel",function(t){if(t.altKey||t.ctrlKey){t.originEvent.preventDefault(),t.originEvent.stopPropagation();var i=e.options.defaultRatio||1.2,n=t.delta>0?i:1/i,r=e.camera.scale*n;if(r<e.options.minScale||r>e.options.maxScale)return;e.scale(n,t)}else{var o=t.delta>0?30:-30;e.move(t.shiftKey?o:0,t.shiftKey?0:o),e.refresh()}});if(this.options.enableResize)this.resizeCapture=new s(this.main),this.resizeCapture.on("resize",function(){if("none"===e.main.style.display)return void(e.hasResized=!0);var t=e.painter.getSize();e.painter.resetSize();var i=e.painter.getSize();if(i.width!==t.width||i.height!==t.height)e.fire("resize",{size:i,prevSize:t})})}function t(t,r){if(this.main=t,this.options=i.extend({defaultRatio:1.2,minScale:.2,maxScale:200,enableScale:!0,enableResize:!0},r),this.id=n(),!this.main)throw"require a main dom element";e.call(this)}var i=require("common/lang"),n=require("./util/guid"),r=require("./Painter"),o=require("./capture/Mouse"),a=require("./capture/Keyboard"),s=require("./capture/Resize"),u=require("common/observable");return t.prototype.setCursor=function(e){return this.main.style.cursor=e||"default",this},t.prototype.refresh=function(){if(this.hasResized)this.painter.resetSize(),this.hasResized=!1;return this.painter.refresh(),this},t.prototype.reset=function(){this.painter.reset()},t.prototype.scale=function(e,t,i){var n=this.camera.scale*e;if(!(n<this.options.minScale||n>this.options.maxScale)){if(this.camera.ratio=e,this.camera.center.x=t.x,this.camera.center.y=t.y,this.camera.scale=n,!0!==i)this.painter.refresh();else this.painter.adjust();this.camera.ratio=1}},t.prototype.scaleTo=function(e,t,i){if(this.scale(e/this.camera.scale,this.camera.center,!0),this.painter.moveTo(t.x,t.y),this.camera.reset(t,e),!0!==i)this.painter.refresh()},t.prototype.focus=function(){this.keyCapture.start()},t.prototype.blur=function(){this.keyCapture.stop()},t.prototype.dispose=function(){this.un(),this.painter.dispose(),this.capture.dispose(),this.keyCapture.dispose(),this.resizeCapture&&this.resizeCapture.dispose(),this.main=this.options=this.camera=null,this.painter=this.capture=this.keyCapture=null},["addSupport","move","getSize","getLayer","addLayer","removeLayer","getShapeIn","clearShapes"].forEach(function(e){t.prototype[e]=function(){return this.painter[e].apply(this.painter,arguments)}}),u.mixin(t.prototype),t}),define("math/cubeEquation",["require","./quadraticEquation"],function(require){function e(e,i,n,r){if(0===e)return t(i,n,r);if(0===r)return t(e,i,n);if(1!==e)i/=e,n/=e,r/=e;var o,a,s,u,f,h,c,d;if(a=(3*n-i*i)/9,s=-(27*r)+i*(9*n-2*i*i),s/=54,o=a*a*a+s*s,c=i/3,o>0)return f=s+Math.sqrt(o),f=0>f?-Math.pow(-f,1/3):Math.pow(f,1/3),h=s-Math.sqrt(o),h=0>h?-Math.pow(-h,1/3):Math.pow(h,1/3),[-c+f+h];var l,p,g;if(0===o)return d=0>s?-Math.pow(-s,1/3):Math.pow(s,1/3),l=-c+2*d,p=-(d+c),g=p,l===p?l:[l,p];else return a=-a,u=a*a*a,u=Math.acos(s/Math.sqrt(u)),d=2*Math.sqrt(a),l=-c+d*Math.cos(u/3),p=-c+d*Math.cos((u+2*Math.PI)/3),g=-c+d*Math.cos((u+4*Math.PI)/3),[l,p,g]}var t=require("./quadraticEquation");return e}),define("math/quarticEquation",["require","./cubeEquation"],function(require){function e(e,i,n,r,o){if(0===e)return t(i,n,r,o);if(0===o)return t(e,i,n,r);if(1!==e)i/=e,n/=e,r/=e,o/=e;var a,s,u,f,h,c,d,l,p,g,m,y,v,x,w,b,S,M,C,E,L,k;if(a=-n,s=-4*o+r*i,u=-(i*i*o+r*r)+4*n*o,h=(3*s-a*a)/9,c=-(27*u)+a*(9*s-2*a*a),c/=54,f=h*h*h+c*c,b=a/3,f>0)x=c+Math.sqrt(f),x=0>x?-Math.pow(-x,1/3):Math.pow(x,1/3),w=c-Math.sqrt(f),w=0>w?-Math.pow(-w,1/3):Math.pow(w,1/3),C=-b+x+w;else if(0===f)S=0>c?-Math.pow(-c,1/3):Math.pow(c,1/3),C=-b+2*S;else h=-h,m=h*h*h,m=Math.acos(c/Math.sqrt(m)),S=2*Math.sqrt(h),C=-b+S*Math.cos(m/3);if(b=i/4,M=-n+b*i+C,d=l=p=g=y=v=E=L=k=0,M>=0)if(0===M)if(m=-(4*o)+C*C,0>m)L=2*Math.sqrt(-m);else E=2*Math.sqrt(m),k=-E;else d=Math.sqrt(M),E=-(8*r+i*i*i)/4+i*n,E/=d,k=-E;else l=Math.sqrt(-M),L=-(8*r+i*i*i)/4+i*n,L/=l,L=-L;if(E+=-(2*n+M)+3*i*b,k+=-(2*n+M)+3*i*b,0===L){if(E>=0)p=Math.sqrt(E);else g=Math.sqrt(-E);if(k>=0)y=Math.sqrt(k);else v=Math.sqrt(-k)}else c=Math.sqrt(E*E+L*L),c=Math.sqrt(c),m=Math.atan2(L,E),m/=2,y=p=c*Math.cos(m),g=c*Math.sin(m),v=-g;var B=[];if(0===l+g)B.push(-b+(d+p)/2);if(0===-g+l)B.push(-(b+p/2)+d/2);if(0===-l+v)B.push(-(b+d/2)+y/2);if(0===l+v)B.push(-(b+(d+y)/2));for(var U={},P=[],q=0,A=B.length;A>q;q++)if(!U[B[q]])P.push(B[q]),U[B[q]]=!0;return P.length?P:!1}var t=require("./cubeEquation");return e}),define("math/bezierQ4Equation",["require","./quarticEquation"],function(require){function e(e,i,n,r,o){var a=t(e,i,n,r,o);if(!a)return a;var s=a.filter(function(e){return e>=0&&1>=e});return s.length?s:!1}var t=require("./quarticEquation");return e}),define("graphics/isBezierCross",["require","./computeBoundingBox","./isBoundingBoxCross","../math/bezierQ2Equation","../math/bezierQ4Equation","./util","./matrix"],function(require){function e(e,a,h,c,d,l){var p=t.quadraticBezier(e,a,h),g=t.quadraticBezier(c,d,l);if(i(p,g)){var m,y,v,x,w=[e.x+h.x-2*a.x,2*(a.x-e.x),e.x-c.x,c.x+l.x-2*d.x,2*(d.x-c.x)],b=[e.y+h.y-2*a.y,2*(a.y-e.y),e.y-c.y,c.y+l.y-2*d.y,2*(d.y-c.y)],S=!1;if(0!==w[3]&&0!==b[3])if(m=u(s(w,b[3]),s(b,w[3])),0===m[4])S=n.apply(this,m);else m=s(m,1/m[4]),v=s([Math.pow(m[0],2),2*m[0]*m[1],2*m[0]*m[2]+Math.pow(m[1],2),2*m[1]*m[2],Math.pow(m[2],2)],b[3]),y=s([0,0,m[0],m[1],m[2]],b[4]),x=f(v,y),x[2]=x[2]-b[0],x[3]=x[3]-b[1],x[4]=x[4]-b[2],S=r.apply(this,x);else if(0===w[3]&&0===b[3]){if(0!==w[4]&&0!==b[4])m=u(s(w,b[4]),s(b,w[4])),S=n.apply(this,m);else if(0===w[4])S=n.apply(this,w);else if(0===b[4])S=n.apply(this,b),m=w,w=b,b=m}else{if(0===b[3])m=w,w=b,b=m;if(0===w[4])S=n.apply(this,w);else m=s(w,1/w[4]),v=s([Math.pow(m[0],2),2*m[0]*m[1],2*m[0]*m[2]+Math.pow(m[1],2),2*m[1]*m[2],Math.pow(m[2],2)],b[3]),y=s([0,0,m[0],m[1],m[2]],b[4]),x=f(v,y),x[2]=x[2]-b[0],x[3]=x[3]-b[1],x[4]=x[4]-b[2],S=r.apply(this,x)}if(S){for(var M,C,E,L,k,B=S.length-1;B>=0;B--)if(M=S[B],C=n(b[3]-w[3],b[4]-w[4],w[0]*Math.pow(M,2)+w[1]*M+w[2]-(b[0]*Math.pow(M,2)+b[1]*M+b[2])),!C)S.splice(B,1);else{for(var U=C.length-1;U>=0;U--)if(E=C[U],L=e.x*Math.pow(1-M,2)+2*a.x*M*(1-M)+h.x*Math.pow(M,2),k=c.x*Math.pow(1-E,2)+2*d.x*E*(1-E)+l.x*Math.pow(E,2),.001<Math.abs(L-k))C.splice(U,1);if(!C.length)S.splice(B,1)}return S.length?S.map(function(t){return o({x:e.x*Math.pow(1-t,2)+2*a.x*t*(1-t)+h.x*Math.pow(t,2),y:e.y*Math.pow(1-t,2)+2*a.y*t*(1-t)+h.y*Math.pow(t,2)})}):!1}}return!1}var t=require("./computeBoundingBox"),i=require("./isBoundingBoxCross"),n=require("../math/bezierQ2Equation"),r=require("../math/bezierQ4Equation"),o=require("./util").ceilPoint,a=require("./matrix"),s=a.multi,u=a.minus,f=a.plus;return e}),define("graphics/isBezierSegmentCross",["require","./computeBoundingBox","./isBezierLineCross","./isBoundingBoxCross","./util"],function(require){function e(e,o,a,s,u){var f=t.quadraticBezier(e,o,a),h={x:Math.min(s.x,u.x),y:Math.min(s.y,u.y),width:Math.abs(s.x-u.x),height:Math.abs(s.y-u.y)};if(n(f,h)){var c=i(e,o,a,s,u);if(c)return c.filter(function(e){return r(h,e,!0)})}return!1}var t=require("./computeBoundingBox"),i=require("./isBezierLineCross"),n=require("./isBoundingBoxCross"),r=require("./util").isPointInBound;return e}),define("graphics/join/getJoint",["require","../isSegmentCross","../isBezierCross","../isBezierSegmentCross","../pathIterator"],function(require){function e(e){return 31*(31*e.x+e.y)}function t(t,a,s,u,f,h){var c,d=[];o(t,function(e,t,o,l,p){if("L"===e){if("L"===a)c=i(s,u,t,o);else if("Q"===a)c=r(s,u,f,t,o,l)}else if("Q"===e)if("L"===a)c=r(t,o,l,s,u);else if("Q"===a)c=n(t,o,l,s,u,f);if(c)d=d.concat(c.map(function(e){return e.index0=h,e.index1=p,e}))});for(var l={},p=d.length-1;p>=0;p--){var g=d[p];if(l[e(g)])d.splice(p,1);else l[e(g)]=!0}return d.length?d:!1}var i=require("../isSegmentCross"),n=require("../isBezierCross"),r=require("../isBezierSegmentCross"),o=require("../pathIterator");return t}),define("graphics/join/getPathJoint",["require","./getJoint","../pathIterator"],function(require){function e(e,n){var r,o=[];return i(e,function(e,i,a,s,u){if("L"===e)r=t(n,"L",i,a,0,u);else if("Q"===e)r=t(n,"Q",i,a,s,u);if(r)o=o.concat(r)}),o.length?o:!1}var t=require("./getJoint"),i=require("../pathIterator");return e}),define("graphics/pathUtil",["require"],function(){function e(e){for(var t=[],i=0,n=e.length;n>i;i++){var r=i===n-1?0:i+1;if(t.push(e[i]),!e[i].onCurve&&!e[r].onCurve)t.push({x:(e[i].x+e[r].x)/2,y:(e[i].y+e[r].y)/2,onCurve:!0})}return t}function t(e){for(var t=[],i=0,n=e.length;n>i;i++){var r=i===n-1?0:i+1,o=0===i?n-1:i-1;if(!(!e[o].onCurve&&e[i].onCurve&&!e[r].onCurve&&Math.abs(2*e[i].x-e[o].x-e[r].x)<.001&&Math.abs(2*e[i].y-e[o].y-e[r].y)<.001))t.push(e[i]);else;}return t}function i(e){if(e.length<3)return 0;for(var t=0,i=0,n=e.length;n>i;i++){var r=e[i],o=0===i?e[n-1]:e[i-1],a=i===n-1?e[0]:e[i+1],s=(r.x-o.x)*(a.y-r.y)-(r.y-o.y)*(a.x-r.x);if(0>s)t--;else if(s>0)t++}return 0===t?0:0>t?1:-1}function n(e){return 31*(31*e.x+e.y)+(e.onCurve?1:0)}function r(e){var t=0,i=131;return e.forEach(function(e){t=2147483647&t*i+n(e)}),t}function o(e){for(var t={},i=[],n=0,r=e.length;r>n;n++){var o=31*e[n].x+e[n].y;if(!t[o])i.push(e[n]),t[o]=1}return i}return{interpolate:e,deInterpolate:t,isClockWise:i,removeOverlapPoints:o,getPointHash:n,getPathHash:r}}),define("graphics/isPathCross",["require","./computeBoundingBox","./join/getPathJoint","./isInsidePath","./isBoundingBoxCross","./pathUtil"],function(require){function e(e,a,s,u){if(s=s||t.computePath(e),u=u||t.computePath(a),r(s,u)){var f=i(e,a);if(!f)if(n(e,a[0]))return 2;else if(n(a,e[0]))return 3;return o.removeOverlapPoints(f)}return!1}var t=require("./computeBoundingBox"),i=require("./join/getPathJoint"),n=require("./isInsidePath"),r=require("./isBoundingBoxCross"),o=require("./pathUtil");return e}),define("render/util/selectShape",["require","../../graphics/computeBoundingBox","../../graphics/isPathCross"],function(require){function e(e,n){if(1===e.length)return e[0];var r=e.map(function(e){var i=t.computePath(e.points);return e._bound=i,e._size=i.width*i.height,e}).sort(function(e,t){return e._size-t._size}),o=r[0],a=r[r.length-1],s=i(o.points,a.points,o._bound,a._bound),u=o;if(2===s)u=a;else if(3===s)u=o;else if(n&&Math.abs(o._size-a._size)/o._size<.01){var f=o._bound.x+o._bound.width/2,h=o._bound.y+o._bound.height/2,c=a._bound.x+a._bound.width/2,d=a._bound.y+a._bound.height/2;if(Math.pow(n.x-c,2)+Math.pow(n.y-d,2)>Math.pow(n.x-f,2)+Math.pow(n.y-h,2))u=a}return e.forEach(function(e){delete e._bound,delete e._size}),u}var t=require("../../graphics/computeBoundingBox"),i=require("../../graphics/isPathCross");return e}),define("render/Controller",["require","./util/selectShape"],function(require){function e(){var e=this.render;e.capture.on("down",function(t){var n=e.getLayer("cover").getShapeIn(t);if(n)e.selectedShape=n[0];else if(n=e.getLayer("font").getShapeIn(t),n.length>1)e.selectedShape=i(n,t);else e.selectedShape=n[0];e.camera.x=t.x,e.camera.y=t.y}),e.capture.on("drag",function(t){var i=e.selectedShape;if(i)e.getLayer(i.layerId).move(t.x-e.camera.x,t.y-e.camera.y,i).refresh();else e.move(t.x-e.camera.x,t.y-e.camera.y).refresh();e.camera.x=t.x,e.camera.y=t.y}),e.capture.on("dragend",function(t){var i=e.selectedShape;if(i)e.getLayer(i.layerId).move(t.x-e.camera.x,t.y-e.camera.y,i).refresh(),e.selectedShape=null;else e.painter.refresh()})}function t(e){this.options=e||{}}var i=require("./util/selectShape");return t.prototype.setRender=function(t){return this.render=t,e.call(this),this},t.prototype.dispose=function(){this.render&&this.render.dispose(),this.options=this.render=null},t}),define("render/main",["require","./Render","./Controller"],function(require){var e=require("./Render"),t=require("./Controller"),exports={};return exports.create=function(i,n){n=n||{};var r=new e(i,n),o=n.controller;if(delete n.controller,!o)o=new t;return o.setRender(r),r},exports}),define("editor/menu/point",["require"],function(){return[{name:"add",title:"添加点"},{name:"remove",title:"删除点"},{name:"onCurve",title:"在曲线上"},{name:"offCurve",title:"远离曲线"},{name:"asStart",title:"作为开始点"}]}),define("editor/menu/shape",["require"],function(){return[{name:"removeshapes",title:"删除轮廓"},{name:"reversepoints",title:"改变方向"},{name:"cutshapes",title:"剪切"},{name:"copyshapes",title:"复制"},{name:"order",title:"顺序",items:[{name:"topshape",title:"置前"},{name:"bottomshape",title:"置后"},{name:"upshape",title:"上移一层"},{name:"downshape",title:"下移一层"}]},{name:"transform",title:"变换",items:[{name:"rotateleft",title:"向左旋转"},{name:"rotateright",title:"向右旋转"},{name:"flipshapes",title:"翻转"},{name:"mirrorshapes",title:"镜像"}]},{name:"horizontalalignshapes_",title:"水平方向",items:[{name:"horizontalalignshapes",align:"left",title:"左对齐"},{name:"horizontalalignshapes",align:"center",title:"居中对齐"},{name:"horizontalalignshapes",align:"right",title:"右对齐"}]},{name:"verticalalignshapes_",title:"垂直方向",items:[{name:"verticalalignshapes",align:"ascent",title:"顶端对齐"},{name:"verticalalignshapes",align:"middle",title:"居中对齐"},{name:"verticalalignshapes",align:"descent",title:"底端对齐"},{name:"verticalalignshapes",align:"baseline",title:"基线对齐"}]},{name:"addreferenceline",title:"添加边界参考线"}]}),define("editor/menu/shapes",["require"],function(){return[{name:"reversepoints",title:"改变方向"},{name:"removeshapes",title:"删除轮廓"},{name:"cutshapes",title:"剪切"},{name:"copyshapes",title:"复制"},{name:"join",title:"连接轮廓",items:[{name:"joinshapes",title:"结合"},{name:"intersectshapes",title:"相交"},{name:"tangencyshapes",title:"相切"}]},{name:"transform",title:"变换",items:[{name:"rotateleft",title:"向左旋转"},{name:"rotateright",title:"向右旋转"},{name:"flipshapes",title:"翻转"},{name:"mirrorshapes",title:"镜像"}]},{name:"alignshapes_",title:"对齐形状",items:[{name:"alignshapes",align:"left",title:"左对齐"},{name:"alignshapes",align:"center",title:"居中对齐"},{name:"alignshapes",align:"right",title:"右对齐"},{name:"alignshapes",align:"top",title:"顶部对齐"},{name:"alignshapes",align:"middle",title:"中间对齐"},{name:"alignshapes",align:"bottom",title:"底部对齐"}]},{name:"horizontalalignshapes_",title:"水平方向",items:[{name:"horizontalalignshapes",align:"left",title:"左对齐"},{name:"horizontalalignshapes",align:"center",title:"居中对齐"},{name:"horizontalalignshapes",align:"right",title:"右对齐"}]},{name:"verticalalignshapes_",title:"垂直方向",items:[{name:"verticalalignshapes",align:"ascent",title:"顶端对齐"},{name:"verticalalignshapes",align:"middle",title:"居中对齐"},{name:"verticalalignshapes",align:"descent",title:"底端对齐"},{name:"verticalalignshapes",align:"baseline",title:"基线对齐"}]},{name:"addreferenceline",title:"添加边界参考线"}]}),define("editor/menu/editor",["require"],function(){return[{name:"addpath",title:"添加路径"},{name:"add_shapes",title:"添加形状",items:[{name:"addsupportshapes",type:"circle",title:"添加圆"},{name:"addsupportshapes",type:"rect",title:"添加矩形"},{name:"addsupportshapes",type:"roundrect",title:"添加圆角矩形"},{name:"addsupportshapes",type:"star",title:"添加五角星"},{name:"addsupportshapes",type:"arrow",title:"添加箭头"}]},{name:"undo",title:"撤销"},{name:"redo",title:"恢复"},{name:"paste",title:"粘贴"},{name:"split",title:"切割轮廓"},{name:"setting",title:"设置",items:[{name:"gridsorption",title:"吸附到网格线"},{name:"shapesorption",title:"吸附到轮廓"},{name:"showgrid",title:"显示网格"},{name:"moresetting",title:"更多.."}]},{name:"addreferenceline",title:"添加参考线"},{name:"clearreferenceline",title:"清除参考线"},{name:"rescale",title:"重置缩放"},{name:"fontsetting",title:"字形信息"},{name:"save",title:"保存"}]}),define("editor/menu/commandList",["require","./point","./shape","./shapes","./editor"],function(require){return{point:require("./point"),shape:require("./shape"),shapes:require("./shapes"),editor:require("./editor")}}),define("editor/mode/point",["require","common/lang","../menu/commandList"],function(require){function e(e){if(this.curPoint)if(e.returnValue!==!1){this.contextMenu.hide();var i=e.command,n=this.curShape,r=n.points,o=+this.curPoint.pointId;if("add"===i){var a=r[o],s=r[o===r.length-1?0:o+1],u={x:(a.x+s.x)/2,y:(a.y+s.y)/2,onCurve:!0};r.splice(o+1,0,u)}else if("remove"===i)r.splice(o,1);else if("onCurve"===i)r[o].onCurve=!0;else if("offCurve"===i)delete r[o].onCurve;else if("asStart"===i)n.points=r.slice(o).concat(r.slice(0,o));else if(this.supportCommand(i))return void this.execCommand(i);t.call(this,n),delete this.curPoint,this.fontLayer.refresh(),this.fire("change")}}function t(e){var t=[],n=e.points.length-1,r=i.clone(e);r.id="cover-"+e.id,r.selectable=!1,r.style={strokeColor:"red"},r.points.forEach(function(e,i){var r={type:e.onCurve?"point":"cpoint",x:e.x,y:e.y,point:e,pointId:i,style:{fill:!0,stroke:!0,strokeColor:"green",fillColor:"white"}};if(0===i)r.style.strokeColor="blue",r.style.fillColor="blue",r.style.strokeWidth=2;else if(i===n)r.style.strokeColor="red",r.style.fillColor="red",r.style.strokeWidth=2;t.push(r)});var o=this.coverLayer;o.clearShapes(),o.addShape(r),t.forEach(function(e){o.addShape(e)}),this.curShape=e,o.refresh()}var i=require("common/lang"),n={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]},r={down:function(e){if(this.curPoint)if(this.curPoint._style)this.curPoint.style=i.clone(this.curPoint._style);delete this.curPoint;var t=this.coverLayer.getShapeIn(e);if(t){if(this.curPoint=t[0],this.curPoint._style=i.clone(this.curPoint.style),this.curPoint.style.fillColor="green",this.sorption.isEnable())if(this.sorption.enableShape){var n=[],r=[];this.curShape.points.forEach(function(e){n.push(e.x),r.push(e.y)});var o=this.referenceLineLayer.shapes;o.forEach(function(e){if(void 0!==e.p0.x)n.push(e.p0.x);if(void 0!==e.p0.y)r.push(e.p0.y)}),this.sorption.clear(),n.length&&this.sorption.addXAxis(n),r.length&&this.sorption.addYAxis(r)}this.coverLayer.refresh()}},drag:function(){var e=this.render.camera;if(this.curPoint){var t=this.curPoint,i=this.curShape.points[t.pointId];if(e.event.altKey)t.x=i.x;else t.x=i.x+e.event.deltaX;if(e.event.shiftKey)t.y=i.y;else t.y=i.y+e.event.deltaY;if(this.sorption.isEnable()){var n;if(n=this.sorption.detectX(t.x))t.x=n.axis;if(n=this.sorption.detectY(t.y))t.y=n.axis}t.point.x=t.x,t.point.y=t.y,this.coverLayer.refresh()}},dragend:function(){if(this.curPoint){var e=this.curShape.points[this.curPoint.pointId];if(e.x=this.curPoint.x,e.y=this.curPoint.y,this.sorption.isEnable())this.sorption.clear();this.fontLayer.refresh()}this.fire("change")},move:function(e){var t=this.coverLayer.getShapeIn(e);if(t)this.render.setCursor("pointer");else this.render.setCursor("default")},rightdown:function(t){if(this.curPoint)this.contextMenu.onClick=i.bind(e,this),this.contextMenu.show(t,require("../menu/commandList").point)},keyup:function(t){if("delete"===t.key&&this.curPoint)e.call(this,{command:"remove"});else if(n[t.key]&&this.curPoint)this.fire("change");else if("esc"===t.key)this.setMode()},keydown:function(e){if(n[e.key]&&this.curPoint){var t=n[e.key],i=this.curPoint;if(t[0])i.x+=t[0];if(t[1])i.y+=t[1];var r=this.curShape.points[i.pointId];r.x=i.point.x=i.x,r.y=i.point.y=i.y,this.coverLayer.refresh(),this.fontLayer.refresh()}},begin:function(e){var i=this;t.call(i,e)},end:function(){delete this.curPoint,delete this.curShape,this.coverLayer.clearShapes(),this.coverLayer.refresh(),this.render.setCursor("default")}};return r}),define("editor/mode/range",["require","graphics/computeBoundingBox","graphics/isBoundingBoxCross"],function(require){function e(e){var n=this.fontLayer.shapes,r=[];return n.forEach(function(n){var o=t.computePath(n.points);if(3===i(e,o))r.push(n)}),r.length?r:!1}var t=require("graphics/computeBoundingBox"),i=require("graphics/isBoundingBoxCross"),n={down:function(e){if(1===e.which)n.begin.call(this,e)},drag:function(e){if(1===e.which)if(this.selectionBox){var t=this.render.camera;this.selectionBox.width=t.x-this.selectionBox.x,this.selectionBox.height=t.y-this.selectionBox.y,this.coverLayer.refresh()}},up:function(t){if(1===t.which){if(this.selectionBox){var i={x:Math.min(this.selectionBox.x,this.selectionBox.x+this.selectionBox.width),y:Math.min(this.selectionBox.y,this.selectionBox.y+this.selectionBox.height),width:Math.abs(this.selectionBox.width),height:Math.abs(this.selectionBox.height)};
if(i.width>=20&&i.height>=20){var n;if(n=e.call(this,i))return void this.setMode("shapes",n,"range")}}this.setMode()}},begin:function(){var e=this.render.camera;this.selectionBox={type:"rect",dashed:!0,x:e.x,y:e.y},this.coverLayer.addShape(this.selectionBox)},end:function(){this.selectionBox=null,this.coverLayer.clearShapes(),this.coverLayer.refresh()}};return n}),define("editor/mode/pan",["require"],function(){var e={drag:function(e){if(1===e.which){var t=this.render.camera;this.render.move(t.mx,t.my),this.render.refresh()}},keyup:function(e){if(32===e.keyCode)this.setMode("bound")},begin:function(){this.render.setCursor("pointer")},end:function(){this.render.setCursor("default")}};return e}),define("editor/mode/referenceline",["require","common/lang"],function(require){var e=require("common/lang"),t={newLine:1,dragLine:2,drag:function(e){if(1===e.which)if(this.currentLine){var i=this.render.camera,n=this.currentLine;if(void 0!==n.p0.x)n.p0.x+=i.mx;else n.p0.y+=i.my;this.referenceLineLayer.refresh()}else if(this._dragMode===t.newLine){if(e.startX<=20&&e.x>20)this.currentLine=this.referenceLineLayer.addShape("line",{p0:{x:e.x},style:this.options.referenceline.style}),this.render.setCursor("col-resize");else if(e.startY<=20&&e.y>20)this.currentLine=this.referenceLineLayer.addShape("line",{p0:{y:e.y},style:this.options.referenceline.style}),this.render.setCursor("row-resize");this._dragMode=t.dragLine}},up:function(e){if(1===e.which){if(this.currentLine){var t=this.currentLine;if(t===this.rightSideBearing&&t.p0.x<20)t.p0.x=this.p0.x,this.referenceLineLayer.refresh();else if(void 0!==t.p0.x&&t.p0.x<20||void 0!==t.p0.y&&t.p0.y<20)this.execCommand("removereferenceline",t)}this.setMode()}},begin:function(i){if(i===t.dragLine){var n=arguments[1];if(void 0!==n.p0.x)this.render.setCursor("col-resize");else this.render.setCursor("row-resize");this.currentLine=n,this.p0=e.clone(n.p0)}this._dragMode=i},end:function(){delete this._dragMode,delete this.currentLine,delete this.p0,this.render.setCursor("default")}};return t}),define("editor/mode/bound",["require","render/util/selectShape","./referenceline"],function(require){var e=require("render/util/selectShape"),t=require("./referenceline"),i={down:function(i){if(1===i.which){if(i.x<=20||i.y<=20)return void this.setMode("referenceline",t.newLine,i.x,i.y);var n=this.fontLayer.getShapeIn(i);if(n){var r=e(n,i);return void this.setMode("shapes",[r],"bound")}if(n=this.referenceLineLayer.getShapeIn(i)){var o=n[0];return void this.setMode("referenceline",t.dragLine,o,i)}this.setMode("range")}},keydown:function(e){if(32===e.keyCode)this.setMode("pan");else if(65===e.keyCode&&e.ctrlKey)this.setMode("shapes",this.fontLayer.shapes.slice())}};return i}),define("editor/group/moveTransform",["require","common/lang","graphics/pathAdjust"],function(require){function e(e,n,r,o){var a=n?0:e.x-e.startX,s=r?0:e.y-e.startY,u=this.shapes,f=this.bound,h=this.editor.coverLayer,c=h.getShape("bound");if(o){var d,l,p=f.x+f.width/2,g=f.y+f.height/2,m=this.editor.options.sorption.sorptionColor;if(!n){var y=h.getShape("sorptionX");if(!y)y=h.addShape({type:"line",id:"sorptionX",style:{strokeColor:m},p0:{},p1:{}});var v=[this.bound.x,p,this.bound.x+this.bound.width];for(d=0;3>d;d++)if(l=this.editor.sorption.detectX(v[d]+a)){a=l.axis-v[d],y.p0.x=y.p1.x=l.axis,y.p0.y=g+s,y.p1.y=l.y,y.disabled=!1;break}if(3===d)y.disabled=!0}if(!r){var x=h.getShape("sorptionY");if(!x)x=h.addShape({type:"line",id:"sorptionY",style:{strokeColor:m},p0:{},p1:{}});var w=[this.bound.y,g,this.bound.y+this.bound.height];for(d=0;3>d;d++)if(l=this.editor.sorption.detectY(w[d]+s)){s=l.axis-w[d],x.p0.x=p+a,x.p1.x=l.x,x.p0.y=x.p1.y=l.axis,x.disabled=!1;break}if(3===d)x.disabled=!0}}this.coverShapes.forEach(function(e,n){var r=t.clone(u[n]);i(r.points,1,1,a,s),t.extend(e,r)}),c.points=i([{x:f.x,y:f.y},{x:f.x+f.width,y:f.y},{x:f.x+f.width,y:f.y+f.height},{x:f.x,y:f.y+f.height}],1,1,a,s),h.refresh()}var t=require("common/lang"),i=require("graphics/pathAdjust");return e}),define("editor/group/getScaleMatrix",["require"],function(){function e(e,t,i){var n=[0,0,1,1];switch(e){case 1:n[0]=t.x+t.width,n[1]=t.y+t.height,n[2]=-(i.x-n[0])/t.width,n[3]=-(i.y-n[1])/t.height;break;case 2:n[0]=t.x,n[1]=t.y+t.height,n[2]=(i.x-n[0])/t.width,n[3]=-(i.y-n[1])/t.height;break;case 3:n[0]=t.x,n[1]=t.y,n[2]=(i.x-n[0])/t.width,n[3]=(i.y-n[1])/t.height;break;case 4:n[0]=t.x+t.width,n[1]=t.y,n[2]=-(i.x-n[0])/t.width,n[3]=(i.y-n[1])/t.height;break;case 5:n[1]=t.y+t.height,n[2]=1,n[3]=-(i.y-n[1])/t.height;break;case 7:n[1]=t.y,n[3]=(i.y-n[1])/t.height;break;case 6:n[0]=t.x,n[2]=(i.x-n[0])/t.width;break;case 8:n[0]=t.x+t.width,n[2]=-(i.x-n[0])/t.width}return n}return e}),define("editor/group/scaleTransform",["require","./getScaleMatrix","graphics/pathAdjust","common/lang"],function(require){function e(e,o){var a=t(e.pos,this.bound,o);if(r.indexOf(e.pos)>=0)if(!o.event.shiftKey){var s=Math.max(Math.abs(a[2]),Math.abs(a[3]));a[2]=a[2]>=0?s:-s,a[3]=a[3]>=0?s:-s}var u=this.shapes;this.coverShapes.forEach(function(e,t){var r=n.clone(u[t]);if(i(r.points,a[2],a[3],-a[0],-a[1]),i(r.points,1,1,a[0],a[1]),a[2]<0&&a[3]>=0)r.points=r.points.reverse();if(a[3]<0&&a[2]>=0)r.points=r.points.reverse();n.extend(e,r)});var f=this.editor.coverLayer,h=f.getShape("bound"),c=this.bound,d=i([{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}],a[2],a[3],-a[0],-a[1]);i(d,1,1,a[0],a[1]),h.points=d,f.refresh()}var t=require("./getScaleMatrix"),i=require("graphics/pathAdjust"),n=require("common/lang"),r=[1,2,3,4];return e}),define("math/getAngle",["require"],function(){function e(e,t,i,n){var r=Math.acos((e*i+t*n)/Math.sqrt(e*e+t*t)/Math.sqrt(i*i+n*n));if(0>e*n-i*t)r=2*Math.PI-r;return r}return e}),define("editor/group/getRotateMatrix",["require","math/getAngle"],function(require){function e(e,i,n){var r=[i.x+i.width/2,i.y+i.height/2,0];switch(e){case 1:case 2:case 3:case 4:return r[2]=t(n.startX-r[0],n.startY-r[1],n.x-r[0],n.y-r[1]),r;case 5:return r[0]=0,r[1]=i.y+i.height,r[2]=t(0,i.height,n.x-n.startX,i.height),r;case 7:return r[0]=0,r[1]=i.y,r[2]=t(0,-i.height,n.x-n.startX,-i.height),r;case 6:return r[0]=i.x,r[1]=0,r[2]=t(i.width,0,i.width,n.y-n.startY),r;case 8:return r[0]=i.x+i.width,r[1]=0,r[2]=t(-i.width,0,-i.width,n.y-n.startY),r}return r}var t=require("math/getAngle");return e}),define("graphics/pathRotate",["require"],function(){function e(e,t,i,n){t=void 0===t?0:t;for(var r,o,a,s=i||0,u=n||0,f=Math.cos(t),h=Math.sin(t),c=0,d=e.length;d>c;c++)a=e[c],r=f*(a.x-s)-h*(a.y-u),o=f*(a.y-u)+h*(a.x-s),a.x=r+s,a.y=o+u;return e}return e}),define("graphics/pathLean",["require"],function(){function e(e,t,i,n){t=void 0===t?0:t;var r,o,a,s=i||0,u=Math.tan(t);if(0===s)for(o=0,a=e.length;a>o;o++)r=e[o],r.x+=u*(r.y-n);else for(o=0,a=e.length;a>o;o++)r=e[o],r.y+=u*(r.x-i);return e}return e}),define("editor/group/rotateTransform",["require","./getRotateMatrix","graphics/pathRotate","graphics/pathLean","common/lang"],function(require){function e(e,o){var a=t(e.pos,this.bound,o),s=e.pos<=4?i:n,u=this.shapes;this.coverShapes.forEach(function(e,t){var i=r.clone(u[t]);s(i.points,a[2],a[0],a[1]),r.extend(e,i)});var f=this.editor.coverLayer,h=f.getShape("bound"),c=this.bound;h.points=s([{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}],a[2],a[0],a[1]);var d=f.getShape("boundcenter");if(!d)d={type:"cpoint",id:"boundcenter",x:c.x+c.width/2,y:c.y+c.height/2},f.addShape(d);d.x=(h.points[0].x+h.points[2].x)/2,d.y=(h.points[0].y+h.points[2].y)/2,f.refresh()}var t=require("./getRotateMatrix"),i=require("graphics/pathRotate"),n=require("graphics/pathLean"),r=require("common/lang");return e}),define("editor/group/BoundControl",["require","common/lang"],function(require){function e(e){this.layer=e,this.controls=[{id:"bound-point",type:"polygon",dashed:!0,selectable:!1},{},{},{},{},{},{},{},{}]}var t=require("common/lang");return e.prototype.refresh=function(e,i){var n=[{points:[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]},{x:e.x,y:e.y,pos:1},{x:e.x+e.width,y:e.y,pos:2},{x:e.x+e.width,y:e.y+e.height,pos:3},{x:e.x,y:e.y+e.height,pos:4},{x:e.x+e.width/2,y:e.y,pos:5},{x:e.x+e.width,y:e.y+e.height/2,pos:6},{x:e.x+e.width/2,y:e.y+e.height,pos:7},{x:e.x,y:e.y+e.height/2,pos:8}],r=this.controls;n.forEach(function(e,n){if(n>0)if("rotate"===i&&4>=n)e.type="cpoint",e.size=3;else e.type="point",e.size=6;t.extend(r[n],e)}),this.show()},e.prototype.show=function(){var e=this.layer;if(!e.getShape("bound-point"))this.controls.forEach(function(t){e.addShape(t)});e.refresh()},e.prototype.hide=function(){var e=this.layer;if(e.getShape("bound-point"))this.controls.forEach(function(t){e.removeShape(t)});e.refresh()},e.prototype.dispose=function(){this.hide(),this.layer.refresh(),this.controls.length=0,this.controls=this.layer=null},e}),define("editor/group/ShapesGroup",["require","graphics/pathAdjust","common/lang","graphics/computeBoundingBox","./moveTransform","./scaleTransform","./rotateTransform","./BoundControl"],function(require){function e(e){return r.computePath.apply(null,e.map(function(e){return e.points}))}function t(e,t){this.editor=t,this.boundControl=new u(t.coverLayer),this.setShapes(e)}var i=require("graphics/pathAdjust"),n=require("common/lang"),r=require("graphics/computeBoundingBox"),o=require("./moveTransform"),a=require("./scaleTransform"),s=require("./rotateTransform"),u=require("./BoundControl");return t.prototype.beginTransform=function(){if(this.bound=e(this.shapes),this.editor.coverLayer.addShape({id:"bound",type:"polygon",dashed:!0,selectable:!1,points:[]}),this.boundControl.hide(),"move"===this.mode&&this.editor.sorption.isEnable())if(this.editor.sorption.enableShape){var t=[],i=this.shapes,n=this.bound;t.push({points:[{x:n.x,y:n.y,onCurve:!0},{x:n.x+n.width,y:n.y+n.height,onCurve:!0}]}),this.editor.fontLayer.shapes.forEach(function(e){if(i.indexOf(e)<0)t.push(e)});var r=this.editor.referenceLineLayer.shapes,o=[],a=[];r.forEach(function(e){if(void 0!==e.p0.x)o.push(e.p0.x);if(void 0!==e.p0.y)a.push(e.p0.y)}),this.editor.sorption.clear(),t.length&&this.editor.sorption.addShapes(t),o.length&&this.editor.sorption.addXAxis(o),a.length&&this.editor.sorption.addYAxis(a)}},t.prototype.transform=function(e,t,i){if("move"===this.mode)o.call(this,t,i.ctrlKey?!1:i.altKey,i.ctrlKey?!1:i.shiftKey,this.editor.sorption.isEnable());else if("scale"===this.mode)a.call(this,e,t);else if("rotate"===this.mode)s.call(this,e,t)},t.prototype.finishTransform=function(e,t,i){var n=this.coverShapes;if(this.coverShapes=this.shapes,this.transform(e,t,i),this.coverShapes=n,delete this.bound,this.editor.coverLayer.removeShape("bound"),this.editor.coverLayer.removeShape("boundcenter"),this.editor.fontLayer.refresh(),"move"===this.mode&&this.editor.sorption.isEnable())this.editor.coverLayer.removeShape("sorptionX"),this.editor.coverLayer.removeShape("sorptionY"),this.editor.sorption.clear();this.refresh()},t.prototype.setShapes=function(e){var t=this.editor.coverLayer;if(this.shapes)this.shapes=null;if(this.coverShapes)this.coverShapes.forEach(function(e){t.removeShape(e)}),this.coverShapes=null;this.shapes=e,this.coverShapes=n.clone(this.shapes),this.coverShapes.forEach(function(e){e.id="cover-"+e.id,e.selectable=!1,e.style={strokeColor:"red"},t.addShape(e)})},t.prototype.getBound=function(){if(this.shapes.length)return e(this.shapes);else return!1},t.prototype.setMode=function(e){this.mode=e},t.prototype.move=function(e,t){this.shapes.forEach(function(n){i(n.points,1,1,e,t)}),this.editor.fontLayer.refresh(),this.editor.coverLayer.move(e,t),this.editor.coverLayer.refresh()},t.prototype.refresh=function(){this.boundControl.refresh(e(this.shapes),this.mode)},t.prototype.dispose=function(){this.editor.coverLayer.clearShapes(),this.boundControl.dispose(),this.shapes=this.coverShapes=this.boundControl=this.editor=null},t}),define("editor/util/cursor",["require"],function(){return{scale:{1:"nw-resize",2:"ne-resize",3:"se-resize",4:"sw-resize",5:"s-resize",6:"e-resize",7:"n-resize",8:"w-resize"},rotate:{1:"pointer",2:"pointer",3:"pointer",4:"pointer",5:"e-resize",6:"s-resize",7:"w-resize",8:"n-resize"}}}),define("editor/mode/shapes",["require","render/util/guid","../group/ShapesGroup","common/lang","render/util/selectShape","../menu/commandList","../util/cursor"],function(require){function e(e){if(this.currentGroup.shapes.length){this.contextMenu.hide();var t=e.command,i=e.args,n=this.currentGroup.shapes;switch(t){case"topshape":case"bottomshape":case"upshape":case"downshape":this.execCommand(t,n[0]);break;case"joinshapes":case"intersectshapes":case"tangencyshapes":case"rotateleft":case"rotateright":case"flipshapes":case"mirrorshapes":case"cutshapes":case"copyshapes":case"removeshapes":case"reversepoints":this.execCommand(t,n);break;case"alignshapes":case"verticalalignshapes":case"horizontalalignshapes":this.execCommand(t,n,i.align);break;case"addreferenceline":var r=this.currentGroup.getBound();if(r)this.execCommand(t,r.x,r.y),this.execCommand(t,r.x+r.width,r.y+r.height);break;default:if(this.supportCommand(t))this.execCommand(t,e)}}}var t=require("render/util/guid"),i=require("../group/ShapesGroup"),n=require("common/lang"),r=require("render/util/selectShape"),o=require("../menu/commandList"),a=require("../util/cursor"),s={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]},u={down:function(e){var t=this.render,i=t.getLayer("cover").getShapeIn(e);if(i)this.currentPoint=n.clone(i[0]);else{if(this.currentPoint=null,i=t.getLayer("font").getShapeIn(e)){var o=i[0];if(i.length>1)o=r(i,e);var a=this.currentGroup.shapes.indexOf(o);if(a>=0){if(e.ctrlKey&&!e.altKey)this.currentGroup.shapes.splice(a,1),this.refreshSelected(this.currentGroup.shapes.slice(0)),this.clicked=!1;return}var s=[o];if(e.ctrlKey)s=s.concat(this.currentGroup.shapes);return this.currentGroup.setMode("scale"),this.refreshSelected(s),void(this.clicked=!1)}this.setMode("range")}},dragstart:function(e){if(this.currentPoint)this.currentGroup.beginTransform(this.currentPoint,this.render.camera,e);else{if(e.ctrlKey&&e.altKey){var i=n.clone(this.currentGroup.shapes),r=this.fontLayer;i.forEach(function(e){e.id=t("shape"),r.addShape(e)}),this.currentGroup.setShapes(i)}this.currentGroup.setMode("move"),this.currentGroup.beginTransform(this.currentPoint,this.render.camera,e)}},drag:function(e){if(this.currentGroup)this.currentGroup.transform(this.currentPoint,this.render.camera,e)},dragend:function(e){if(this.currentPoint)this.currentGroup.finishTransform(this.currentPoint,this.render.camera,e),this.currentPoint=null,this.fire("change");else if("move"===this.currentGroup.mode)this.currentGroup.finishTransform(this.currentPoint,this.render.camera,e),this.currentGroup.setMode("scale"),this.fire("change");this.render.setCursor("default")},move:function(e){var t=this.coverLayer.getShapeIn(e),i=this.currentGroup.mode;if(t&&"move"!==i)this.render.setCursor(a[this.currentGroup.mode][t[0].pos]||"default");else this.render.setCursor("default")},rightdown:function(t){this.contextMenu.onClick=n.bind(e,this),this.contextMenu.show(t,this.currentGroup.shapes.length>1?o.shapes:o.shape)},click:function(){if(this.clicked){var e=this.currentGroup.mode;this.currentGroup.setMode("scale"===e?"rotate":"scale"),this.currentGroup.refresh()}this.clicked=!0},keyup:function(e){if("delete"===e.key)this.execCommand("removeshapes",this.currentGroup.shapes),this.setMode();else if(65===e.keyCode&&e.ctrlKey)this.currentGroup.setShapes(this.fontLayer.shapes.slice()),this.currentGroup.refresh();else if(s[e.key])this.fire("change");else if("esc"===e.key)this.setMode()},keydown:function(e){if(88===e.keyCode&&e.ctrlKey){if(this.currentGroup.shapes.length)this.execCommand("cutshapes",this.currentGroup.shapes)}else if(67===e.keyCode&&e.ctrlKey)if(this.currentGroup.shapes.length)this.execCommand("copyshapes",this.currentGroup.shapes);if(s[e.key])this.currentGroup.move(s[e.key][0],s[e.key][1])},begin:function(e,t){if(this.currentGroup=new i(e,this),this.currentGroup.refresh(),this.currentGroup.setMode("scale"),"bound"===t)this.clicked=!1;else this.clicked=!0;this.fire("selection:change",{shapes:e})},end:function(){this.currentPoint=null,this.currentGroup.dispose(),this.currentGroup=null,this.render.setCursor("default"),this.fire("selection:change")}};return u}),define("editor/mode/addshapes",["require","graphics/pathAdjust","graphics/computeBoundingBox","common/lang"],function(require){var e=require("graphics/pathAdjust"),t=require("graphics/computeBoundingBox"),i=require("common/lang"),n={down:function(e){if(1===e.which){this.coverLayer.clearShapes();for(var i=0,n=this.curShapes.length;n>i;i++)this.coverLayer.addShape("path",{points:[]});this.curBound=t.computePath.apply(null,this.curShapes)}},drag:function(t){if(1===t.which)if(this.curShapes){var n=t.startX,r=t.startY,o=t.x-t.startX,a=t.y-t.startY,s=o/this.curBound.width,u=a/this.curBound.height;if(t.shiftKey){var f=Math.min(Math.abs(s),Math.abs(u));s=s>0?f:-f,u=u>0?f:-f}for(var h=this.curShapes,c=this.coverLayer.shapes,d=0,l=h.length;l>d;d++){var p=i.clone(h[d]);e(p,s,u),e(p,1,1,n,r),c[d].points=p}this.coverLayer.refresh()}},dragend:function(e){if(1===e.which){if(this.curShapes){for(var t=this.fontLayer,n=i.clone(this.coverLayer.shapes),r=0,o=n.length;o>r;r++)t.addShape(n[r]);return t.refresh(),this.fire("change"),void this.setMode("shapes",n)}this.setMode()}},begin:function(e){this.render.setCursor("crosshair"),this.curShapes=e},end:function(){this.curShapes=this.curBound=null,this.coverLayer.clearShapes(),this.coverLayer.refresh(),this.render.setCursor("default")}};return n}),define("editor/mode/addpath",["require"],function(){var e={click:function(e){var t=this.coverLayer,i=t.getShapeIn(e);if(i[0]&&this.points.length>1&&i[0]===this.points[0]){var n=this.points.map(function(e){return{x:e.x,y:e.y,onCurve:!0}}),r=this.fontLayer.addShape("path",{points:n});this.fontLayer.refresh(),this.fire("change"),this.setMode("shapes",[r])}else{var o=e.x,a=e.y;if(this.points.length){var s=this.points[this.points.length-1];if(e.shiftKey)a=s.y;if(e.altKey)o=s.x}var u=t.addShape({type:"point",x:o,y:a});if(0===this.points.length)u.style={strokeColor:"red"};else{var f=this.points[this.points.length-1];t.addShape({type:"line",p0:{x:f.x,y:f.y},p1:{x:u.x,y:u.y}})}this.dashedLine.p0.x=u.x,this.dashedLine.p0.y=u.y,this.points.push(u),t.refresh()}},move:function(e){var t=this.coverLayer.getShapeIn(e);if(t[0]&&t[0]===this.points[0])this.render.setCursor("pointer");else this.render.setCursor("crosshair");var i=e.x,n=e.y;if(this.points.length){var r=this.points[this.points.length-1];if(e.shiftKey)n=r.y;if(e.altKey)i=r.x}this.dashedLine.p1.x=i,this.dashedLine.p1.y=n,this.dashedLine.disabled=!1,this.coverLayer.refresh()},begin:function(){this.coverLayer.clearShapes(),this.points=[],this.dashedLine=this.coverLayer.addShape({type:"line",dashed:!0,disabled:!0,selectable:!1,p0:{},p1:{}}),this.render.setCursor("crosshair")},end:function(){this.points=this.dashedLine=null,this.coverLayer.clearShapes(),this.coverLayer.refresh(),this.render.setCursor("default")}};return e}),define("editor/mode/split",["require"],function(){var e={down:function(e){if(1===e.which)this.coverLayer.clearShapes(),this.splitLine=this.coverLayer.addShape({type:"line",p0:{x:e.x,y:e.y},p1:{x:e.x,y:e.y}})},move:function(e){if(1===e.which)if(this.splitLine)this.splitLine.p1.x=e.x,this.splitLine.p1.y=e.y,this.coverLayer.refresh()},up:function(e){if(1===e.which){if(this.splitLine){var t=this.splitLine.p0,i=this.splitLine.p1;if(Math.abs(t.x-i.x)>=20||Math.abs(t.y-i.y)>=20)if(!1!==this.execCommand("splitshapes",t,i))return}this.setMode()}},begin:function(){},end:function(){delete this.splitLine,this.coverLayer.clearShapes(),this.coverLayer.refresh()}};return e}),define("editor/mode/support",["require","./point","./range","./pan","./bound","./shapes","./addshapes","./addpath","./split","./referenceline"],function(require){return{point:require("./point"),range:require("./range"),pan:require("./pan"),"default":require("./bound"),shapes:require("./shapes"),addshapes:require("./addshapes"),addpath:require("./addpath"),split:require("./split"),referenceline:require("./referenceline")}}),define("editor/widget/ContextMenu",["require"],function(){function e(e,t){var i=document.createElement("ul");return i.className=t.className||"editor-contextmenu",i.style.position="absolute",i.style.zIndex=t.zIndex||1e3,i.style.display="none",e.appendChild(i),i}function t(t,i){this.container=t||document.body,this.main=e(this.container,i||{}),this.commands={};var n=this;n._commandClick=function(e){var t=e.target.getAttribute("data-id"),i=e.target.getAttribute("data-super");if(t){var r=(i?n.commands[i].items:n.commands)[t],o={command:r.name,args:r,pos:n.pos};n.onClick&&n.onClick(o)}},n.main.addEventListener("click",n._commandClick,!1),n._hideClick=function(){n.hide()}}return t.prototype.setCommands=function(e){var t="";e.forEach(function(e,i){if(e.items)t+='<li data-sub="'+i+'">',t+="<ul>",e.items.forEach(function(e,n){t+='<li data-super="'+i+'" data-id="'+n+'"'+(e.selected?' data-tag="selected"':"")+">"+e.title+"</li>"}),t+="</ul>",t+=e.title+"</li>";else t+='<li data-id="'+i+'"'+(e.selected?' data-tag="selected"':"")+">"+e.title+"</li>"}),this.commands=e,this.main.innerHTML=t},t.prototype.show=function(e,t){if(t)this.setCommands(t);this.main.style.display="block";var i=this.container.clientWidth,n=this.container.clientHeight,r=this.main.offsetWidth,o=this.main.offsetHeight,a=e.x+r>i?i-r:e.x,s=e.y+o>n?n-o:e.y;this.main.style.left=a+"px",this.main.style.top=s+"px",this.pos=e,this.container.addEventListener("click",this._hideClick)},t.prototype.hide=function(){this.main.style.display="none",this.onClick=null,this.container.removeEventListener("click",this._hideClick)},t.prototype.visible=function(){return"none"!==this.main.style.display},t.prototype.dispose=function(){this.hide(),this.main.removeEventListener("click",this._commandClick),this.container.removeEventListener("click",this._hideClick),this._commandClick=this._hideClick=null,this.main.remove(),this.main=this.container=this.pos=null,this.onClick=null},t}),define("editor/command/shape",["require","graphics/computeBoundingBox","graphics/pathAdjust"],function(require){var e=require("graphics/computeBoundingBox"),t=require("graphics/pathAdjust");return{removeshapes:function(e){var t=this.fontLayer;e.forEach(function(e){t.removeShape(e)}),t.refresh(),this.refreshSelected([]),this.setMode()},reversepoints:function(e){e.forEach(function(e){e.points=e.points.reverse()}),this.fontLayer.refresh()},topshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.push(e)},bottomshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.unshift(e)},upshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.splice(t+1,0,e)},downshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.splice(t-1,0,e)},cutshapes:function(e){var t=this.getShapes(e);this.setClipBoard(t);var i=this.fontLayer;e.forEach(function(e){i.removeShape(e)}),i.refresh(),this.refreshSelected([])},copyshapes:function(e){e=this.getShapes(e),this.setClipBoard(e)},pasteshapes:function(i,n){if(!i||!i.length)return!1;if(n){var r=e.computePath.apply(null,i.map(function(e){return e.points})),o=this.axis,a=this.render.camera.scale,s=(n.x-o.x)/a,u=(o.y-n.y)/a;i.forEach(function(e){t(e.points,1,1,s-r.x,u-r.y-r.height)})}this.setShapes(i),this.setMode("shapes",i)},addshapes:function(e){this.setShapes(e),this.fontLayer.refresh()}}}),define("editor/command/transform",["require","graphics/computeBoundingBox","graphics/pathRotate","graphics/pathAdjust"],function(require){function e(e,t){if(!t)return!1;var r=e.map(function(e){return e.points}),o=i.computePath.apply(null,r),a=o.x+o.width/2,s=o.y+o.height/2;r.forEach(function(e){n(e,t,a,s)})}function t(e,t,n){var o=e.map(function(e){return e.points}),a=i.computePath.apply(null,o),s=a.x,u=a.y,f=a.width,h=a.height;if(-1===t)o.forEach(function(e){r(e,-1,1,-s,0),r(e,1,1,s+f,0),e.reverse()});if(-1===n)o.forEach(function(e){r(e,1,-1,0,-u),r(e,1,1,0,u+h),e.reverse()})}var i=require("graphics/computeBoundingBox"),n=require("graphics/pathRotate"),r=require("graphics/pathAdjust"),o={rotate:function(t,i){if(!t||!t.length)return!1;var n=e(t,i);if(!1!==n)this.fontLayer.refresh(),this.refreshSelected(t);return n},rotateleft:function(e){return o.rotate.call(this,e,-Math.PI/2)},rotateright:function(e){return o.rotate.call(this,e,Math.PI/2)},flipshapes:function(e){if(!e||!e.length)return!1;else return t(e,1,-1),this.fontLayer.refresh(),void this.refreshSelected(e)},mirrorshapes:function(e){if(!e||!e.length)return!1;else return t(e,-1,1),this.fontLayer.refresh(),void this.refreshSelected(e)}};return o}),define("editor/command/align",["require","graphics/computeBoundingBox","graphics/pathAdjust"],function(require){var e=require("graphics/computeBoundingBox"),t=require("graphics/pathAdjust"),i={alignshapes:function(i,n){if(!i||!i.length)return!1;var r=i.map(function(e){return e.points}),o=e.computePath.apply(null,r);o.x1=o.x+o.width,o.y1=o.y+o.height,o.xc=o.x+o.width/2,o.yc=o.y+o.height/2;var a,s;r.forEach(function(i){var r=e.computePath(i);if(a=0,s=0,"left"===n)a=o.x-r.x;else if("center"===n)a=o.xc-r.x-r.width/2;else if("right"===n)a=o.x1-r.x-r.width;else if("top"===n)s=o.y-r.y;else if("middle"===n)s=o.yc-r.y-r.height/2;else if("bottom"===n)s=o.y1-r.y-r.height;t(i,1,1,a,s)}),this.fontLayer.refresh(),this.refreshSelected(i)},verticalalignshapes:function(i,n){if(!i||!i.length)return!1;var r=i.map(function(e){return e.points}),o=this.axis.metrics,a=this.axis.y,s=a-o.ascent,u=a-o.descent,f=(s+u)/2,h=e.computePath.apply(null,r),c=0;if("ascent"===n)c=s-h.y;else if("middle"===n)c=f-h.y-h.height/2;else if("descent"===n)c=u-h.y-h.height;else if("baseline"===n)c=a-h.y-h.height;r.forEach(function(e){t(e,1,1,0,c)}),this.fontLayer.refresh(),this.refreshSelected(i)},horizontalalignshapes:function(i,n){if(!i||!i.length)return!1;var r=i.map(function(e){return e.points}),o=this.axis.x,a=this.rightSideBearing.p0.x,s=e.computePath.apply(null,r),u=0;if("left"===n)u=o-s.x;else if("center"===n)u=(o+a)/2-s.x-s.width/2;else if("right"===n)u=a-s.x-s.width;r.forEach(function(e){t(e,1,1,u,0)}),this.fontLayer.refresh(),this.refreshSelected(i)}};return i}),define("math/getBezierQ2Point",["require"],function(){function e(e,t,i,n){return{x:e.x*Math.pow(1-n,2)+2*t.x*n*(1-n)+i.x*Math.pow(n,2),y:e.y*Math.pow(1-n,2)+2*t.y*n*(1-n)+i.y*Math.pow(n,2)}}return e}),define("math/getBezierQ2T",["require","math/bezierQ2Equation","./getBezierQ2Point"],function(require){function e(e,n,r,o){if(Math.abs(o.x-e.x)<.001&&Math.abs(o.y-e.y)<.001)return 0;else if(Math.abs(o.x-r.x)<.001&&Math.abs(o.y-r.y)<.001)return 1;var a=t(e.x+r.x-2*n.x+e.y+r.y-2*n.y,2*(n.x-e.x)+2*(n.y-e.y),e.x+e.y-o.x-o.y);if(!a)return!1;for(var s=!1,u=0,f=a.length;f>u;u++){var h=i(e,n,r,a[u]);if(Math.abs(h.x-o.x)<.001&&Math.abs(h.y-o.y)<.001){s=a[u];break}}return s}var t=require("math/bezierQ2Equation"),i=require("./getBezierQ2Point");return e}),define("graphics/isOnPath",["require","./pathIterator","math/getBezierQ2T"],function(require){function e(e,n){var r=!1;return t(e,function(e,t,o,a,s){if("L"===e){if(Math.abs((n.y-t.y)*(n.x-o.x)-(n.y-o.y)*(n.x-t.x))<=.001)return r=s,!1}else if("Q"===e)if(!1!==i(t,o,a,n))return r=s,!1}),r}var t=require("./pathIterator"),i=require("math/getBezierQ2T");return e}),define("graphics/isPathOverlap",["require","./computeBoundingBox","./isOnPath","./isBoundingBoxCross","./pathUtil","./pathIterator","math/getBezierQ2Point"],function(require){function e(e,t){var i={};t.forEach(function(e){i[s(e)]=!0});var n=0;return e.forEach(function(e){if(i[s(e)])n++}),n===e.length}function t(e,t){var i,n,o,a=0;return f(e,function(e,s,u,f){if("L"===e){if(i=r(t,s),n=r(t,u),o=r(t,{x:(s.x+u.x)/2,y:(s.y+u.y)/2}),!1===i||!1===n||!1===o||!t[i].onCurve||!t[n].onCurve||!t[o].onCurve)return!1;a++}else if("Q"===e){if(i=r(t,s),n=r(t,f),o=r(t,h(s,u,f,.5)),!1===i||!1===n||!1===o||t[i].onCurve||t[n].onCurve||t[o].onCurve)return!1;a++}}),a===e.length}function i(i,r,a,s){if(a=a||n.computePath(i),s=s||n.computePath(r),o(a,s)){if(u(i)===u(r))return 2;if(r.length<i.length){var f=r;r=i,i=f}if(e(i,r)||e(r,i))return 1;if(t(i,r)||t(r,i))return 1}return 0}var n=require("./computeBoundingBox"),r=require("./isOnPath"),o=require("./isBoundingBoxCross"),a=require("./pathUtil"),s=a.getPointHash,u=a.getPathHash,f=require("./pathIterator"),h=require("math/getBezierQ2Point");return i}),define("graphics/reducePath",["require"],function(){function e(e,t,i){if((t.onCurve&&i.onCurve||!t.onCurve&&!i.onCurve)&&Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)<=1)return!0;if(t.onCurve&&e.onCurve&&i.onCurve&&Math.abs((i.y-t.y)*(e.x-t.x)-(e.y-t.y)*(i.x-t.x))<=.001)return!0;else return!1}function t(t){if(!t.length)return t;for(var i,n,r,o=t.length-1,a=o;o>=0;o--)if(r=t[o],n=o===a?t[0]:t[o+1],i=0===o?t[a]:t[o-1],!e(i,r,n));else t.splice(o,1),a--;return t}return t}),define("graphics/join/relation",["require"],function(){return{join:1,intersect:2,tangency:4}}),define("math/bezierQ2Split",["require","./getBezierQ2T","./getBezierQ2Point"],function(require){function e(e,n,r,o){var a,s;if("number"==typeof o)a=o,s=i(e,n,r,a);else if("object"==typeof o)if(s=o,a=t(e,n,r,s),!1===a)return!1;if(0===a||1===a)return[[e,n,r]];else return[[e,{x:e.x+(n.x-e.x)*a,y:e.y+(n.y-e.y)*a},s],[s,{x:n.x+(r.x-n.x)*a,y:n.y+(r.y-n.y)*a},r]]}var t=require("./getBezierQ2T"),i=require("./getBezierQ2Point");return e}),define("graphics/join/pathSplit",["require","math/bezierQ2Split","math/getBezierQ2T"],function(require){function e(e,t){var i=e.length;return t.sort(function(t,r){if(t.index!==r.index)return t.index-r.index;var o=e[t.index],a=t.index===i-1?e[0]:e[t.index+1];if(o.onCurve&&a.onCurve)return Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2)-(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2));else if(!o.onCurve){var s=0===t.index?e[i-1]:e[t.index-1],u=n(s,o,a,t),f=n(s,o,a,r);return u===f?0:f>u?-1:1}})}function t(t,n){n=e(t,n);var r,o,a=0;for(r=0,o=n.length;o>r;r++){var s=t.length,u=n[r];u.index+=a;var f=u.index,h=f===s-1?0:f+1;if(t[f].onCurve&&t[h].onCurve){if(Math.abs(t[f].x-u.x)<.001&&Math.abs(t[f].y-u.y)<.001){u.index=f;continue}if(Math.abs(t[h].x-u.x)<.001&&Math.abs(t[h].y-u.y)<.001){u.index=h;continue}t.splice(f+1,0,{x:u.x,y:u.y,onCurve:!0}),u.index=f+1,a++}else if(!t[f].onCurve){var c=0===f?s-1:f-1;if(Math.abs(t[c].x-u.x)<.001&&Math.abs(t[c].y-u.y)<.001){u.index=c;continue}if(Math.abs(t[h].x-u.x)<.001&&Math.abs(t[h].y-u.y)<.001){u.index=h;continue}var d=i(t[c],t[f],t[h],u);if(!d)throw"can't find bezier split point";t.splice(f,1,d[0][1],{x:u.x,y:u.y,onCurve:!0},d[1][1]),u.index=f+1,a+=2}else throw"joint incorrect"}n.sort(function(e,t){return e.index-t.index});var l,p,g=[];for(r=0,o=n.length-1;o>r;r++)l=n[r],p=n[r+1],g.push(t.slice(l.index,p.index+1));return l=p,p=n[0],g.push(t.slice(l.index).concat(t.slice(0,p.index+1))),g}var i=require("math/bezierQ2Split"),n=require("math/getBezierQ2T");return t}),define("graphics/join/pathCombine",["require","../pathUtil","./relation"],function(require){function e(e){return 31*e.x+e.y}function t(t){var i,n={};return t.forEach(function(t){var r=t.path;if(i=e(r[0]),!n[i])n[i]=[];if(n[i].push(t),i=e(r[r.length-1]),!n[i])n[i]=[];n[i].push(t)}),n}function i(i,n,f){var h=[],c={};[i,n].forEach(function(e){for(var t=0,i=e.length;i>t;t++)if(2===e[t].cross){var n=a(e[t].path);if(!c[n])h.push(e[t]),c[n]=1,c[a(e[t].path.reverse())]=1}else if(f===o.join&&0===e[t].cross)h.push(e[t]);else if(f===o.intersect&&1===e[t].cross)h.push(e[t]);else if(f===o.tangency)h.push(e[t])});for(var d=t(h),l=h.filter(function(e){if(f===o.join||f===o.tangency)return 0===e.cross;else if(f===o.intersect)return 1===e.cross;return!1}),p=[],g=function(t,i){var n=d[e(t)],r=n.indexOf(i);
if(r>=0)if(n.splice(r,1),!n.length)delete d[e(t)]},m=0;m<l.length;m++){for(var y,v=l[m],x=v.path.slice(0,v.path.length-1),w=v.path[0],b=v.path[v.path.length-1],S=0;++S<u&&(Math.abs(w.x-b.x)>.001||Math.abs(w.y-b.y)>.001);){if(y=d[e(b)],!y.length)throw"can't find paths to combine.";var M=null;if(2===y.length&&y[0]===v)M=y[1];else if(2===y.length&&y[1]===v)M=y[0];else{for(var C,E=0,L=y.length;L>E;E++)if(y[E]!==v)if(2===y[E].cross)C=y[E];else if(f===o.tangency&&v.cross!==y[E].cross&&v.origin!==y[E].origin){M=y[E];break}else if(f===o.join&&0===y[E].cross){M=y[E];break}else if(f===o.intersect&&1===y[E].cross){M=y[E];break}if(!M)if(C)C.origin=v.origin,M=C;else break}var k=M.path.slice();if(Math.abs(b.x-M.path[0].x)>.001||Math.abs(b.y-M.path[0].y)>.001)k=k.reverse();if(s.apply(x,[x.length,0].concat(k.slice(0,k.length-1))),b=M.path[M.path.length-1],v=M,f===o.tangency&&2===M.cross);else g(M.path[0],M),g(b,M);var B=l.indexOf(M);if(B>=0)l.splice(B,1)}if(S>=u)throw"can't find paths to combine.";p.push(x)}if(p.length)return p.map(function(e){return r(e)});else return[]}var n=require("../pathUtil"),r=n.deInterpolate,o=require("./relation"),a=n.getPathHash,s=Array.prototype.splice,u=50;return i}),define("graphics/join/getVirtualJoint",["require","../isInsidePath","math/getBezierQ2Point"],function(require){function e(e,n,r){if(!r)return{};var o=0,a=0,s=[],u=-1;return r.forEach(function(r){var f=r.index0;if(f!==u){var h,c,d,l,p,g,m=f,y=f===e.length-1?0:f+1,v=0===f?e.length-1:f-1,x=e[m],w=e[y],b=e[v];if(x.onCurve){if(c=t(n,{x:(x.x+r.x)/2,y:(x.y+r.y)/2}),d=t(n,{x:(w.x+r.x)/2,y:(w.y+r.y)/2}),!c&&!d)o++,r.virtual=!0,s.push(r);else if(Math.abs(m.x-r.x)<.01&&Math.abs(m.y-r.y)<.01){if(!b.onCurve){if(g=v-1===0?e.length-1:v-1,l=e[g],!l.onCurve)l={x:(b.x+l.x)/2,y:(b.y+l.y)/2};b=i(x,b,l,.5)}if(h=t(n,b),h&&d)a++,r.virtual=!0,s.push(r);else if(!h&&!d)o++,r.virtual=!0,s.push(r)}}else{if(Math.abs(b.x-r.x)<.01&&Math.abs(b.y-r.y)<.01)if(d=t(n,i(b,x,w,.5)),p=v-1===0?e.length-1:v-1,e[p].onCurve)h=t(n,e[p]);else g=p-1===0?e.length-1:p-1,h=t(n,i(b,e[p],e[g],.5));else h=t(n,b),d=t(n,w);if(h&&d)a++,s.push(r);else if(!h&&!d)o++,s.push(r)}u=f}}),{inCount:a,outCount:o,points:s}}var t=require("../isInsidePath"),i=require("math/getBezierQ2Point");return e}),define("graphics/join/join2Path",["require","../isPathCross","../isInsidePath","../isPathOverlap","../reducePath","math/getBezierQ2Point","./relation","../pathUtil","./pathSplit","./pathCombine","./getVirtualJoint"],function(require){function e(e,t){if(r(e,t))return 2;var i=n(t,e[1].onCurve?{x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2}:a(e[0],e[1],e[2],.5));return i?1:0}function t(t,n,a){var l=u.isClockWise(t),p=u.isClockWise(n);if(2===r(t,n))if((a===s.join||a===s.intersect)&&l===p)return[t];else return[];var g=f(o(t)),m=f(o(n)),y=i(g,m);if(y){var v=d(g,m,y);if(v.inCount===y.length)y=3;else if(v.outCount===y.length)y=2}var x,w,b=function(i){x=h(g,i.map(function(e){return e.index=e.index0,e}));var r=!1,o=-1,u=!1,f=!1;if(x=x.map(function(i){var a={};if(a.path=i,a.cross=e(i,n),a.direction=l,a.origin=t,a.cross)r=!0;if(2===a.cross)f=!0;if(o===a.cross&&0===o)u=!0;return o=a.cross,a}),!r)if(a===s.join||a===s.tangency)return[t,n];else if(a===s.intersect)return[];if(w=h(m,i.map(function(e){return e.index=e.index1,e})),u)return[t,n];if(!f){var d=e(w[0],t);w=w.map(function(e){var t={};return t.path=e,t.cross=d?1:0,t.direction=p,t.origin=m,d=!d,t})}else w=w.map(function(i){var n={};return n.path=i,n.cross=e(i,t),n.direction=p,n.origin=m,n});if(a===s.join&&l!==p)a=s.tangency;if(a===s.intersect&&l!==p)return[];else return x.direction=l,w.direction=p,c(x,w,a)};if(a===s.join||a===s.tangency){if(!y)return[t,n];else if(2===y)if(l===p)return[t];else return[t,n];else if(3===y)if(l===p)return[n];else return[t,n];return b(y)}else if(a===s.intersect){if(!y)return[];else if(2===y)if(l===p)return[n];else return[];else if(3===y)if(l===p)return[t];else return[];return b(y)}return[t,n]}var i=require("../isPathCross"),n=require("../isInsidePath"),r=require("../isPathOverlap"),o=require("../reducePath"),a=require("math/getBezierQ2Point"),s=require("./relation"),u=require("../pathUtil"),f=u.interpolate,h=require("./pathSplit"),c=require("./pathCombine"),d=require("./getVirtualJoint");return t}),define("graphics/pathJoin",["require","./join/join2Path","./join/relation"],function(require){function e(e,n){if(1===e.length)if(n===i.intersect)return[];else return e;else if(2===e.length)return t(e[0],e[1],n);for(var r,o=[e[0]],a=e.slice(1),s=0,u=function(e){e.joinFlag=(e.joinFlag||0)+(1<<s),a.push(e)};r=a.shift();){for(var f=0,h=o.length;h>f;f++)if(!(r.joinFlag&&o[f].joinFlag&&r.joinFlag&o[f].joinFlag)){var c=t(r,o[f],n);if(n===i.intersect&&!c.length)return[];if(2!==c.length||c[0]!==r||c[1]!==o[f]){o.splice(f,1),s++,c.forEach(u);break}else;}else;if(f===h)o.push(r);else if(!o.length)o.push(a.shift())}return o}var t=require("./join/join2Path"),i=require("./join/relation");return e.Relation=i,e}),define("graphics/join/getSegmentPathJoint",["require","./getJoint"],function(require){var e=require("./getJoint");return function(t,i,n,r){return e(t,"L",i,n,0,r||0)}}),define("graphics/isBoundingBoxSegmentCross",["require","./util","./isSegmentCross"],function(require){function e(e,n,r){if(t(e,n)||t(e,r))return!0;if(i(e,{x:e.x,y:e.y+e.height},n,r)||i(e,{x:e.x+e.width,y:e.y},n,r)||i({x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},n,r)||i({x:e.x,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height},n,r))return!0;else return!1}var t=require("./util").isPointInBound,i=require("./isSegmentCross");return e}),define("graphics/pathSplitBySegment",["require","./computeBoundingBox","./join/getSegmentPathJoint","./join/pathSplit","./isBoundingBoxSegmentCross","./pathUtil"],function(require){function e(e,u,f){var h=t.computePath(e);if(!r(h,u,f))return!1;e=a(e);var c=i(e,u,f);if(c&&c.length>1){var d=n(e,c.map(function(e){return e.index=e.index1,e})),l=d.length-1;d[l].direction=o.isClockWise(d[l]);for(var p=l-1;p>0;p--)if(d[p].direction=o.isClockWise(d[p]),d[p].direction!==d[p+1].direction){var g=p===l-1?0:p+2,m=d[g].concat(d[p]);if(m.direction=d[p+1].direction,0===g)d[0]=m,d.splice(p,1);else d[p]=m,d.splice(g,1)}return d.map(function(e){return s(e)})}return!1}var t=require("./computeBoundingBox"),i=require("./join/getSegmentPathJoint"),n=require("./join/pathSplit"),r=require("./isBoundingBoxSegmentCross"),o=require("./pathUtil"),a=o.interpolate,s=o.deInterpolate;return e}),define("editor/command/join",["require","graphics/pathJoin","common/lang","graphics/pathSplitBySegment"],function(require){function e(e,n){var r,o,a=e.map(function(e){return e.points}),s=t(a,n),u=!1;if(s.length===a.length){for(r=0,o=s.length;o>r;r++)if(s[r]!==a[r]){u=!0;break}}else u=!0;if(u){var f=this.fontLayer,h=s.length,c=e.length,d=Math.min(h,c);for(r=0;d>r;r++)e[r].points=i.clone(s[r]);if(c>d){for(r=d;c>r;r++)f.removeShape(e[r]);e.splice(d,c-d)}if(h>d)for(r=d;h>r;r++){var l=f.addShape("path",{points:s[r]});e.push(l)}f.refresh()}return e}var t=require("graphics/pathJoin"),i=require("common/lang"),n=require("graphics/pathSplitBySegment"),r={joinshapes:function(i){e.call(this,i,t.Relation.join),this.refreshSelected(i)},intersectshapes:function(i){e.call(this,i,t.Relation.intersect),this.refreshSelected(i)},tangencyshapes:function(i){e.call(this,i,t.Relation.tangency),this.refreshSelected(i)},splitshapes:function(e,t){for(var r=this.fontLayer.shapes,o=[],a=r.length-1;a>=0;a--){var s=n(r[a].points,e,t);if(s){var u=r[a].id;r.splice(a,1);for(var f=0,h=s.length;h>f;f++){var c=s[f],d={type:"path",id:u+"-"+f,points:i.clone(c)};r.push(d),o.push(d)}}}if(o.length)this.fontLayer.refresh(),this.setMode("shapes",o);else return!1}};return r}),define("editor/command/referenceline",["require"],function(){return{addreferenceline:function(e,t){if(e>20)this.referenceLineLayer.addShape("line",{p0:{x:e}});if(t>20)this.referenceLineLayer.addShape("line",{p0:{y:t}});this.referenceLineLayer.refresh()},removereferenceline:function(e,t){var i=[];if("object"==typeof e)i.push(e);var n=this.referenceLineLayer,r=this.rightSideBearing;if(e>20||t>20){var o=this.referenceLineLayer.getShapeIn(e,t);i=i.concat(o)}i=i.filter(function(e){return e!==r}),i.forEach(function(e){n.removeShape(e)}),n.refresh()},clearreferenceline:function(){var e=this.referenceLineLayer,t=this.rightSideBearing,i=e.shapes.filter(function(e){return"line"===e.type&&e!==t});i.forEach(function(t){e.removeShape(t)}),e.refresh()}}}),define("editor/shapes/circle",["require"],function(){return[[{x:383,y:0},{x:207,y:75},{x:75,y:208},{x:0,y:384},{x:0,y:583},{x:75,y:760},{x:207,y:891},{x:383,y:966},{x:582,y:966},{x:758,y:891},{x:890,y:760},{x:965,y:583},{x:965,y:384},{x:890,y:208},{x:758,y:75},{x:582,y:0}]]}),define("editor/shapes/rect",["require"],function(){return[[{x:0,y:0,onCurve:!0},{x:200,y:0,onCurve:!0},{x:200,y:200,onCurve:!0},{x:0,y:200,onCurve:!0}]]}),define("editor/shapes/roundrect",["require"],function(){return[[{x:615,y:573,onCurve:!0},{x:615,y:591},{x:591,y:615},{x:573,y:615,onCurve:!0},{x:42,y:615,onCurve:!0},{x:24,y:615},{x:14,y:601,onCurve:!0},{x:0,y:591},{x:0,y:573,onCurve:!0},{x:0,y:42,onCurve:!0},{x:0,y:24},{x:14,y:14,onCurve:!0},{x:24,y:0},{x:42,y:0,onCurve:!0},{x:573,y:0,onCurve:!0},{x:591,y:0},{x:601,y:14,onCurve:!0},{x:615,y:24},{x:615,y:42,onCurve:!0},{x:615,y:573,onCurve:!0}]]}),define("editor/shapes/arrow",["require"],function(){return[[{x:1,y:380,onCurve:!0},{x:1,y:423},{x:43,y:453},{x:88,y:453,onCurve:!0},{x:109,y:453},{x:197,y:452},{x:296,y:452},{x:390,y:451},{x:418,y:451,onCurve:!0},{x:457,y:450},{x:502,y:465},{x:502,y:493,onCurve:!0},{x:502,y:513},{x:505,y:570},{x:505,y:590,onCurve:!0},{x:506,y:626},{x:545,y:646},{x:575,y:621,onCurve:!0},{x:605,y:596},{x:687,y:529},{x:775,y:458},{x:859,y:390},{x:892,y:364,onCurve:!0},{x:922,y:339},{x:923,y:295},{x:894,y:272,onCurve:!0},{x:864,y:247},{x:783,y:184},{x:696,y:116},{x:612,y:50},{x:580,y:24,onCurve:!0},{x:544,y:-5},{x:498,y:10},{x:499,y:47,onCurve:!0},{x:499,y:71,onCurve:!0},{x:499,y:101,onCurve:!0},{x:499,y:116},{x:498,y:146},{x:498,y:158,onCurve:!0},{x:498,y:184},{x:467,y:197},{x:440,y:197,onCurve:!0},{x:411,y:197},{x:314,y:198},{x:210,y:198},{x:112,y:199},{x:81,y:199,onCurve:!0},{x:68,y:199},{x:39,y:204},{x:15,y:219},{x:1,y:246},{x:1,y:270,onCurve:!0},{x:1,y:297},{x:0,y:349}]]}),define("editor/shapes/star",["require"],function(){return[[{x:994,y:426,onCurve:!0},{x:1008,y:411},{x:1025,y:390},{x:1025,y:375,onCurve:!0},{x:1025,y:360},{x:1009,y:346},{x:988,y:341,onCurve:!0},{x:673,y:311,onCurve:!0},{x:559,y:38,onCurve:!0},{x:557,y:34},{x:550,y:21},{x:539,y:9},{x:524,y:0},{x:514,y:0,onCurve:!0},{x:495,y:0},{x:472,y:23},{x:466,y:40,onCurve:!0},{x:349,y:313,onCurve:!0},{x:34,y:342,onCurve:!0},{x:22,y:344},{x:4,y:360},{x:0,y:389},{x:17,y:416},{x:29,y:427,onCurve:!0},{x:30,y:428},{x:51,y:446},{x:83,y:473},{x:122,y:507},{x:143,y:524,onCurve:!0},{x:191,y:565},{x:251,y:617,onCurve:!0},{x:231,y:697},{x:216,y:760,onCurve:!0},{x:209,y:787},{x:196,y:840},{x:186,y:884},{x:177,y:916},{x:176,y:920,onCurve:!0},{x:174,y:929},{x:182,y:946},{x:200,y:959},{x:221,y:962},{x:231,y:957,onCurve:!0},{x:237,y:955},{x:266,y:938},{x:307,y:914},{x:357,y:885},{x:382,y:871,onCurve:!0},{x:442,y:837},{x:514,y:795,onCurve:!0},{x:780,y:950,onCurve:!0},{x:785,y:952},{x:805,y:959},{x:810,y:959,onCurve:!0},{x:825,y:959},{x:849,y:945},{x:846,y:925,onCurve:!0},{x:845,y:921},{x:839,y:889},{x:830,y:844},{x:820,y:789},{x:814,y:762,onCurve:!0},{x:801,y:697},{x:783,y:616,onCurve:!0}]]}),define("editor/shapes/support",["require","./circle","./rect","./roundrect","./arrow","./star"],function(require){return{circle:require("./circle"),rect:require("./rect"),roundrect:require("./roundrect"),arrow:require("./arrow"),star:require("./star")}}),define("editor/menu/util",["require"],function(){var e={setSelected:function(e,t,i){for(var n=t.split("."),r=0,o=e.length;o>r;r++)if(e[r].name===n[0])if(!e[r].items)return e[r].selected=!!i,!0;else if(n[1])for(var a=e[r].items,s=0,u=a.length;u>s;s++)if(a[s].name===n[1])return a[s].selected=!!i,!0;return!1}};return e}),define("editor/command/editor",["require","common/lang","graphics/computeBoundingBox","../menu/commandList","../shapes/support","../menu/util"],function(require){var e=require("common/lang"),t=require("graphics/computeBoundingBox"),i=require("../menu/commandList"),n=require("../shapes/support"),r=require("../menu/util");return{rescale:function(){this.coverLayer.clearShapes();var e=this.render.getSize(),t=512/this.options.unitsPerEm;this.render.scaleTo(t,{x:e.width/2,y:e.height/2}),this.setMode()},undo:function(){var e=this.history.back();this.fontLayer.shapes.length=0,this.setShapes(e),this.setMode()},redo:function(){var e=this.history.forward();this.fontLayer.shapes.length=0,this.setShapes(e),this.setMode()},gridsorption:function(e){r.setSelected(i.editor,"setting.gridsorption",!!e),this.options.sorption.enableGrid=this.sorption.enableGrid=!!e},shapesorption:function(e){r.setSelected(i.editor,"setting.shapesorption",!!e),this.options.sorption.enableShape=this.sorption.enableShape=!!e},showgrid:function(e){r.setSelected(i.editor,"setting.showgrid",!!e),this.options.axis.showGrid=this.axis.showGrid=!!e,this.axisLayer.refresh()},moresetting:function(){this.fire("setting:editor",{setting:this.options})},addpath:function(){this.setMode("addpath")},addsupportshapes:function(t){if(n[t])this.setMode("addshapes",e.clone(n[t]))},fontsetting:function(){var e=t.computePathBox.apply(null,this.fontLayer.shapes.map(function(e){return e.points})),i=0,n=0;if(e){var r=this.render.camera.scale;i=(e.x-this.axis.x)/r,n=(this.rightSideBearing.p0.x-e.x-e.width)/r}this.fire("setting:font",{setting:{leftSideBearing:Math.round(i),rightSideBearing:Math.round(n||0),unicode:this.font.unicode,name:this.font.name}})}}}),define("editor/command/support",["require","common/lang","./shape","./transform","./align","./join","./referenceline","./editor"],function(require){var e=require("common/lang"),t={};return e.extend(t,require("./shape")),e.extend(t,require("./transform")),e.extend(t,require("./align")),e.extend(t,require("./join")),e.extend(t,require("./referenceline")),e.extend(t,require("./editor")),t}),define("editor/widget/clipboard",["require"],function(){var e=window.localStorage,t="clipboard.default",i={set:function(i,n){e.setItem(t,JSON.stringify({type:n||-9999,data:i}))},get:function(i){var n=e.getItem(t);if(null!==n)if(n=JSON.parse(n),n.type===i)return n.data;return null},clear:function(){e.removeItem(t)}};return i}),define("editor/widget/History",["require","common/lang"],function(require){function e(e){e=e||{},this.maxRecord=e.maxRecord||200,this.queue=[],this.index=0}var t=require("common/lang");return e.prototype.add=function(e){if(this.queue.splice(this.index+1,this.maxRecord),this.queue.push(e),this.queue.length>this.maxRecord)this.queue.shift();this.index=this.queue.length-1},e.prototype.get=function(e){return e=e||this.index,t.clone(this.queue[e])},e.prototype.forward=function(){if(this.index<this.queue.length-1)this.index++;return t.clone(this.queue[this.index])},e.prototype.back=function(){if(this.index>0)this.index--;return t.clone(this.queue[this.index])},e.prototype.atFirst=function(){return 0===this.index},e.prototype.atLast=function(){var e=this.queue.length;return 0===e||this.index===e-1},e.prototype.reset=function(){delete this.queue,this.queue=[],this.index=0},e}),define("editor/widget/Sorption",["require","graphics/computeBoundingBox"],function(require){function e(e,t,i){for(var n,r,o=0,a=e.length-1;a>=o;)if(n=o+a>>1,r=e[n].axis,Math.abs(t-r)<i)return e[n];else if(r>t)a=n-1;else o=n+1;return!1}function t(e){this.gridDelta=e.gridDelta||5,this.delta=e.delta||5,this.enableGrid=e.enableGrid||!1,this.enableShape=e.enableShape||!0,this.xAxis=[],this.yAxis=[]}var i=require("graphics/computeBoundingBox");return t.prototype.setGrid=function(e){this.axis=e},t.prototype.addShapes=function(e){for(var t=this.xAxis,n=this.yAxis,r=e.length-1;r>=0;r--){var o=i.computePath(e[r].points),a=o.x+o.width/2,s=o.y+o.height/2;t.push({axis:o.x,y:s}),t.push({axis:a,y:s}),t.push({axis:o.x+o.width,y:s}),n.push({axis:o.y,x:a}),n.push({axis:s,x:a}),n.push({axis:o.y+o.height,x:a})}t.sort(function(e,t){return e.axis-t.axis}),n.sort(function(e,t){return e.axis-t.axis})},t.prototype.addXAxis=function(e){var t=this.xAxis;e.forEach(function(e){t.push({axis:e,y:0})}),t.sort(function(e,t){return e.axis-t.axis})},t.prototype.addYAxis=function(e){var t=this.yAxis;e.forEach(function(e){t.push({axis:e,x:0})}),t.sort(function(e,t){return e.axis-t.axis})},t.prototype.detectX=function(t){if(this.enableShape){var i=e(this.xAxis,t,this.delta);if(i)return i}if(this.enableGrid){var n=(t-this.axis.x)%this.axis.gap;if(Math.abs(n)<this.gridDelta)return{axis:t-n,y:0}}return!1},t.prototype.detectY=function(t){if(this.enableShape){var i=e(this.yAxis,t,this.delta);if(i)return i}if(this.enableGrid){var n=(t-this.axis.y)%this.axis.gap;if(Math.abs(n)<this.gridDelta)return{axis:t-n,x:0}}return!1},t.prototype.isEnable=function(){return this.enableShape||this.enableGrid},t.prototype.clear=function(){this.xAxis.length=0,this.yAxis.length=0},t.prototype.dispose=function(){this.clear(),this.axis=null,this.xAxis=this.yAxis=null},t}),define("editor/util/getFontHash",["require"],function(){function e(e){var t=Array.prototype.splice,i=[e.advanceWidth||0];if(e.contours&&e.contours.length)e.contours.forEach(function(e){e.forEach(function(e){i.push(e.x),i.push(e.y),i.push(e.onCurve?1:0)})});if(e.unicode&&e.unicode.length)t.apply(i,[i.length,0].concat(e.unicode));if(e.name&&e.name.length)t.apply(i,[i.length,0].concat(e.name.split("").map(function(e){return e.charCodeAt(0)})));for(var n=0,r=0,o=i.length;o>r;r++)n=2147483647&131*n+i[r];return n}return e}),define("editor/controller/initLayer",["require","common/lang"],function(require){function e(){this.axisLayer=this.render.addLayer("axis",{level:10,fill:!1}),this.fontLayer=this.render.addLayer("font",t.extend({level:20,lineWidth:1,strokeColor:"#999",fillColor:"#555",strokeSeparate:!1},this.options.fontLayer)),this.coverLayer=this.render.addLayer("cover",t.extend({level:30,fill:!1,strokeColor:"green",fillColor:"white"},this.options.coverLayer)),this.referenceLineLayer=this.render.addLayer("referenceline",{level:40,fill:!1,strokeColor:this.options.referenceline.style.strokeColor}),this.graduationLayer=this.render.addLayer("graduation",{level:50,fill:!1,disabled:!0})}var t=require("common/lang");return e}),define("editor/controller/initRender",["require","../menu/commandList","common/lang","../mode/support","render/util/selectShape"],function(require){function e(e){switch(this.contextMenu.hide(),e.command){case"addreferenceline":this.execCommand("addreferenceline",e.pos.x,e.pos.y);break;case"split":this.setMode("split");break;case"paste":var t=this.getClipBoard();if(t)this.execCommand("pasteshapes",t,e.pos);break;case"addsupportshapes":this.execCommand("addsupportshapes",e.args.type);break;case"gridsorption":this.execCommand("gridsorption",!e.args.selected);break;case"shapesorption":this.execCommand("shapesorption",!e.args.selected);break;case"showgrid":this.execCommand("showgrid",!e.args.selected);break;case"save":this.fire("save");break;default:this.execCommand(e.command,e)}}function t(){var t=this,a=this.render,s=function(e){a.camera.x=e.x,a.camera.y=e.y,a.camera.event=e};a.capture.on("down",function(e){if(!t.contextMenu.visible())a.camera.startX=e.x,a.camera.startY=e.y,s(e),t.mode.down&&t.mode.down.call(t,e)}),a.capture.on("dragstart",function(e){if(!t.contextMenu.visible())s(e),t.mode.dragstart&&t.mode.dragstart.call(t,e)}),a.capture.on("drag",function(e){if(!t.contextMenu.visible())a.camera.mx=e.x-a.camera.x,a.camera.my=e.y-a.camera.y,s(e),t.mode.drag&&t.mode.drag.call(t,e)}),a.capture.on("dragend",function(e){if(!t.contextMenu.visible())s(e),t.mode.dragend&&t.mode.dragend.call(t,e)}),a.capture.on("move",function(e){if(!t.contextMenu.visible())t.graduationMarker.moveTo(e.x-1,e.y-1),t.mode.move&&t.mode.move.call(t,e)}),a.capture.on("up",function(e){if(!t.contextMenu.visible())t.mode.up&&t.mode.up.call(t,e)}),a.capture.on("click",function(e){if(!t.contextMenu.visible())t.mode.click&&t.mode.click.call(t,e)}),a.capture.on("dblclick",function(e){if(!t.contextMenu.visible()){var i=a.getLayer("font").getShapeIn(e);if(i){var n=o(i,e);t.setMode("point",n)}else if(t.mode===r.point)t.setMode()}}),a.capture.on("rightdown",function(r){if(t.mode.rightdown)t.mode.rightdown.call(t,r);else t.contextMenu.onClick=n.bind(e,t),t.contextMenu.show(r,i.editor)}),a.keyCapture.on("keyup",function(e){if(!t.contextMenu.visible())if("esc"===e.key&&!t.mode.keyup)t.setMode();else t.mode.keyup&&t.mode.keyup.call(t,e)}),a.keyCapture.on("keydown",function(e){if(!t.contextMenu.visible())if(83===e.keyCode&&e.ctrlKey)t.fire("save");else if(86===e.keyCode&&e.ctrlKey){var i=t.getClipBoard();if(i)t.execCommand("pasteshapes",i)}else if(187===e.keyCode&&(e.ctrlKey||e.altKey)){e.originEvent.stopPropagation(),e.originEvent.preventDefault();var n=a.getSize();a.scale(1.25,{x:n.width/2,y:n.height/2})}else if(189===e.keyCode&&(e.ctrlKey||e.altKey)){e.originEvent.stopPropagation(),e.originEvent.preventDefault();var r=a.getSize();a.scale(.8,{x:r.width/2,y:r.height/2})}else if(90===e.keyCode&&e.ctrlKey)t.execCommand("undo");else if(89===e.keyCode&&e.ctrlKey)t.execCommand("redo");else t.mode.keydown&&t.mode.keydown.call(t,e)}),a.keyCapture.on("keydown",function(e){if(!t.contextMenu.visible())t.mode.keydown&&t.mode.keydown.call(t,e)}),a.on("resize",function(e){t.render.move((e.size.width-e.prevSize.width)/2,(e.size.height-e.prevSize.height)/2),t.render.refresh()})}var i=require("../menu/commandList"),n=require("common/lang"),r=require("../mode/support"),o=require("render/util/selectShape");return t}),define("editor/command/commandSupport",["require"],function(){var e={alignshapes:!0,verticalalignshapes:!0,horizontalalignshapes:!0,joinshapes:!0,intersectshapes:!0,tangencyshapes:!0,splitshapes:!0,removeshapes:!0,reversepoints:!0,topshape:!0,bottomshape:!0,upshape:!0,downshape:!0,cutshapes:!0,pasteshapes:!0,addshapes:!0,rotateleft:!0,rotateright:!0,flipshapes:!0,mirrorshapes:!0};return{history:e}}),define("editor/controller/initBinder",["require","../command/commandSupport"],function(require){function e(){var e=this;e.on("change",function(){e.history.add(e.getShapes())}),e.on("command",function(i){if(!1!==i.result&&t.history[i.command])e.fire("change")})}var t=require("../command/commandSupport");return e}),define("editor/widget/GraduationMarker",["require"],function(){function e(e,t){t=t||{};var i=document.createElement("div");i.className="marker-x";var n=document.createElement("div");if(n.className="marker-y",t.thickness)i.style.width=t.thickness+"px",n.style.height=t.thickness+"px";e.appendChild(this.xAxis=i),e.appendChild(this.yAxis=n)}return e.prototype.moveTo=function(e,t){this.xAxis.style.top=t+"px",this.yAxis.style.left=e+"px"},e.prototype.dispose=function(){this.xAxis.parentNode.removeChild(this.xAxis),this.yAxis.parentNode.removeChild(this.yAxis),this.xAxis=this.yAxis=null},e}),define("editor/controller/initAxis",["require","common/lang","../widget/GraduationMarker"],function(require){function e(){var e=this.render.painter.width,t=this.render.painter.height,r=this.options,o=(e-r.unitsPerEm)/2,a=(t+(r.unitsPerEm+r.axis.metrics.descent))/2;this.axis=this.axisLayer.addShape("axis",i.extend(i.clone(r.axis),{id:"axis",x:o,y:a,unitsPerEm:r.unitsPerEm,selectable:!1})),this.rightSideBearing=this.referenceLineLayer.addShape("line",{id:"rightSideBearing",p0:{x:r.unitsPerEm/2},style:{strokeColor:"blue"}}),this.graduation=this.graduationLayer.addShape("graduation",{config:this.axis}),this.graduationMarker=new n(this.render.main,r.axis.graduation),this.sorption.setGrid(this.axis)}function t(e){var t=this.options.unitsPerEm;this.options.unitsPerEm=e.unitsPerEm,i.overwrite(this.options.axis,e),this.options.axis.graduation.gap=e.graduation&&e.graduation.gap?e.graduation.gap:this.options.unitsPerEm/512*100;var n=i.clone(this.options.axis),r=this.render.camera.scale,o=n.metrics;Object.keys(o).forEach(function(e){n.metrics[e]=o[e]*r}),n.unitsPerEm=n.unitsPerEm*r,i.extend(this.axis,n);var a=this.render.getSize();this.render.scale(t/this.options.unitsPerEm,{x:a.width/2,y:a.height/2})}var i=require("common/lang"),n=require("../widget/GraduationMarker");return function(){e.call(this),this.setAxis=t}}),define("graphics/pathCeil",["require"],function(){function e(e){for(var t,i=0,n=e.length;n>i;i++)t=e[i],t.x=Math.round(t.x),t.y=Math.round(t.y);return e}return e}),define("editor/controller/initFont",["require","common/lang","graphics/pathAdjust","graphics/pathCeil","graphics/computeBoundingBox","render/util/guid","../util/getFontHash"],function(require){function e(e){this.font=e,this.fontHash=c(e);var t=this.axis.x,i=this.axis.y,n=this.fontLayer;if(n.clearShapes(),!e.compound){var r=e.contours||[];delete e.contours;var o=f.computePathBox.apply(null,r);if(o)e.rightSideBearing=e.advanceWidth-o.x-o.width;else e.rightSideBearing=e.advanceWidth;r.forEach(function(e){n.addShape("path",{points:e})});var u=n.shapes;this.history.reset(),this.history.add(a.clone(u));var h=this.render.camera.scale;u.forEach(function(e){s(e.points,h,-h),s(e.points,1,1,t,i)})}n.refresh();var d=e.advanceWidth;return this.rightSideBearing.p0.x=t+(d||this.options.unitsPerEm)*h,this.referenceLineLayer.refresh(),this.setMode(),this}function t(e){var t=this.axis,i=this.render.camera.scale,n=this.fontLayer,r={};return n.shapes.forEach(function(e){r[e.id]=!0}),e.forEach(function(e){if(s(e.points,i,-i),s(e.points,1,1,t.x,t.y),r[e.id])e.id=h("shape");n.addShape(e)}),n.refresh(),this}function i(e){if(!e||0===e.length)return this;else return this.setShapes(e.map(function(e){return{id:h("shape"),type:"path",points:e}})),this.fire("change"),this}function n(e){var t=this.axis;e=e?a.clone(e):a.clone(this.fontLayer.shapes);var i=1/this.render.camera.scale;return e.forEach(function(e){s(e.points,i,-i,-t.x,-t.y)}),e}function r(){var e=a.clone(this.font||{});e.unicode=e.unicode||[],e.name=e.name||"";var t=this.axis,i=Math.round((this.rightSideBearing.p0.x-t.x)/this.render.camera.scale),n=this.getShapes(),r=n.map(function(e){return e.points});r.forEach(function(e){u(e)});var o=f.computePathBox.apply(null,r)||{x:0,y:0,width:0,height:0};if(e.xMin=o.x,e.yMin=o.y,e.xMax=o.x+o.width,e.yMax=o.y+o.height,e.leftSideBearing=e.xMin,0===o.width)e.advanceWidth=e.rightSideBearing;else e.advanceWidth=i||e.xMax+e.rightSideBearing||e.xMax;return delete e.rightSideBearing,e.contours=r,e}function o(e){if(this.font){var t=this.render.camera.scale,i=this.fontLayer.shapes,n=this.axis,r=f.computePathBox.apply(null,i.map(function(e){return e.points}));if(r){var o=0,a=r.x-n.x;if(void 0!==e.leftSideBearing&&Math.abs(e.leftSideBearing-a/t)>.01)o=e.leftSideBearing*t-a,i.forEach(function(e){s(e.points,1,1,o,0)}),this.fontLayer.refresh(),this.font.leftSideBearing=e.leftSideBearing,this.fire("change");if(void 0!==e.rightSideBearing)this.font.rightSideBearing=e.rightSideBearing,this.rightSideBearing.p0.x=r.x+r.width+o+e.rightSideBearing*t,this.referenceLineLayer.refresh()}else this.font.rightSideBearing=e.rightSideBearing;if(void 0!==e.unicode)this.font.unicode=e.unicode;if(void 0!==e.name)this.font.name=e.name;return this.fire("change"),this}}var a=require("common/lang"),s=require("graphics/pathAdjust"),u=require("graphics/pathCeil"),f=require("graphics/computeBoundingBox"),h=require("render/util/guid"),c=require("../util/getFontHash");return function(){this.setFont=e,this.getFont=r,this.adjustFont=o,this.setShapes=t,this.getShapes=n,this.addContours=i}}),define("editor/controller/initSetting",["require","../menu/util","../menu/commandList","common/lang"],function(require){function e(e){i.setSelected(n.editor,"setting.gridsorption",!!e.sorption.enableGrid),i.setSelected(n.editor,"setting.shapesorption",!!e.sorption.enableShape),i.setSelected(n.editor,"setting.showgrid",!!e.axis.showGrid)}function t(e){this.execCommand("gridsorption",e.sorption.enableGrid),this.execCommand("shapesorption",e.sorption.enableShape),this.execCommand("showgrid",e.axis.showGrid),this.fontLayer.options.fill=!!e.fontLayer.fill,this.fontLayer.options.fillColor=e.fontLayer.fillColor,this.fontLayer.options.strokeColor=e.fontLayer.strokeColor,this.fontLayer.refresh(),this.axis.gapColor=e.axis.gapColor,this.axis.metricsColor=e.axis.metricsColor,this.axis.emColor=e.axis.emColor,this.axis.graduation.gap=e.axis.graduation.gap||100,this.axisLayer.refresh(),this.graduationLayer.refresh(),r.overwrite(this.options,e)}var i=require("../menu/util"),n=require("../menu/commandList"),r=require("common/lang");return function(){e.call(this,this.options),this.setOptions=t}}),define("editor/Editor",["require","./mode/support","./widget/ContextMenu","./command/support","./widget/clipboard","./widget/History","./widget/Sorption","./util/getFontHash","./controller/initLayer","./controller/initRender","./controller/initBinder","./controller/initAxis","./controller/initFont","./controller/initSetting","common/observable"],function(require){function e(e,t){this.options=t||{},this.contextMenu=new i(e,this.options.contextMenu),this.sorption=new a(this.options.sorption),this.history=new o}var t=require("./mode/support"),i=require("./widget/ContextMenu"),n=require("./command/support"),r=require("./widget/clipboard"),o=require("./widget/History"),a=require("./widget/Sorption"),s=require("./util/getFontHash"),u=require("./controller/initLayer"),f=require("./controller/initRender"),h=require("./controller/initBinder"),c=require("./controller/initAxis"),d=require("./controller/initFont"),l=require("./controller/initSetting");return e.prototype.setRender=function(e){return this.render=e,l.call(this),d.call(this),f.call(this),u.call(this),c.call(this),h.call(this),this.axisLayer.refresh(),this.graduationLayer.refresh(),this.setMode(),this},e.prototype.setMode=function(e){if(this.mode)this.mode.end&&this.mode.end.call(this);this.mode=t[e]||t["default"];var i=Array.prototype.slice.call(arguments,1);return this.mode.begin&&this.mode.begin.apply(this,i),this},e.prototype.reset=function(){return this.fontLayer.clearShapes(),this.coverLayer.clearShapes(),this.font=null,this.refresh(),this},e.prototype.refresh=function(){return this.render.refresh(),this},e.prototype.setSelected=function(e){this.setMode("shapes",e)},e.prototype.refreshSelected=function(e){if(this.currentGroup){var t=this.currentGroup.shapes;if(this.currentGroup.setShapes(e),this.currentGroup.refresh(),e!==t)this.fire("selection:change",{shapes:e})}},e.prototype.getSelected=function(){return this.currentGroup?this.currentGroup.shapes:null},e.prototype.execCommand=function(e){var t=Array.prototype.slice.call(arguments,1),i={command:e,args:t};if(this.fire("beforecommand",i),i.returnValue===!1)return!1;if(n[e]){var r=n[e].apply(this,t);return i.result=r,this.fire("command",i),r}return!1},e.prototype.supportCommand=function(e){return!!n[e]},e.prototype.addCommand=function(e,t){if(n[e])return!1;else return n[e]=t,!0},e.prototype.isChanged=function(){var e=this.getFont();return this.fontHash!==s(e)},e.prototype.setChanged=function(e){if(e)this.fontHash=0;else{var t=this.getFont();this.fontHash=s(t)}},e.prototype.setClipBoard=function(e){return r.set(e,"editor-shape"),this},e.prototype.getClipBoard=function(){return r.get("editor-shape")},e.prototype.focus=function(){this.render.focus()},e.prototype.blur=function(){this.render.blur()},e.prototype.dispose=function(){this.un(),this.contextMenu.dispose(),this.render&&this.render.dispose(),this.graduationMarker.dispose(),this.options=this.contextMenu=this.render=null,this.fontLayer=this.coverLayer=this.axisLayer=this.referenceLineLayer=this.graduationLayer=null,this.axis=this.rightSideBearing=this.graduation=this.graduationMarker=this.font=null,this.sorption.dispose(),this.sorption=null,this.history.reset(),this.history=null,this.mode=null},require("common/observable").mixin(e.prototype),e}),define("editor/options",["require"],function(){var e={editor:{unitsPerEm:512,sorption:{enableGrid:!1,enableShape:!0,gridDelta:5,delta:5,sorptionColor:"#4AFF4A"},referenceline:{style:{strokeColor:"#0FF"}},coverLayer:{strokeColor:"green",fillColor:"white"},fontLayer:{lineWidth:1,strokeColor:"#999",fill:!0,fillColor:"#555"},axis:{showGrid:!0,gapColor:"#A6A6FF",metricsColor:"red",emColor:"red",metrics:{ascent:480,descent:-33,xHeight:256,capHeight:358},graduation:{gap:100,thickness:20,markHeight:3,markBackgroundColor:"#C3CBD2",markColor:"#65737E",color:"#65737E"}},contextMenu:{}},render:{defaultRatio:1.2,minScale:.2,maxScale:200,enableScale:!0,enableResize:!0}};
return e}),define("editor/main",["require","render/main","./Editor","./options","common/lang"],function(require){var e=require("render/main"),t=require("./Editor"),i=require("./options"),n=require("common/lang"),exports={};return exports.create=function(r,o){if(!r)throw"need main element";o=n.extend({},i,o);var a=new t(r,o.editor),s=o.render||{};return s.controller=a,e.create(r,s),a},exports}),define("fonteditor/widget/loading",["require"],function(){var e={show:function(e,t){if(clearTimeout(this.showtimer),$("#loading span").html(e||"正在加载..."),$("#loading").show(),t)this.showtimer=setTimeout(this.hide,t);return this},hide:function(){$("#loading").hide()}};return e}),define("fonteditor/widget/program",["require","common/observable","./loading"],function(require){function e(e){var t=this;document.body.addEventListener("click",function(i){if(e.viewer===i.target||e.viewer.contains(i.target))t.viewer.focus();else t.viewer.blur();if(e.editor)if(e.editor===i.target||e.editor.contains(i.target))t.editor.focus();else t.editor.blur()},!1)}function t(){var e=this;document.body.addEventListener("keydown",function(t){if(e.listening){if(t.ctrlKey=t.ctrlKey||t.metaKey,65===t.keyCode&&t.ctrlKey)t.preventDefault(),t.stopPropagation();if(t.keyCode>=112&&t.keyCode<=119&&116!==t.keyCode)t.preventDefault(),t.stopPropagation(),e.fire("function",{keyCode:t.keyCode});else if(83===t.keyCode&&t.ctrlKey)t.preventDefault(),t.stopPropagation(),e.fire("save");else if(86===t.keyCode&&t.ctrlKey)t.preventDefault(),t.stopPropagation(),e.fire("paste")}})}var i=require("common/observable"),n={fontUrl:"./php/readFont.php?file=${0}",init:function(i){e.call(this,i),t.call(this,i)},data:{},setting:{},listening:!0,loading:require("./loading")};return i.mixin(n),n}),define("fonteditor/dialog/setting",["require","common/lang","common/string","../widget/program"],function(require){function e(e,t){var i=t.split(".");if(1===i.length)return e[t];for(var n,r=e;null!=r&&(n=i.shift());)r=r[n];return r}function t(e,t,i){var n=t.split(".");if(1===n.length)e[t]=i;else{for(var r,o=n.pop(),a=e;null!=a&&(r=n.shift());)a=a[r];if(null!=a)a[o]=i}return e}function i(e){this.options=e||{};var t=$("#model-dialog");if(t.find(".modal-title").html(this.title||"设置"),t.find(".modal-body").html(this.getTpl()),this.nofooter)t.find(".modal-footer").hide();else t.find(".modal-footer").show();t.on("hidden.bs.modal",n.bind(function(){if(o.listening=!0,t)this.onDispose&&this.onDispose(),delete this.options,t.off("hidden.bs.modal"),t.find(".btn-confirm").off("click"),t=null},this)),t.find(".btn-confirm").on("click",n.bind(function(){var e=this.validate();if(!1!==e)this.options.onChange&&this.options.onChange.call(this,e),t.modal("hide")},this))}var n=require("common/lang"),r=require("common/string").pad,o=require("../widget/program");return i.prototype.getTpl=function(){return""},i.prototype.getDialog=function(){return $("#model-dialog")},i.prototype.validate=function(){return!0},i.prototype.setFields=function(t){return this.getDialog().find("[data-field]").each(function(i,n){var o=n.getAttribute("data-field"),a=n.getAttribute("data-type")||n.type,s=e(t,o);if(void 0!==s)if("checkbox"===a)n.checked=s?"checked":"";else if("unicode"===a)n.value=(s||[]).map(function(e){return"$"+e.toString(16).toUpperCase()}).join(",");else if("datetime-local"===a){var u;if("string"==typeof s)u=new Date(Date.parse(s));else if(/^\d+$/.test(s))u=new Date(+s);else u=s;n.value=u.getFullYear()+"-"+r(u.getMonth()+1,2)+"-"+r(u.getDate(),2)+"T"+r(u.getHours(),2)+":"+r(u.getMinutes(),2)}else n=$(n),n.val(s)}),this},i.prototype.getFields=function(e){return e=e||{},this.getDialog().find("[data-field]").each(function(i,n){var r,o,a=n.getAttribute("data-field"),s=n.getAttribute("data-type")||n.type;if("checkbox"===s)r=!!n.checked;else if("unicode"===s)r=""===n.value.trim()?[]:n.value.split(",").map(function(e){return Number("0x"+e.slice(1))});else if("datetime-local"===s){if(n.value)r=Date.parse(n.value.replace("T"," "))}else if("number"===s){if(n.value){if(o=+n.value,n.getAttribute("data-ceil"))o=Math.floor(o);r=o}}else if(n=$(n),o=n.val().trim())r=o;if(void 0!==r)t(e,a,r)}),e},i.prototype.show=function(e){return o.listening=!1,$("#model-dialog").modal("show"),this.set(e),this},i.prototype.set=function(e){return this.setting=e,this},i.prototype.get=function(){return this.setting},i.prototype.dispose=function(){$("#model-dialog").modal("hide")},i.derive=function(e){function t(){i.apply(this,arguments)}return n.extend(t.prototype,i.prototype,e),t.prototype.constructor=i,t},i}),define("fonteditor/dialog/setting-unicode",["require","./setting"],function(require){var e='<div class="input-group"><div class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">起始代码点 <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><a href="javascript:$(\'#setting-text-unicode\').val(\'$21\')">ascii</a></li><li><a href="javascript:$(\'#setting-text-unicode\').val(\'$E001\')">unicode private data</a></li></ul></div><input id="setting-text-unicode" type="text" class="form-control" value="$E001"></div>';return require("./setting").derive({title:"设置代码点",getTpl:function(){return e},validate:function(){var e=$("#setting-text-unicode").val();if(e.match(/^\$[A-F0-9]+$/i))return this.setting=e;else return alert("代码点设置不正确"),!1}})}),define("fonteditor/dialog/setting-name",["require","./setting"],function(require){var e='<div class="input-group input-group-sm"><span class="input-group-addon">字体家族</span><input data-field="fontFamily" type="text" class="form-control"></div><div class="input-group input-group-sm"><span class="input-group-addon">子字体家族</span><input data-field="fontSubFamily" type="text" class="form-control"></div><div class="input-group input-group-sm"><span class="input-group-addon">完整字体名</span><input data-field="fullName" type="text" class="form-control"></div><div class="input-group input-group-sm"><span class="input-group-addon">版本</span><input data-field="version" type="text" class="form-control"></div><div class="input-group input-group-sm"><span class="input-group-addon">PostScript名称</span><input data-field="postScriptName" type="text" class="form-control"></div><div class="input-group input-group-sm"><span class="input-group-addon">em框大小</span><input data-field="unitsPerEm" type="number" min="64" max="16384" class="form-control" placeholder="1024~16384"></div><div class="input-group input-group-sm"><span class="input-group-addon">最小可读尺寸</span><input data-field="lowestRecPPEM" type="number" min="8" max="16384" class="form-control" placeholder="8~16384"></div><div class="input-group input-group-sm"><span class="input-group-addon">创建日期</span><input data-field="created" type="datetime-local" class="form-control"></div>';return require("./setting").derive({title:"字体信息",getTpl:function(){return e},set:function(e){this.setFields(e)},validate:function(){var e=this.getFields();return e}})}),define("fonteditor/dialog/setting-adjust-pos",["require","./setting"],function(require){var e='<div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">左边轴</span><input data-field="leftSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control"></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">右边轴</span><input data-field="rightSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control"></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">基线偏移</span><input data-field="verticalAlign" type="number" min="-16384" max="16384" step="1" class="form-control"></div></div>';return require("./setting").derive({title:"调整字形位置",getTpl:function(){return e},set:function(e){this.setFields(e||{})},validate:function(){var e=this.getFields();if(void 0===e.leftSideBearing&&void 0===e.rightSideBearing&&void 0===e.verticalAlign)return alert("没有设置项目!"),!1;else return e}})}),define("fonteditor/dialog/setting-adjust-glyf",["require","./setting"],function(require){var e='<div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">翻转</span><span class="form-control"><input data-field="reverse" type="checkbox"></span></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">镜像</span><span class="form-control"><input data-field="mirror" type="checkbox"></span></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">按比例缩放</span><input data-field="scale" type="number" min="0" max="1" step="0.1" class="form-control"></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">缩放字形到上下边界</span><span class="form-control"><input data-field="ajdustToEmBox" type="checkbox" onclick="$(\'#setting-ajdustToEmPadding\')[this.checked ? \'removeClass\' : \'addClass\'](\'hide\')"></span></div></div> <div id="setting-ajdustToEmPadding" class="form-group hide"><div class="input-group input-group-sm"><span class="input-group-addon">顶部和底部留白</span><input data-field="ajdustToEmPadding" data-ceil="true" type="number" min="-16384" max="16384" step="1" class="form-control"></div></div></div>';return require("./setting").derive({title:"调整字形",getTpl:function(){return e},set:function(e){this.setFields(e||{})},validate:function(){var e=this.getFields();if(void 0===e.reverse&&void 0===e.mirror&&void 0===e.scale&&void 0===e.ajdustToEmBox)return alert("没有设置项目!"),!1;else return e}})}),define("ttf/enum/weightClass",["require"],function(){return{100:"Ultra-light",200:"Extra-light",300:"Light",400:"Semi-light",500:"Medium (normal)",600:"Semi-bold",700:"Bold",800:"Extra-Bold",900:"Ultra-bold"}}),define("ttf/enum/widthClass",["require"],function(){return{1:"Ultra-condensed",2:"Extra-condensed",3:"Condensed",4:"Semi-condensed",5:"Medium (normal)",6:"Semi-expanded",7:"Expanded",8:"Extra-expanded",9:"Ultra-expanded"}}),define("fonteditor/dialog/setting-metrics",["require","../widget/program","ttf/enum/weightClass","ttf/enum/widthClass","./setting"],function(require){var e=require("../widget/program"),t=require("ttf/enum/weightClass"),i=require("ttf/enum/widthClass"),n=["bFamilyType","bSerifStyle","bWeight","bProportion","bContrast","bStrokeVariation","bArmStyle","bLetterform","bMidline","bXHeight"],r='<div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">上升</span><input data-field="ascent" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">下降</span><input data-field="descent" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">行间距</span><input data-field="lineGap" type="number" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">win上升</span><input data-field="usWinAscent" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">win下降</span><input data-field="usWinDescent" type="number" class="form-control"></div></div><a href="#" id="setting-calc-metrics" class="form-group">计算</a></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">typo上升</span><input data-field="sTypoAscender" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">typo下降</span><input data-field="sTypoDescender" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">typo间距</span><input data-field="sTypoLineGap" type="number" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">x高度</span><input data-field="sxHeight" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">大写H高度</span><input data-field="sCapHeight" type="number" class="form-control"></div></div></div><hr><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">删除线位置</span><input data-field="yStrikeoutPosition" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">删除线厚度</span><input data-field="yStrikeoutSize" type="number" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">下划线位置</span><input data-field="underlinePosition" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">下划线厚度</span><input data-field="underlineThickness" type="number" class="form-control"></div></div></div><hr><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">下标水平</span><input data-field="ySubscriptXSize" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">下标垂直</span><input data-field="ySubscriptYSize" type="number" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">下标X偏移</span><input data-field="ySubscriptXOffset" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">下标Y偏移</span><input data-field="ySubscriptYOffset" type="number" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">上标水平</span><input data-field="ySuperscriptXSize" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">上标垂直</span><input data-field="ySuperscriptYSize" type="number" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">上标X偏移</span><input data-field="ySuperscriptXOffset" type="number" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">上标Y偏移</span><input data-field="ySuperscriptYOffset" type="number" class="form-control"></div></div></div><hr><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">供应商ID</span><input data-field="achVendID" type="text" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">粗细</span><select id="setting-weight" data-field="usWeightClass" data-type="number" class="form-control"></select></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">宽度</span><select id="setting-width" data-field="usWidthClass" data-type="number" class="form-control"></select></div></div></div><div class="input-group input-group-sm"><span class="input-group-addon">panose</span><input data-field="panose" type="text" class="form-control"></div>';return require("./setting").derive({title:"字体度量",getTpl:function(){return r},set:function(r){var o="";Object.keys(t).forEach(function(e){o+='<option value="'+e+'">'+t[e]+"</option>"}),$("#setting-weight").html(o),o="",Object.keys(i).forEach(function(e){o+='<option value="'+e+'">'+i[e]+"</option>"}),$("#setting-width").html(o),r.panose=n.map(function(e){return r[e]}).join("-"),this.setFields(r);var a=this;$("#setting-calc-metrics").on("click",function(t){t.preventDefault(),t.stopPropagation();var i=e.ttfManager.calcMetrics();a.setFields(i)})},validate:function(){$("#setting-calc-metrics").off("click");var e=this.getFields(),t=n.length;return(e.panose||"").split("-").forEach(function(i,r){if(t>r)e[n[r]]=15&(+i||0)}),e}})}),define("fonteditor/data/online-font",["require"],function(){return[{name:"fonteditor.ttf",url:"./font/fonteditor.ttf",from:"fonteditor图标库"},{name:"fonteditor.woff",url:"./font/fonteditor.woff",from:"fonteditor图标库"},{name:"fonteditor.svg",url:"./font/fonteditor.svg",from:"fonteditor图标库"},{name:"fonteditor.eot",url:"./font/fonteditor.eot",from:"fonteditor图标库"},{name:"fontawesome-webfont.woff",url:"http://www.bootcss.com/p/font-awesome/assets/font/fontawesome-webfont.woff",from:"fontawesome图标库"},{name:"baiduHealth.woff",url:"http://vs-static.baidu.com/m-health/new-composite/20141223/asset/common/css/font/baiduHealth.woff",from:"百度健康图标"},{name:"i-edu.woff",url:"http://vs-static.baidu.com/edu/m/asset/common/css/font/i-edu.woff",from:"百度教育图标"}]}),define("fonteditor/dialog/font-online",["require","common/string","../data/online-font","./setting"],function(require){var e=require("common/string"),t=require("../data/online-font");return require("./setting").derive({title:"在线字体",nofooter:!0,getTpl:function(){var i='<div class="list-group">';return t.forEach(function(t,n){i+='<a data-url="'+t.url+'" href="'+t.url+'" class="list-group-item"><span class="from">'+e.encodeHTML(t.from)+"</span>"+(n+1)+". "+e.encodeHTML(t.name)+"</a>"}),i+="</div>"},set:function(){var e=this,t=this.getDialog();t.find(".list-group").on("click",".list-group-item",function(i){i.preventDefault(),i.stopPropagation();var n=$(this).attr("data-url");t.find(".list-group").off("click",".list-group-item").remove(),e.options.onChange&&e.options.onChange.call(this,decodeURIComponent(n)),$("#model-dialog").modal("hide")})}})}),define("fonteditor/dialog/font-url",["require","./setting"],function(require){var e='<div class="input-group input-group-sm"><span class="input-group-addon">字体URL</span><input data-field="url" type="text" class="form-control"></div>';return require("./setting").derive({title:"线上字体",getTpl:function(){return e},validate:function(){var e=this.getFields();if(e.url)return e.url;else return void 0}})}),define("ttf/enum/unicodeName",["require"],function(){var e={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:2,10:1,11:1,12:1,13:2,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:1,28:1,29:1,30:1,31:1,32:3,33:4,34:5,35:6,36:7,37:8,38:9,39:10,40:11,41:12,42:13,43:14,44:15,45:16,46:17,47:18,48:19,49:20,50:21,51:22,52:23,53:24,54:25,55:26,56:27,57:28,58:29,59:30,60:31,61:32,62:33,63:34,64:35,65:36,66:37,67:38,68:39,69:40,70:41,71:42,72:43,73:44,74:45,75:46,76:47,77:48,78:49,79:50,80:51,81:52,82:53,83:54,84:55,85:56,86:57,87:58,88:59,89:60,90:61,91:62,92:63,93:64,94:65,95:66,96:67,97:68,98:69,99:70,100:71,101:72,102:73,103:74,104:75,105:76,106:77,107:78,108:79,109:80,110:81,111:82,112:83,113:84,114:85,115:86,116:87,117:88,118:89,119:90,120:91,121:92,122:93,123:94,124:95,125:96,126:97,160:172,161:163,162:132,163:133,164:189,165:150,166:232,167:134,168:142,169:139,170:157,171:169,172:164,174:138,175:218,176:131,177:147,178:242,179:243,180:141,181:151,182:136,184:222,185:241,186:158,187:170,188:245,189:244,190:246,191:162,192:173,193:201,194:199,195:174,196:98,197:99,198:144,199:100,200:203,201:101,202:200,203:202,204:207,205:204,206:205,207:206,208:233,209:102,210:211,211:208,212:209,213:175,214:103,215:240,216:145,217:214,218:212,219:213,220:104,221:235,222:237,223:137,224:106,225:105,226:107,227:109,228:108,229:110,230:160,231:111,232:113,233:112,234:114,235:115,236:117,237:116,238:118,239:119,240:234,241:120,242:122,243:121,244:123,245:125,246:124,247:184,248:161,249:127,250:126,251:128,252:129,253:236,254:238,255:186,262:253,263:254,268:255,269:256,273:257,286:248,287:249,304:250,305:215,321:226,322:227,338:176,339:177,350:251,351:252,352:228,353:229,376:187,381:230,382:231,402:166,710:216,711:225,728:219,729:220,730:221,731:224,733:223,960:155,8211:178,8212:179,8216:182,8217:183,8218:196,8220:180,8221:181,8222:197,8224:130,8225:194,8226:135,8230:171,8240:198,8249:190,8250:191,8355:247,8482:140,8486:159,8706:152,8710:168,8719:154,8721:153,8722:239,8725:188,8729:195,8730:165,8734:146,8747:156,8776:167,8800:143,8804:148,8805:149,9674:185,61441:192,61442:193,64257:192,64258:193,65535:0};return e}),define("ttf/enum/postName",["require"],function(){var e={0:".notdef",1:".null",2:"nonmarkingreturn",3:"space",4:"exclam",5:"quotedbl",6:"numbersign",7:"dollar",8:"percent",9:"ampersand",10:"quotesingle",11:"parenleft",12:"parenright",13:"asterisk",14:"plus",15:"comma",16:"hyphen",17:"period",18:"slash",19:"zero",20:"one",21:"two",22:"three",23:"four",24:"five",25:"six",26:"seven",27:"eight",28:"nine",29:"colon",30:"semicolon",31:"less",32:"equal",33:"greater",34:"question",35:"at",36:"A",37:"B",38:"C",39:"D",40:"E",41:"F",42:"G",43:"H",44:"I",45:"J",46:"K",47:"L",48:"M",49:"N",50:"O",51:"P",52:"Q",53:"R",54:"S",55:"T",56:"U",57:"V",58:"W",59:"X",60:"Y",61:"Z",62:"bracketleft",63:"backslash",64:"bracketright",65:"asciicircum",66:"underscore",67:"grave",68:"a",69:"b",70:"c",71:"d",72:"e",73:"f",74:"g",75:"h",76:"i",77:"j",78:"k",79:"l",80:"m",81:"n",82:"o",83:"p",84:"q",85:"r",86:"s",87:"t",88:"u",89:"v",90:"w",91:"x",92:"y",93:"z",94:"braceleft",95:"bar",96:"braceright",97:"asciitilde",98:"Adieresis",99:"Aring",100:"Ccedilla",101:"Eacute",102:"Ntilde",103:"Odieresis",104:"Udieresis",105:"aacute",106:"agrave",107:"acircumflex",108:"adieresis",109:"atilde",110:"aring",111:"ccedilla",112:"eacute",113:"egrave",114:"ecircumflex",115:"edieresis",116:"iacute",117:"igrave",118:"icircumflex",119:"idieresis",120:"ntilde",121:"oacute",122:"ograve",123:"ocircumflex",124:"odieresis",125:"otilde",126:"uacute",127:"ugrave",128:"ucircumflex",129:"udieresis",130:"dagger",131:"degree",132:"cent",133:"sterling",134:"section",135:"bullet",136:"paragraph",137:"germandbls",138:"registered",139:"copyright",140:"trademark",141:"acute",142:"dieresis",143:"notequal",144:"AE",145:"Oslash",146:"infinity",147:"plusminus",148:"lessequal",149:"greaterequal",150:"yen",151:"mu",152:"partialdiff",153:"summation",154:"product",155:"pi",156:"integral",157:"ordfeminine",158:"ordmasculine",159:"Omega",160:"ae",161:"oslash",162:"questiondown",163:"exclamdown",164:"logicalnot",165:"radical",166:"florin",167:"approxequal",168:"Delta",169:"guillemotleft",170:"guillemotright",171:"ellipsis",172:"nonbreakingspace",173:"Agrave",174:"Atilde",175:"Otilde",176:"OE",177:"oe",178:"endash",179:"emdash",180:"quotedblleft",181:"quotedblright",182:"quoteleft",183:"quoteright",184:"divide",185:"lozenge",186:"ydieresis",187:"Ydieresis",188:"fraction",189:"currency",190:"guilsinglleft",191:"guilsinglright",192:"fi",193:"fl",194:"daggerdbl",195:"periodcentered",196:"quotesinglbase",197:"quotedblbase",198:"perthousand",199:"Acircumflex",200:"Ecircumflex",201:"Aacute",202:"Edieresis",203:"Egrave",204:"Iacute",205:"Icircumflex",206:"Idieresis",207:"Igrave",208:"Oacute",209:"Ocircumflex",210:"apple",211:"Ograve",212:"Uacute",213:"Ucircumflex",214:"Ugrave",215:"dotlessi",216:"circumflex",217:"tilde",218:"macron",219:"breve",220:"dotaccent",221:"ring",222:"cedilla",223:"hungarumlaut",224:"ogonek",225:"caron",226:"Lslash",227:"lslash",228:"Scaron",229:"scaron",230:"Zcaron",231:"zcaron",232:"brokenbar",233:"Eth",234:"eth",235:"Yacute",236:"yacute",237:"Thorn",238:"thorn",239:"minus",240:"multiply",241:"onesuperior",242:"twosuperior",243:"threesuperior",244:"onehalf",245:"onequarter",246:"threequarters",247:"franc",248:"Gbreve",249:"gbreve",250:"Idotaccent",251:"Scedilla",252:"scedilla",253:"Cacute",254:"cacute",255:"Ccaron",256:"ccaron",257:"dcroat"};return e}),define("ttf/util/string",["require","../enum/unicodeName","../enum/postName"],function(require){function e(e){return decodeURIComponent(encodeURIComponent(e).replace(/%00([\x00-\xff])/g,"$1"))}var t=require("../enum/unicodeName"),i=require("../enum/postName"),n={stringify:e,getUnicodeName:function(e){var n=t[e];if(void 0!==n)return i[n];else return"uni"+e.toString(16).toUpperCase()},toUTF8Bytes:function(t){t=e(t);for(var i=[],n=0;n<t.length;n++)if(t.charCodeAt(n)<=127)i.push(t.charCodeAt(n));else for(var r=encodeURIComponent(t.charAt(n)).slice(1).split("%"),o=0;o<r.length;o++)i.push(parseInt(r[o],16));return i},toUCS2Bytes:function(t){t=e(t);for(var i,n=[],r=0;r<t.length;++r)i=t.charCodeAt(r),n.push(i>>8),n.push(255&i);return n},readPascalString:function(t){for(var i=[],n=0,r=t.length;r>n;){for(var o=t[n++],a="";o-->0&&r>n;)a+=String.fromCharCode(t[n++]);a=e(a),i.push(a)}return i},getPascalStringBytes:function(e){var t=[],i=e?e.length<256?e.length:255:0;t.push(i);for(var n=0;i>n;n++){var r=e.charCodeAt(n);t.push(128>r?r:42)}return t}};return n}),define("fonteditor/dialog/setting-glyf",["require","ttf/util/string","./setting"],function(require){var e=require("ttf/util/string"),t=/^(?:\$[A-F0-9]+)(?:\,\$[A-F0-9]+)*$/gi,i='<div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">unicode</span><input data-field="unicode" data-type="unicode" id="setting-glyf-unicode" class="form-control"></div>&nbsp;&nbsp;<span>可以设置多个unicode，例如："$21,$22,$23"</span></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">命名</span><input data-field="name" id="setting-glyf-name" class="form-control"></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">左边轴</span><input data-field="leftSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control"></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">右边轴</span><input data-field="rightSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control"></div></div>';return require("./setting").derive({title:"调整字形",getTpl:function(){return i},set:function(i){$("#setting-glyf-unicode").on("blur",function(){var i=$(this).val(),n=$("#setting-glyf-name");if(i.match(t))i=Number("0x"+i.split(",")[0].slice(1)),n.val(e.getUnicodeName(i))}),this.setFields(i||{})},validate:function(){var e=$("#setting-glyf-unicode").val();if(e&&!e.match(t))return alert("unicode设置不正确!"),!1;var i=this.getFields();if(void 0===i.leftSideBearing&&void 0===i.rightSideBearing&&void 0===i.unicode&&void 0===i.name)return alert("没有设置项目!"),!1;else return i}})}),define("fonteditor/dialog/setting-editor",["require","common/lang","../widget/program","./setting"],function(require){var e=require("common/lang"),t=require("../widget/program"),i='<div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">字体列表颜色</span><input data-field="viewer.color" type="text" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">字体列表大小</span><select data-field="viewer.shapeSize" class="form-control"><option value="xlarge">特大</option><option value="large">大</option><option value="normal">中</option><option value="small">小</option></select></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">分页个数</span><input data-field="viewer.pageSize" type="number" class="form-control"></div></div></div><hr><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">吸附到网格线</span><span class="form-control"><input data-field="editor.sorption.enableGrid" type="checkbox"></span></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">吸附到轮廓</span><span class="form-control"><input data-field="editor.sorption.enableShape" type="checkbox"></span></div></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">显示网格</span><span class="form-control"><input data-field="editor.axis.showGrid" type="checkbox"></span></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">填充轮廓</span><span class="form-control"><input data-field="editor.fontLayer.fill" type="checkbox"></span></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">轮廓颜色</span><input data-field="editor.fontLayer.strokeColor" type="text" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">轮廓填充颜色</span><input data-field="editor.fontLayer.fillColor" type="text" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">网格线颜色</span><input data-field="editor.axis.gapColor" type="text" class="form-control"></div></div><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">网格线间距</span><input data-field="editor.axis.graduation.gap" type="number" class="form-control"></div></div></div><div class="form-inline"><div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">度量线颜色</span><input data-field="editor.axis.metricsColor" type="text" class="form-control"></div></div></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">保存设置</span><span class="form-control"><input data-field="saveSetting" type="checkbox"></span></div> <a href="#" id="setting-editor-efault">重置为默认设置</a></div>';return require("./setting").derive({title:"编辑器设置",getTpl:function(){return i},set:function(i){this.setting=e.clone(i),this.setFields(this.setting);var n=this;$("#setting-editor-efault").on("click",function(e){e.preventDefault(),n.setting=t.setting.getDefault("editor"),n.setFields(n.setting)})},validate:function(){var e=this.getFields(this.setting);return e}})}),define("fonteditor/dialog/setting-find-glyf",["require","./setting"],function(require){var e=/^(?:\$[A-F0-9]+)$/gi,t='<div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">unicode</span><input value="$" data-field="unicode" data-type="unicode" id="setting-glyf-unicode" class="form-control"></div>&nbsp;&nbsp;<span>例如："$21"</span></div>';return require("./setting").derive({title:"查找字形",getTpl:function(){return t},validate:function(){var t=$("#setting-glyf-unicode").val();if(t&&!t.match(e))return alert("unicode不正确!"),!1;else return this.getFields()}})}),define("fonteditor/dialog/support",["require","../dialog/setting-unicode","../dialog/setting-name","../dialog/setting-adjust-pos","../dialog/setting-adjust-glyf","../dialog/setting-metrics","../dialog/font-online","../dialog/font-url","../dialog/setting-glyf","../dialog/setting-editor","../dialog/setting-find-glyf"],function(require){return{unicode:require("../dialog/setting-unicode"),name:require("../dialog/setting-name"),"adjust-pos":require("../dialog/setting-adjust-pos"),"adjust-glyf":require("../dialog/setting-adjust-glyf"),metrics:require("../dialog/setting-metrics"),online:require("../dialog/font-online"),url:require("../dialog/font-url"),glyf:require("../dialog/setting-glyf"),editor:require("../dialog/setting-editor"),"find-glyf":require("../dialog/setting-find-glyf")}}),define("fonteditor/widget/glyfeditor",["require","editor/main","editor/options","../dialog/support","./program","common/lang"],function(require){function e(){var e=this,t=this.editor,i=s.debounce(function(){e.focus()},20);t.on("setting:font",function(e){var n=o.glyf;!new n({onChange:function(e){t.adjustFont(e),i()}}).show(e.setting)
}),t.on("setting:editor",function(t){var i=o.editor,n=new i({onChange:function(t){setTimeout(function(){a.viewer.setSetting(t.viewer),e.setSetting(t.editor)},20)}});n.show({viewer:a.viewer.getSetting(),editor:t.setting})}),t.on("save",function(){a.fire("save",{type:"editor"})});var n=this.commandMenu;if(n)t.on("selection:change",s.debounce(function(e){var t=e.shapes?e.shapes.length:0;if(!t)n.disableCommands(u.shapes),n.disableCommands(u.shapes2),n.disableCommands(u.shape);else n.enableCommands(u.shapes),n[t>=2?"enableCommands":"disableCommands"](u.shapes2),n[1===t?"enableCommands":"disableCommands"](u.shape)}),100),n.on("command",function(e){i();var n,r=e.command,o=e.args;if("save"===r)return void a.fire("save",{type:"editor"});if("splitshapes"===r)return void t.setMode("split");if("pasteshapes"===r)n=t.getClipBoard();else n=t.getSelected();if(n&&n.length)switch(r){case"pointmode":t.setMode("point",n[0]);break;case"topshape":case"bottomshape":case"upshape":case"downshape":t.execCommand(r,n[0]);break;case"copyshapes":case"pasteshapes":case"removeshapes":case"joinshapes":case"intersectshapes":case"tangencyshapes":case"rotateleft":case"rotateright":case"flipshapes":case"mirrorshapes":case"cutshapes":case"copyshapes":case"removeshapes":case"reversepoints":case"joinshapes":case"intersectshapes":case"tangencyshapes":t.execCommand(r,n);break;case"alignshapes":case"verticalalignshapes":case"horizontalalignshapes":t.execCommand(r,n,o.align)}else if("rangemode"===r)t.setMode("bound")})}function t(){if(this.editor)this.editor.execCommand.apply(this.editor,arguments)}function i(e,t){if(this.main=$(e),this.options=s.extend({},t),this.options.commandMenu)this.commandMenu=this.options.commandMenu,delete this.options.commandMenu}var n=require("editor/main"),r=require("editor/options"),o=require("../dialog/support"),a=require("./program"),s=require("common/lang"),u={shapes:["copyshapes","removeshapes","reversepoints","horizontalalignshapes","verticalalignshapes","rotateleft","rotateright","flipshapes","mirrorshapes"],shapes2:["joinshapes","intersectshapes","tangencyshapes"],shape:["pointmode","upshape","downshape"]};return i.prototype.show=function(t){if(this.main.show(),!this.editor)this.editor=n.create(this.main.get(0)),e.call(this);if(t)this.editor.setFont(t);this.editor.refresh(),this.editing=!0},i.prototype.hide=function(){this.editor&&this.editor.blur(),this.main.hide(),this.editing=!1},i.prototype.isEditing=function(){return this.editing},i.prototype.isVisible=function(){return"none"!==this.main.get(0).style.display},i.prototype.focus=function(){this.editing=!0,this.editor&&this.editor.focus()},i.prototype.blur=function(){this.editing=!1,this.editor&&this.editor.blur()},i.prototype.undo=function(){t.call(this,"undo")},i.prototype.redo=function(){t.call(this,"redo")},i.prototype.setSetting=function(e){if(this.editor)this.editor.setOptions(e);else s.overwrite(r.editor,e)},i.prototype.getSetting=function(){return this.editor?this.editor.options:r.editor},i.prototype.dispose=function(){this.editor.dispose(),this.main=this.options=this.editor=null},["reset","setFont","getFont","addContours","isChanged","setChanged","setAxis","adjustFont"].forEach(function(e){i.prototype[e]=function(){return this.editor?this.editor[e].apply(this.editor,arguments):void 0}}),i}),define("fonteditor/widget/projectviewer",["require","common/observable"],function(require){function e(e,t){this.options=t||{},this.main=$(e);var i=this;i.main.on("click","[data-action]",function(e){e.stopPropagation();var t=$(e.target),n=t.attr("data-action"),r=t.parents("[data-id]").attr("data-id");if("del"===n){if(!window.confirm("是否删除项目?"))return;i.current&&i.current.remove(),i.current=null}i.fire(n,{projectId:r})}),i.main.on("click","[data-id]",function(){i.fire("open",{projectId:$(this).attr("data-id")})})}return e.prototype.select=function(e){this.current&&this.current.removeClass("selected"),this.current=$('[data-id="'+e+'"]').addClass("selected")},e.prototype.show=function(e){var t="";(e||[]).forEach(function(e){t+='<dl data-id="'+e.id+'"><dt>'+e.name+'</dt><dd><span data-action="saveas">另存为</span><span data-action="del">删除</span></dd></dl>'}),this.main.html(t)},require("common/observable").mixin(e.prototype),e}),define("ttf/util/glyfAdjust",["require","graphics/pathAdjust","graphics/pathCeil","graphics/computeBoundingBox"],function(require){function e(e,r,o,a,s){if(r=r||1,o=o||1,a=a||0,s=s||0,e.contours&&e.contours.length){if(1!==r||1!==o)e.contours.forEach(function(e){t(e,r,o),i(e)});if(0!==a||0!==s)e.contours.forEach(function(e){t(e,1,1,a,s)})}var u=e.advanceWidth;if(void 0===e.xMin||void 0===e.yMax||void 0===e.leftSideBearing||void 0===e.advanceWidth){var f;if(e.contours&&e.contours.length)f=n.computePathBox.apply(this,e.contours);else f={x:0,y:0,width:0,height:0};if(e.xMin=f.x,e.xMax=f.x+f.width,e.yMin=f.y,e.yMax=f.y+f.height,e.leftSideBearing=e.xMin,void 0!==u)e.advanceWidth=Math.round(u*r+a);else e.advanceWidth=e.xMax+Math.abs(e.xMin)}else e.xMin=Math.round(e.xMin*r+a),e.xMax=Math.round(e.xMax*r+a),e.yMin=Math.round(e.yMin*o+s),e.yMax=Math.round(e.yMax*o+s),e.leftSideBearing=Math.round(e.leftSideBearing*r+a),e.advanceWidth=Math.round(u*r+a);return e}var t=require("graphics/pathAdjust"),i=require("graphics/pathCeil"),n=require("graphics/computeBoundingBox");return e}),define("ttf/ttf",["require","common/lang","./util/string","graphics/pathAdjust","graphics/pathCeil","graphics/computeBoundingBox","./util/glyfAdjust"],function(require){function e(e,t,i){i=i||{};var n=1;if(i.scale&&t.head.unitsPerEm&&t.head.unitsPerEm!==e.head.unitsPerEm)n=e.head.unitsPerEm/t.head.unitsPerEm;var r=t.glyf.filter(function(e){return e.contours&&e.contours.length&&".notdef"!==e.name&&".null"!==e.name&&"nonmarkingreturn"!==e.name});return r.forEach(function(t){s(t,n,n),e.glyf.push(t)}),r}function t(e){this.ttf=e}var i=require("common/lang"),n=require("./util/string"),r=require("graphics/pathAdjust"),o=require("graphics/pathCeil"),a=require("graphics/computeBoundingBox"),s=require("./util/glyfAdjust");return t.prototype.codes=function(){return Object.keys(this.ttf.cmap)},t.prototype.getCodeGlyfIndex=function(e){var t="number"==typeof e?e:e.charCodeAt(0),i=this.ttf.cmap[t]||0;return i},t.prototype.getCodeGlyf=function(e){var t=this.getCodeGlyfIndex(e);return this.getIndexGlyf(t)},t.prototype.getIndexGlyf=function(e){var t=this.ttf.glyf,i=t[e];return i},t.prototype.set=function(e){return delete this.ttf,this.ttf=e,this},t.prototype.get=function(){return this.ttf},t.prototype.addGlyf=function(e){return this.insertGlyf(e)},t.prototype.insertGlyf=function(e,t){if(t>=0&&t<this.ttf.glyf.length)this.ttf.glyf.splice(t,0,e);else this.ttf.glyf.push(e);return[e]},t.prototype.mergeGlyf=function(t,i){var n=e(this.ttf,t,i);return n},t.prototype.removeGlyf=function(e){for(var t=this.ttf.glyf,i=[],n=t.length-1;n>=0;n--)if(e.indexOf(n)>=0)i.push(t[n]),t.splice(n,1);return i},t.prototype.setUnicode=function(e,t){var i=this.ttf.glyf,r=[];if(t&&t.length){var o=t.indexOf(0);if(o>=0)t.splice(o,1);r=t.map(function(e){return i[e]})}else r=i.slice(1);if(r.length>1){var a=function(e){return 33>e};r=r.filter(function(e){return!e.unicode||!e.unicode.some(a)})}if(r.length)e=Number("0x"+e.slice(1)),r.forEach(function(t){if(160===e||12288===e)e++;t.unicode=[e],t.name=n.getUnicodeName(e),e++});return r},t.prototype.genGlyfName=function(e){var t=this.ttf.glyf,i=[];if(e&&e.length)i=e.map(function(e){return t[e]});else i=t;if(i.length){var r=this.ttf.glyf[0];i.forEach(function(e){if(e===r)e.name=".notdef";else if(e.unicode&&e.unicode.length)e.name=n.getUnicodeName(e.unicode[0]);else e.name=".notdef"})}return i},t.prototype.appendGlyf=function(e,t){var i=this.ttf.glyf,n=e.slice(0);if(t&&t.length){for(var r=Math.min(e.length,t.length),o=0;r>o;o++)i[t[o]]=e[o];e=e.slice(r)}if(e.length)Array.prototype.splice.apply(i,[i.length,0].concat(e));return n},t.prototype.adjustGlyfPos=function(e,t){var i=this.getGlyf(t),n=!1;if(void 0!==e.leftSideBearing)n=!0,i.forEach(function(t){if(t.leftSideBearing!==e.leftSideBearing)s(t,1,1,e.leftSideBearing-t.leftSideBearing)});if(void 0!==e.rightSideBearing)n=!0,i.forEach(function(t){t.advanceWidth=t.xMax+e.rightSideBearing});if(void 0!==e.verticalAlign){n=!0;var r=e.verticalAlign||0;i.forEach(function(e){if(e.contours&&e.contours.length){var t=a.computePath.apply(this,e.contours),i=r-t.y;s(e,1,1,0,i)}})}return n?i:[]},t.prototype.adjustGlyf=function(e,t){var i=this.getGlyf(t),n=!1;if(e.reverse||e.mirror)n=!0,i.forEach(function(t){if(t.contours&&t.contours.length){var i=t.xMax+t.xMin,n=t.yMax+t.yMin;t.contours.forEach(function(t){r(t,e.mirror?-1:1,e.reverse?-1:1),r(t,1,1,e.mirror?i:0,e.reverse?n:0)})}});if(e.scale&&1!==e.scale){n=!0;var u=e.scale;i.forEach(function(e){if(e.contours&&e.contours.length)s(e,u,u)})}else if(e.ajdustToEmBox){n=!0;var f=this.ttf.hhea.descent,h=this.ttf.head.unitsPerEm,c=2*(e.ajdustToEmPadding||0);i.forEach(function(e){if(e.contours&&e.contours.length){var t=e.advanceWidth-e.xMax,i=a.computePath.apply(null,e.contours),n=(h-c)/i.height;if(1!==n){var s=h/2+f-(i.y+i.height/2)*n;e.contours.forEach(function(e){r(e,n,n),r(e,1,1,0,s),o(e)});var u=a.computePathBox.apply(null,e.contours);e.xMin=u.x,e.xMax=u.x+u.width,e.yMin=u.y,e.yMax=u.y+u.height,e.leftSideBearing=e.xMin,e.advanceWidth=e.xMax+t}}})}return n?i:[]},t.prototype.getGlyf=function(e){var t=this.ttf.glyf;if(e&&e.length)return e.map(function(e){return t[e]});else return t},t.prototype.replaceGlyf=function(e,t){if(t>=0&&t<this.ttf.glyf.length)return this.ttf.glyf[t]=e,[e];else return[]},t.prototype.setGlyf=function(e){return delete this.glyf,this.ttf.glyf=e||[],this.ttf.glyf},t.prototype.setName=function(e){if(e)e.fontFamily=e.fontFamily||"fonteditor",e.fontSubFamily=e.fontSubFamily||"Medium",e.fullName=e.fontFamily,this.ttf.name=e;return this.ttf.name},t.prototype.setHead=function(e){if(e){if(e.unitsPerEm&&e.unitsPerEm>=64&&e.unitsPerEm<=16384)this.ttf.head.unitsPerEm=e.unitsPerEm;if(e.lowestRecPPEM&&e.lowestRecPPEM>=8&&e.lowestRecPPEM<=16384)this.ttf.head.lowestRecPPEM=e.lowestRecPPEM;if(e.created)this.ttf.head.created=e.created}return this.ttf.head},t.prototype.setHhea=function(e){return i.overwrite(this.ttf.hhea,e,["ascent","descent","lineGap"]),this.ttf.hhea},t.prototype.setOS2=function(e){return i.overwrite(this.ttf["OS/2"],e,["usWinAscent","usWinDescent","sTypoAscender","sTypoDescender","sTypoLineGap","sxHeight","bXHeight","usWeightClass","usWidthClass","yStrikeoutPosition","yStrikeoutSize","achVendID","bFamilyType","bSerifStyle","bWeight","bProportion","bContrast","bStrokeVariation","bArmStyle","bLetterform","bMidline","bXHeight"]),this.ttf["OS/2"]},t.prototype.setPost=function(e){return i.overwrite(this.ttf.post,e,["underlinePosition","underlineThickness"]),this.ttf.post},t.prototype.calcMetrics=function(){var e,t,i=-16384,n=16384,r=120,o=72;return this.ttf.glyf.forEach(function(a){if(a.yMax>i)i=a.yMax;if(a.yMin<n)n=a.yMin;if(a.unicode){if(a.unicode.indexOf(r)>=0)e=a.yMax;if(a.unicode.indexOf(o)>=0)t=a.yMax}}),i=Math.round(i),n=Math.round(n),{ascent:i,descent:n,sTypoAscender:i,sTypoDescender:n,usWinAscent:i,usWinDescent:-n,sxHeight:e||0,sCapHeight:t||0}},t}),define("fonteditor/widget/ttfmanager",["require","common/lang","editor/widget/History","ttf/ttf","ttf/util/string","common/observable"],function(require){function e(e){return e.forEach(function(e){delete e.modify}),e}function t(e){this.ttf=new r(e),this.changed=!1,this.history=new n}var i=require("common/lang"),n=require("editor/widget/History"),r=require("ttf/ttf"),o=require("ttf/util/string");return t.prototype.fireChange=function(e,t){return e&&this.history.add(i.clone(this.ttf.getGlyf())),this.changed=!0,this.fire("change",{ttf:this.ttf.get(),changeType:t||"change"}),this},t.prototype.set=function(t){if(this.ttf.get()!==t)this.ttf.set(t),e(this.ttf.getGlyf()),this.history.reset(),this.history.add(i.clone(this.ttf.getGlyf())),this.changed=!1,this.fire("set",{ttf:this.ttf.get()});return this},t.prototype.get=function(){return this.ttf.get()},t.prototype.findGlyf=function(e){for(var t=this.ttf.getGlyf(),i=0,n=t.length;n>i;i++){var r=t[i];if(r.unicode&&r.unicode.length&&r.unicode.indexOf(e)>=0)return i}return-1},t.prototype.insertGlyf=function(e,t){var i=this.ttf.getGlyf(),n=32;if(!e.unicode||!e.unicode.length){for(var r=i.length-1;r>0;r--){var a=i[r];if(a.unicode&&a.unicode.length){var s=Math.max.apply(null,a.unicode);n=Math.max(s,n)}}if(n++,65535===n)n++;e.unicode=[n]}if(!e.name)e.name=o.getUnicodeName(e.unicode[0]);return e.modify="new",this.ttf.insertGlyf(e,t),this.fireChange(!0),this},t.prototype.merge=function(e,t){var i=this.ttf.mergeGlyf(e,t);if(i.length)i.forEach(function(e){e.modify="new"}),this.fireChange(!0);return this},t.prototype.removeGlyf=function(e){var t=this.ttf.removeGlyf(e);if(t.length)this.fireChange(!0);return this},t.prototype.setUnicode=function(e,t){var i=this.ttf.setUnicode(e,t);if(i.length)i.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.genGlyfName=function(e){var t=this.ttf.genGlyfName(e);if(t.length)t.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.appendGlyf=function(e,t){var i=this.ttf.appendGlyf(e,t);if(i.length)i.forEach(function(e){e.modify="new"}),this.fireChange(!0);return this},t.prototype.replaceGlyf=function(e,t){var i=this.ttf.replaceGlyf(e,t);if(i.length)i[0].modify="edit",this.fireChange(!0,"replace");return this},t.prototype.adjustGlyfPos=function(e,t){var i=this.ttf.adjustGlyfPos(e,t);if(i.length)i.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.adjustGlyf=function(e,t){var i=this.ttf.adjustGlyf(e,t);if(i.length)i.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.updateGlyf=function(e,t){var i=this.getGlyf([t])[0],n=!1;if(e.unicode.length)i.unicode=e.unicode,i.modify="edit",n=!0;if(e.name!==i.name)i.name=e.name,i.modify="edit",n=!0;if(void 0!==e.leftSideBearing&&e.leftSideBearing!==i.leftSideBearing||void 0!==e.rightSideBearing&&e.rightSideBearing+(i.xMax||0)!==i.advanceWidth){var r=this.ttf.adjustGlyfPos(e,[t]);if(r.length)r.forEach(function(e){e.modify="edit"}),n=!0}return n&&this.fireChange(!0),this},t.prototype.getGlyf=function(e){return this.ttf.getGlyf(e)},t.prototype.setInfo=function(e){var t=!1;if(this.ttf.get().head.unitsPerEm!==e.unitsPerEm)t=!0;if(this.ttf.setName(e),this.ttf.setHead(e),t)this.fireChange(!1);return this},t.prototype.setMetrics=function(e){var t=!1;if(this.ttf.get().hhea.descent!==e.descent)t=!0;if(this.ttf.setHhea(e),this.ttf.setOS2(e),this.ttf.setPost(e),t)this.fireChange(!1);return this},t.prototype.undo=function(){if(!this.history.atFirst())this.ttf.setGlyf(this.history.back()),this.fireChange(!1);return this},t.prototype.redo=function(){if(!this.history.atLast())this.ttf.setGlyf(this.history.forward()),this.fireChange(!1);return this},t.prototype.isChanged=function(){return!!this.changed},t.prototype.setState=function(e){if("new"===e)this.changed=!1;else if("saved"===e)this.ttf.get().glyf.forEach(function(e){delete e.modify}),this.fire("change",{ttf:this.ttf.get(),changeType:e}),this.changed=!1;return this},t.prototype.clearGlyfTag=e,t.prototype.calcMetrics=function(){if(this.ttf)return this.ttf.calcMetrics();else return void 0},t.prototype.dispose=function(){this.un(),delete this.ttf},require("common/observable").mixin(t.prototype),t}),define("fonteditor/widget/commandmenu",["require","common/observable"],function(require){function e(e){for(var t={},i=0,n=e.length;n>i;i++)if(e[i])t[e[i]]=!0;return t}function t(){var e=this;this.main.on("click","[data-id]",function(){if(!this.getAttribute("data-disabled")){var t=this.getAttribute("data-id"),i=e.commands[t];if(i){var n=i.name;if("toggle"===i.type){if(i.on)return this.removeAttribute("data-on"),i.on=!1,void e.fire("command:un",{command:n,args:i});this.setAttribute("data-on",1),i.on=!0}e.fire("command",{command:n,args:i})}}})}function i(e,i){if(i=i||{},this.main=$(e),this.commands=i.commands||[],t.call(this),this.commands.length)this.setCommands()}var n=require("common/observable");return i.prototype.setCommands=function(e){e=e||this.commands;var t="";return e.forEach(function(e,i){if("split"===e.type)t+='<li data-id="-1" data-split="1"></li>';else{if(t+='<li data-id="'+i+'"'+(e.disabled?' data-disabled="1"':"")+(e.on?' data-on="1"':"")+(e.ico?'data-theme="ico" title="'+e.title+'"':"")+">",e.ico)t+='<i class="ico i-'+e.ico+'"></i>';else t+=e.title+(e.quickKey?"(<i>"+e.quickKey+"</i>)":"");t+="</li>"}}),this.main.html(t),this.commands=e,this},i.prototype.disableCommands=function(t){var i=this.main.find("[data-id]");if(t)t=e(t),this.commands.forEach(function(e,n){if(t[e.name])e.disabled=!0,$(i[n]).attr("data-disabled",1)});return this},i.prototype.enableCommands=function(t){var i=this.main.find("[data-id]");if(t)t=e(t),this.commands.forEach(function(e,n){if(t[e.name])delete e.disabled,$(i[n]).attr("data-disabled",null)});return this},i.prototype.removeCommands=function(t){if(t){t=e(t);for(var i=this.commands.length;i>=0;i--){var n=this.commands[i];if(t[n.name])this.commands.splice(i,1),this.main.find('[data-id="'+i+'"]').remove()}}return this},i.prototype.show=function(){return this.main.show(),this},i.prototype.hide=function(){return this.main.hide(),this},i.prototype.dispose=function(){this.main.un("click","[data-id]"),this.main=null,this.commands=null},n.mixin(i.prototype),i}),define("fonteditor/widget/pager",["require","common/observable"],function(require){function e(e,t){this.main=$(e),this.options=t||{},this.main.html(i),this.textPage=this.main.find('input[data-pager="text"]');var n=this;n.main.on("click","button[data-pager]",function(){if(!this.getAttribute("data-disabled")){var e=this.getAttribute("data-pager"),t=n.page;if("prev"===e)t=n.page>1?n.page-1:1;else if("next"===e)t=n.page<n.totalPage?n.page+1:n.totalPage;else if("goto"===e){var i=+n.textPage.val();if(i>=1&&i<=n.totalPage)t=i;else t=n.page}if(n.textPage.val(t),t!==n.page)n.page=t,n.fire("change",{page:t})}}),n.textPage.on("keyup",function(e){if(13===e.keyCode){var t=+this.value.trim();if(t>=1&&t<=n.totalPage)n.page=t,n.fire("change",{page:t});else this.value=n.page}})}var t=require("common/observable"),i='<button data-pager="prev" type="button" class="btn btn-flat btn-new btn-sm">上一页</button><input data-pager="text" type="text" class="form-control"><span data-pager="info"></span><button data-pager="goto" type="button" class="btn btn-flat btn-new btn-sm">转到</button><button data-pager="next" type="button" class="btn btn-flat btn-new btn-sm">下一页</button>';return e.prototype.show=function(e,t,i){if(t>=i)this.hide();else this.page=e,this.totalPage=Math.ceil(i/t),this.main.find('[data-pager="text"]').val(e),this.main.find('[data-pager="info"]').html("/ "+this.totalPage),this.main.find('[data-pager="prev"]')[1===e?"attr":"removeAttr"]("data-disabled",1),this.main.find('[data-pager="next"]')[e===this.totalPage?"attr":"removeAttr"]("data-disabled",1);this.main.show()},e.prototype.hide=function(){this.main.hide()},e.prototype.dispose=function(){this.main.un("click","button[data-pager]"),this.main.find('input[data-pager="text"]').un("keyup")},t.mixin(e.prototype),e}),define("common/ajaxFile",["require"],function(){function e(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){if(e.onSuccess)if("binary"===e.type){var i=t.responseBlob||t.response;e.onSuccess(i)}else if("xml"===e.type)e.onSuccess(t.responseXML);else if("json"===e.type)e.onSuccess(JSON.parse(t.responseText));else e.onSuccess(t.responseText)}else if(t.status>200)if(e.onError)e.onError(t,t.status)};var i=(e.method||"GET").toUpperCase(),n=null;if(e.params){var r=[];if(Object.keys(e.params).forEach(function(t){r.push(t+"="+encodeURIComponent(e.params[t]))}),r=r.join("&"),"GET"===i)e.url+=(-1===e.url.indexOf("?")?"?":"&")+r;else n=r}if(t.open(i,e.url,!0),"binary"===e.type)t.responseType="arraybuffer";t.send(n)}return e}),define("fonteditor/controller/actions",["require","../dialog/support","../widget/program","common/ajaxFile","common/string"],function(require){function e(e,t){n({type:"svg"===e?"xml":"binary",url:t,onSuccess:function(t){i.loader.load(t,{type:e||"ttf",success:function(e){if(i.loading.hide(),i.ttfManager.get())i.ttfManager.merge(e,{scale:!0});else i.ttfManager.set(e),i.data.projectId=null}})},onError:function(){alert("加载文件错误!")}})}var t=require("../dialog/support"),i=require("../widget/program"),n=require("common/ajaxFile"),r=require("common/string"),o=setTimeout(function(){i.editor.focus()},20),a={undo:function(){if(i.editor.isEditing())i.editor.undo(),o();else i.ttfManager.undo()},redo:function(){if(i.editor.isEditing())i.editor.redo(),o();else i.ttfManager.redo()},"new":function(){if(!i.ttfManager.isChanged()||window.confirm("是否放弃保存当前编辑的项目?"))$.getJSON("./font/empty.json",function(e){i.ttfManager.set(e),i.data.projectId=null})},open:function(){$("#font-import").click()},"import":function(){$("#font-import").click()},"export":function(e){if(!e.target.getAttribute("download"))e.preventDefault()},"export-file":function(e){if(i.ttfManager.get()){var t=$(e.target);i.exporter["export"](i.ttfManager.get(),{type:t.attr("data-type"),target:t,originEvent:e,error:function(){e.preventDefault()}})}},save:function(){if(i.ttfManager.get())if(i.data.projectId)i.project.update(i.data.projectId,i.ttfManager.get()),i.ttfManager.setState("saved"),i.loading.show("保存成功..",400);else{var e=i.ttfManager.get().name.fontFamily||"";if(e=window.prompt("请输入项目名称：",e)){e=r.encodeHTML(e);var t=i.project.add(e,i.ttfManager.get());i.data.projectId=t,i.ttfManager.setState("new"),i.projectViewer.show(i.project.items()),i.projectViewer.select(t),i.loading.show("保存成功..",400)}}},"add-new":function(){if(i.ttfManager.get()){var e=i.viewer.getSelected();i.ttfManager.insertGlyf({},e[0])}},"add-online":function(){var n=t.online;!new n({onChange:function(t){i.loading.show("正在加载..",1e3),setTimeout(function(){var n=t.slice(t.lastIndexOf(".")+1),o=t;if(/^https?:\/\//i.test(t))o=r.format(i.fontUrl,[encodeURIComponent(t)]);e(n,o)},20)}}).show()},"add-url":function(){var n=t.url;!new n({onChange:function(t){i.loading.show("正在加载..",1e3),setTimeout(function(){var n=r.format(i.fontUrl,[encodeURIComponent(t)]);e(t.slice(t.lastIndexOf(".")+1),n)},20)}}).show()},preview:function(e){var t=i.ttfManager.get();if(t){var n=e.target.getAttribute("data-format");i.previewer.load(t,n)}},"setting-name":function(){var e=i.ttfManager.get();if(e){var n=t.name;!new n({onChange:function(e){i.ttfManager.setInfo(e)}}).show($.extend({},e.head,e.name))}},"setting-metrics":function(){var e=i.ttfManager.get();if(e){var n=t.metrics;!new n({onChange:function(e){i.ttfManager.setMetrics(e)}}).show($.extend({},e["OS/2"],e.hhea,e.post))}},"setting-glyf-name":function(){var e=i.ttfManager.get();if(e)if(window.confirm("生成的字形名称会覆盖原来的名称，确定生成？"))i.ttfManager.genGlyfName(i.viewer.getSelected())},"setting-editor":function(){var e=t.editor;!new e({onChange:function(e){i.setting.set("editor",e,e.saveSetting),setTimeout(function(){i.viewer.setSetting(e.viewer),i.editor.setSetting(e.editor)},20)}}).show(i.setting.get("editor"))}};return a}),define("fonteditor/controller/default",["require","common/lang","../dialog/support","editor/widget/clipboard","./actions","ttf/util/glyfAdjust"],function(require){function e(e){var t={unitsPerEm:e.head.unitsPerEm,metrics:{ascent:e.hhea.ascent,descent:e.hhea.descent,capHeight:e["OS/2"].sCapHeight||.8*e.hhea.ascent,xHeight:e["OS/2"].sxHeight||.4*e.head.unitsPerEm}};return t}function t(t){var i=u.ttfManager.get();if(i){$(".main").addClass("editing"),$(".editor").addClass("editing"),u.viewer.setMode("editor"),u.viewer.blur(),u.editor.show(),u.editor.setAxis(e(i));var n=i.glyf[t];if(n)if(n.compond)alert("暂不支持复合字形!");else u.editor.setFont(f.clone(n));u.editor.focus()}}function i(){$(".main").removeClass("editing"),$(".editor").removeClass("editing"),u.editor&&u.editor.hide(),u.viewer.clearEditing(),u.viewer.setMode("list"),u.viewer.focus()}function n(e,t,i){var n=e.glyf.length,r=u.setting.get("editor").viewer.pageSize,o=Math.ceil(n/r);if(t>o)t=o;else if(1>t)t=1;if(u.viewer.setPage(t-1),u.viewer.show(e,i||u.viewer.getSelected()),u.viewer.focus(),n>r)u.viewerPager.show(t,r,n);else u.viewerPager.hide()}function r(e){e.viewer.on("del",function(t){if(t.list)e.ttfManager.removeGlyf(t.list)}).on("edit",function(i){if(!e.editor.isChanged()||confirm("是否放弃保存当前编辑的字形?"))$(".main").addClass("editing"),$(".editor").addClass("editing"),t(i.list[0])}).on("copy",function(t){var i=e.ttfManager.getGlyf(t.list),n={unitsPerEm:e.ttfManager.get().head.unitsPerEm,glyf:i};c.set(n,"glyf")}).on("cut",function(t){var i=e.ttfManager.getGlyf(t.list),n={unitsPerEm:e.ttfManager.get().head.unitsPerEm,glyf:i};c.set(n,"glyf"),e.ttfManager.removeGlyf(t.list)}).on("paste",function(){var t=c.get("glyf");if(t&&t.glyf.length){if(e.ttfManager.get().head.unitsPerEm!==t.unitsPerEm){var i=e.ttfManager.get().head.unitsPerEm/(t.unitsPerEm||1024);t.glyf.forEach(function(e){l(e,i,i)})}e.ttfManager.appendGlyf(t.glyf,e.viewer.getSelected())}}).on("undo",function(){e.ttfManager.undo()}).on("redo",function(){e.ttfManager.redo()}).on("adjust-pos",function(){var t=e.viewer.getSelected(),i={};if(1===t.length){var n=e.ttfManager.getGlyf(t)[0];i={unicode:n.unicode,leftSideBearing:n.leftSideBearing,rightSideBearing:n.advanceWidth-n.xMax}}var r=h["adjust-pos"];!new r({onChange:function(i){setTimeout(function(){e.ttfManager.adjustGlyfPos(i,t)},20)}}).show(i)}).on("adjust-glyf",function(){var t=h["adjust-glyf"];!new t({onChange:function(t){setTimeout(function(){e.ttfManager.adjustGlyf(t,e.viewer.getSelected())},20)}}).show()}).on("setting-font",function(){var t=e.viewer.getSelected();if(t.length){var i=e.ttfManager.getGlyf(t)[0],n=h.glyf;!new n({onChange:function(i){e.ttfManager.updateGlyf(i,t[0])}}).show({unicode:i.unicode,leftSideBearing:i.leftSideBearing,rightSideBearing:i.advanceWidth-(i.xMax||0),name:i.name})}}).on("find-glyf",function(){var t=h["find-glyf"];!new t({onChange:function(t){var i=e.ttfManager.findGlyf(t.unicode[0]);if(-1!==i){var r=e.setting.get("editor").viewer.pageSize,o=Math.ceil(i/r);n(e.ttfManager.get(),o,[i])}else alert("未找到相关字形!")}}).show()}).on("setting-unicode",function(){var t=h.unicode;!new t({onChange:function(t){setTimeout(function(){if(e.ttfManager.get()){var i=e.viewer.getSelected();e.ttfManager.setUnicode(t,i)}},20)}}).show()}).on("refresh",function(){n(e.ttfManager.get(),1)}).on("moveleft",function(){var i=e.viewer.getEditing();if(e.editor.isVisible()&&i>0)e.viewer.setEditing(--i),t(i)}).on("moveright",function(){var i=e.viewer.getEditing();if(e.editor.isVisible()&&i<e.ttfManager.get().glyf.length-1)e.viewer.setEditing(++i),t(i)}),e.viewerPager.on("change",function(t){n(e.ttfManager.get(),t.page)})}function o(e){e.projectViewer.on("open",function(t){var i=e.project.get(t.projectId);if(i){if(e.ttfManager.isChanged()&&!window.confirm("是否放弃保存当前编辑项目?"))return;e.ttfManager.set(i),e.data.projectId=t.projectId,e.projectViewer.select(t.projectId),e.viewer.focus()}}).on("saveas",function(){e.data.projectId=null,d.save(),e.viewer.focus()}).on("del",function(t){if(e.project.remove(t.projectId),t.projectId===e.data.projectId)e.data.projectId=null;e.viewer.focus()})}function a(e){e.ttfManager.on("change",function(t){var i=e.viewer.getEditing();if("update"===t.changeType&&e.editor.isEditing()&&-1!==i)e.viewer.refresh(t.ttf,[i]);else n(t.ttf,e.viewer.getPage()+1)}).on("set",function(t){if(!e.viewer.inited)e.viewer.setMode("list"),e.viewer.inited=!0;n(t.ttf,1,[])})}function s(e){e.on("save",function(t){if(e.ttfManager.get()){var i=t.type;if("editor"===i||e.editor.isEditing()){var n=e.viewer.getEditing();if(-1!==n)e.ttfManager.replaceGlyf(e.editor.getFont(),n);else e.ttfManager.insertGlyf(e.editor.getFont());e.editor.setChanged(!1)}else d.save()}}).on("paste",function(){var t=c.get("glyf");if(t&&t.glyf.length)if(!e.editor.isEditing())e.viewer.fire("paste");else e.editor.addContours(t.glyf[0].contours)}).on("function",function(n){if(113===n.keyCode)if(!e.editor.isVisible())t();else i()})}var u,f=require("common/lang"),h=require("../dialog/support"),c=require("editor/widget/clipboard"),d=require("./actions"),l=require("ttf/util/glyfAdjust");return{init:function(e){u=e,r(e),a(e),o(e),s(e),$(".close-editor").click(function(){i()}),e.init({viewer:e.viewer.main.get(0),editor:e.editor.main.get(0)}),window.onbeforeunload=function(){if(e.ttfManager.isChanged())return"是否放弃保存当前编辑的项目?";else return void 0}}}}),define("fonteditor/setting/editor",["require"],function(){var e={saveSetting:!0,viewer:{color:"",shapeSize:"normal",pageSize:100},editor:{sorption:{enableGrid:!1,enableShape:!0},fontLayer:{strokeColor:"#999",fill:!0,fillColor:"#555"},referenceline:{style:{strokeColor:"#0FF"}},axis:{showGrid:!0,gapColor:"#A6A6FF",metricsColor:"red",graduation:{gap:100}}}};return e}),define("fonteditor/widget/settingmanager",["require","common/lang","common/string","../setting/editor"],function(require){var e=require("common/lang"),t=require("common/string"),i=require("../setting/editor"),n=window.localStorage,r={},o={get:function(t){if(!t)throw"setting name empty";if(r[t])return r[t];var i=null,o=n.getItem("setting."+t);if(o)i=e.overwrite(this.getDefault(t),JSON.parse(o));else i=this.getDefault(t);return r[t]=i},set:function(e,i,o){if(!e)throw"setting name empty";if(o){var a=JSON.stringify(i),s=JSON.stringify(this.getDefault(e));if(t.hashcode(a)!==t.hashcode(s))n.setItem("setting."+e,a);else n.removeItem("setting."+e)}return r[e]=i},isStored:function(e){return!!n.getItem("setting."+e)},getDefault:function(t){if("editor"===t)return e.clone(i);else return null}};return o}),define("fonteditor/menu/viewer",["require"],function(){return[{name:"copy",title:"复制",quickKey:"C",disabled:!0},{name:"cut",title:"剪切",quickKey:"X"},{name:"paste",title:"粘贴",quickKey:"V"},{name:"del",title:"删除",quickKey:"D",disabled:!0},{type:"split"},{name:"adjust-pos",title:"调整位置"},{name:"adjust-glyf",title:"调整字形"},{name:"setting-font",title:"字形信息",disabled:!0},{type:"split"},{name:"find-glyf",title:"查找字形"},{name:"setting-unicode",title:"设置代码点"}]}),define("fonteditor/menu/editor",["require"],function(){return[{name:"copyshapes",title:"复制",quickKey:"C",disabled:!0},{name:"pasteshapes",title:"粘贴",quickKey:"V"},{name:"removeshapes",title:"删除",quickKey:"D",disabled:!0},{name:"save",title:"保存",quickKey:"S"},{type:"split"},{name:"rangemode",title:"轮廓模式",ico:"rangemode"},{name:"pointmode",title:"点模式",ico:"pointmode"},{type:"split"},{name:"upshape",title:"上移一层",ico:"upshape",disabled:!0},{name:"downshape",title:"下移一层",ico:"downshape",disabled:!0},{name:"reversepoints",title:"改变方向",ico:"reversepoints",disabled:!0},{type:"split"},{name:"horizontalalignshapes",title:"左对齐",ico:"alignleft",align:"left",disabled:!0},{name:"horizontalalignshapes",title:"居中对齐",ico:"aligncenter",align:"center",disabled:!0},{name:"horizontalalignshapes",title:"右对齐",ico:"alignright",align:"right",disabled:!0},{name:"verticalalignshapes",title:"顶端对齐",ico:"aligntop",align:"ascent",disabled:!0},{name:"verticalalignshapes",title:"居中对齐",ico:"alignmiddle",align:"middle",disabled:!0},{name:"verticalalignshapes",title:"底端对齐",ico:"aligndescent",align:"descent",disabled:!0},{name:"verticalalignshapes",title:"基线对齐",ico:"alignbaseline",align:"baseline",disabled:!0},{type:"split"},{name:"rotateleft",title:"向左旋转",ico:"rotateleft",disabled:!0},{name:"rotateright",title:"向右旋转",ico:"rotateright",disabled:!0},{name:"flipshapes",title:"翻转",ico:"flip",disabled:!0},{name:"mirrorshapes",title:"镜像",ico:"mirror",disabled:!0},{type:"split"},{name:"splitshapes",title:"切割轮廓",ico:"splitshapes"},{name:"joinshapes",title:"合并轮廓",ico:"joinshapes",disabled:!0},{name:"intersectshapes",title:"相交轮廓",ico:"intersectshapes",disabled:!0},{name:"tangencyshapes",title:"相切轮廓",ico:"tangencyshapes",disabled:!0}]}),define("fonteditor/widget/project",["require"],function(){var e=window.localStorage||window.sessionStorate,t={items:function(){var t=e.getItem("project-list");
return t?JSON.parse(t).map(function(e){return e.id=""+e.id,e}):[]},add:function(t,i){var n=this.items(),r=""+Date.now();return n.push({name:t,id:r}),e.setItem("project-list",JSON.stringify(n)),e.setItem(r,JSON.stringify(i)),r},update:function(t,i){return e.setItem(t,JSON.stringify(i)),t},remove:function(t){for(var i=this.items(),n=i.length-1;n>=0;n--)if(i[n].id===t)e.removeItem(i[n].id),i.splice(n,1);return e.setItem("project-list",JSON.stringify(i)),i},get:function(t){for(var i=this.items(),n=0,r=i.length;r>n;n++)if(i[n].id===t){var o=e.getItem(i[n].id);if(o)return JSON.parse(o)}return null},clear:function(){var t=this.items();t.forEach(function(t){e.removeItem(t.id)}),e.removeItem("project-list")}};return t}),define("ttf/table/struct",["require"],function(){var e={Int8:1,Uint8:2,Int16:3,Uint16:4,Int32:5,Uint32:6,Fixed:7,FUnit:8,F2Dot14:11,LongDateTime:12,Char:13,String:14,Bytes:15},t={};return Object.keys(e).forEach(function(i){t[e[i]]=i}),e.names=t,e}),define("ttf/error",["require","common/string"],function(require){var e=require("common/string"),t={10001:"超出读取范围：${0}, ${1}",10002:"超出写入范围：${0}, ${1}",10003:"未知数据类型：${0}, ${1}",10004:"不支持svg解析",10101:"错误的ttf文件",10102:"错误的woff文件",10103:"错误的svg文件",10104:"读取ttf文件错误",10105:"读取woff文件错误",10106:"读取svg文件错误",10107:"写入ttf文件错误",10108:"写入woff文件错误",10109:"写入svg文件错误",10110:"读取eot文件错误",10111:"读取eot字体错误",10200:"重复的unicode代码点，字形序号：${0}",10201:"字形轮廓数据为空",10202:"不支持标志位：ARGS_ARE_XY_VALUES",10203:"未找到表：${0}",10204:"读取表错误",10205:"未找到解压函数"};return t.raise=function(i){var n=t[i];if(arguments.length>1){var r="object"==typeof arguments[1]?arguments[1]:Array.prototype.slice.call(arguments,1);n=e.format(n,r)}var o=new Error(n);throw o.number=i,o},t}),define("ttf/table/table",["require","./struct","common/lang","../error"],function(require){function e(e){var t=this.offset;if(void 0!==t)e.seek(t);var i=this;return this.struct.forEach(function(t){var n=t[0],o=t[1];switch(o){case r.Int8:case r.Uint8:case r.Int16:case r.Uint16:case r.Int32:case r.Uint32:var s=r.names[o];i[n]=e.read(s);break;case r.Fixed:i[n]=e.readFixed();break;case r.LongDateTime:i[n]=e.readLongDateTime();break;case r.Bytes:i[n]=e.readBytes(e.offset,t[2]||0);break;case r.Char:i[n]=e.readChar();break;case r.String:i[n]=e.readString(e.offset,t[2]||0);break;default:a.raise(10003,n,o)}}),this.valueOf()}function t(e,t){var i=t[this.name];if(!i)a.raise(10203,this.name);return this.struct.forEach(function(t){var n=t[0],o=t[1];switch(o){case r.Int8:case r.Uint8:case r.Int16:case r.Uint16:case r.Int32:case r.Uint32:var s=r.names[o];e.write(s,i[n]);break;case r.Fixed:e.writeFixed(i[n]);break;case r.LongDateTime:e.writeLongDateTime(i[n]);break;case r.Bytes:e.writeBytes(i[n],t[2]||0);break;case r.Char:e.writeChar(i[n]);break;case r.String:e.writeString(i[n],t[2]||0);break;default:a.raise(10003,n,o)}}),e}function i(){var e=0;return this.struct.forEach(function(t){var i=t[1];switch(i){case r.Int8:case r.Uint8:e+=1;break;case r.Int16:case r.Uint16:e+=2;break;case r.Int32:case r.Uint32:case r.Fixed:e+=4;break;case r.LongDateTime:e+=8;break;case r.Bytes:e+=t[2]||0;break;case r.Char:e+=1;break;case r.String:e+=t[2]||0;break;default:a.raise(10003,name,i)}}),e}function n(){var e={},t=this;return this.struct.forEach(function(i){e[i[0]]=t[i[0]]}),e}var r=require("./struct"),o=require("common/lang").extend,a=require("../error"),exports={read:e,write:t,size:i,valueOf:n,create:function(r,a,s){function u(e){this.name=r,this.struct=a,this.offset=e}return u.prototype.read=e,u.prototype.write=t,u.prototype.size=i,u.prototype.valueOf=n,o(u.prototype,s),u}};return exports}),define("ttf/table/directory",["require","./table"],function(require){var e=require("./table"),t=e.create("directory",[],{read:function(e,t){for(var i={},n=t.numTables,r=this.offset,o=r,a=16*n;a>o;o+=16){var s=e.readString(o,4);i[s]={name:s,checkSum:e.readUint32(o+4),offset:e.readUint32(o+8),length:e.readUint32(o+12)}}return i},write:function(e,t){for(var i=t.support.tables,n=0,r=i.length;r>n;n++)e.writeString(i[n].name),e.writeUint32(i[n].checkSum),e.writeUint32(i[n].offset),e.writeUint32(i[n].length);return e},size:function(e){return 16*e.numTables}});return t}),define("ttf/table/head",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct"),i=e.create("head",[["version",t.Fixed],["fontRevision",t.Fixed],["checkSumAdjustment",t.Uint32],["magickNumber",t.Uint32],["flags",t.Uint16],["unitsPerEm",t.Uint16],["created",t.LongDateTime],["modified",t.LongDateTime],["xMin",t.Int16],["yMin",t.Int16],["xMax",t.Int16],["yMax",t.Int16],["macStyle",t.Uint16],["lowestRecPPEM",t.Uint16],["fontDirectionHint",t.Int16],["indexToLocFormat",t.Int16],["glyphDataFormat",t.Int16]]);return i}),define("ttf/table/maxp",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct"),i=e.create("maxp",[["version",t.Fixed],["numGlyphs",t.Uint16],["maxPoints",t.Uint16],["maxContours",t.Uint16],["maxCompositePoints",t.Uint16],["maxCompositeContours",t.Uint16],["maxZones",t.Uint16],["maxTwilightPoints",t.Uint16],["maxStorage",t.Uint16],["maxFunctionDefs",t.Uint16],["maxInstructionDefs",t.Uint16],["maxStackElements",t.Uint16],["maxSizeOfInstructions",t.Uint16],["maxComponentElements",t.Uint16],["maxComponentDepth",t.Int16]],{write:function(t,i){return e.write.call(this,t,i.support),t},size:function(){return 32}});return i}),define("ttf/table/loca",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct"),i=e.create("loca",[],{read:function(e,i){var n=this.offset,r=i.head.indexToLocFormat,o=t.names[0===r?t.Uint16:t.Uint32],a=0===r?2:4,s=0===r?2:1,u=[];e.seek(n);for(var f=i.maxp.numGlyphs,h=0;f>h;++h)u.push(e.read(o,n,!1)*s),n+=a;return u},write:function(e,t){for(var i=t.support.glyf,n=t.support.glyf.offset||0,r=t.head.indexToLocFormat,o=0===r?.5:1,a=t.glyf.length,s=0;a>s;++s){if(r)e.writeUint32(n);else e.writeUint16(n);n+=i[s].size*o}if(r)e.writeUint32(n);else e.writeUint16(n);return e},size:function(e){var t=e.glyf.length+1;return e.head.indexToLocFormat?4*t:2*t}});return i}),define("ttf/enum/glyFlag",["require"],function(){var e={ONCURVE:1,XSHORT:2,YSHORT:4,REPEAT:8,XSAME:16,YSAME:32,Reserved1:64,Reserved2:128};return e}),define("ttf/enum/componentFlag",["require"],function(){var e={ARG_1_AND_2_ARE_WORDS:1,ARGS_ARE_XY_VALUES:2,ROUND_XY_TO_GRID:4,WE_HAVE_A_SCALE:8,RESERVED:16,MORE_COMPONENTS:32,WE_HAVE_AN_X_AND_Y_SCALE:64,WE_HAVE_A_TWO_BY_TWO:128,WE_HAVE_INSTRUCTIONS:256,USE_MY_METRICS:512,OVERLAP_COMPOUND:1024,SCALED_COMPONENT_OFFSET:2048,UNSCALED_COMPONENT_OFFSET:4096};return e}),define("ttf/table/glyfcontour",["require","../enum/glyFlag","./table","../enum/componentFlag","../error"],function(require){function e(e,i,n,r){e.seek(n);var o,a,s,u=r.endPtsOfContours[r.endPtsOfContours.length-1]+1,f=[];for(o=0;u>o;)if(s=e.readUint8(),f.push(s),o++,s&t.REPEAT&&u>o)for(var h=e.readUint8(),c=0;h>c;c++)f.push(s),o++;var d,l=[],p=[],g=0;for(o=0,a=f.length;a>o;++o){if(d=0,s=f[o],s&t.XSHORT)d=e.readUint8(),d=s&t.XSAME?d:-1*d;else if(s&t.XSAME)d=0;else d=e.readInt16();if(g+=d,p[o]=g,l[o]={x:g,y:0},s&t.ONCURVE)l[o].onCurve=!0}var m,y=[],v=0;for(o=0,a=f.length;a>o;o++){if(m=0,s=f[o],s&t.YSHORT)m=e.readUint8(),m=s&t.YSAME?m:-1*m;else if(s&t.YSAME)m=0;else m=e.readInt16();if(v+=m,y[o]=v,l[o])l[o].y=v}if(l.length){var x=r.endPtsOfContours,w=[];for(w.push(l.slice(0,x[0]+1)),o=1,a=x.length;a>o;o++)w.push(l.slice(x[o-1]+1,x[o]+1));r.contours=w}return r}var t=require("../enum/glyFlag"),i=require("./table"),n=require("../enum/componentFlag"),r=require("../error"),o=i.create("contour",[],{read:function(t,i){var a,s,u,f=this.offset,h=o.empty();t.seek(f);var c=t.readInt16();if(h.xMin=t.readInt16(),h.yMin=t.readInt16(),h.xMax=t.readInt16(),h.yMax=t.readInt16(),c>=0){var d=[];if(c>=0){for(a=0;c>a;a++)d.push(t.readUint16());h.endPtsOfContours=d}if(s=t.readUint16()){for(u=[],a=0;s>a;++a)u.push(t.readUint8());h.instructions=u}e.call(this,t,i,t.offset,h),delete h.endPtsOfContours}else{h.compound=!0,h.glyfs=[];var l,p;do{l=t.readUint16(),p={},p.flags=l,p.glyphIndex=t.readUint16();var g=0,m=0,y=16384,v=16384,x=0,w=0;if(n.ARG_1_AND_2_ARE_WORDS&l)g=t.readInt16(),m=t.readInt16();else g=t.readInt8(),m=t.readInt8();if(n.ROUND_XY_TO_GRID&l)g=Math.round(g),m=Math.round(m);if(n.WE_HAVE_A_SCALE&l)y=t.readInt16(),v=y;else if(n.WE_HAVE_AN_X_AND_Y_SCALE&l)y=t.readInt16(),v=t.readInt16();else if(n.WE_HAVE_A_TWO_BY_TWO&l)y=t.readInt16(),x=t.readInt16(),w=t.readInt16(),v=t.readInt16();if(n.ARGS_ARE_XY_VALUES&l)p.useMyMetrics=!!l&n.USE_MY_METRICS,p.overlapCompound=!!l&n.OVERLAP_COMPOUND,p.transform={a:Math.round(1e4*y/16384)/1e4,b:Math.round(1e4*x/16384)/1e4,c:Math.round(1e4*w/16384)/1e4,d:Math.round(1e4*v/16384)/1e4,e:g,f:m};else r.raise(10202);h.glyfs.push(p)}while(n.MORE_COMPONENTS&l);if(n.WE_HAVE_INSTRUCTIONS&l){for(s=t.readUint16(),u=[],a=0;s>a;++a)u.push(t.readUint8());h.instructions=u}}return h}});return o.empty=function(){var e={};return e.contours=[],e},o}),define("ttf/table/glyfwriter",["require","../enum/glyFlag","../enum/componentFlag"],function(require){function e(e,t){if(!e.contours||0===e.contours.length)return 0;var i=12+2*e.contours.length+t.flags.length;return t.xCoord.forEach(function(e){i+=e>=0&&255>=e?1:2}),t.yCoord.forEach(function(e){i+=e>=0&&255>=e?1:2}),i}function t(e){var t,i=10;return e.glyfs.forEach(function(e){if(t=e.transform,i+=4,t.e<0||t.e>127||t.f<0||t.f>127)i+=4;else i+=2;if(t.b||t.c)i+=8;else if(1!==t.a||1!==t.d)i+=t.a===t.d?2:4}),i}function i(e,t){if(!e.contours||0===e.contours.length)return t;for(var i,r,o=[],a=[],s=[],u=e.contours,f=!0,h=0,c=u.length;c>h;h++){i=u[h];for(var d=0,l=i.length;l>d;d++){var p=i[d];if(f)a.push(p.x),s.push(p.y),f=!1;else a.push(p.x-r.x),s.push(p.y-r.y);o.push(p.onCurve?n.ONCURVE:0),r=p}}var g,m,y,v=[],x=[],w=[],b=-1;return o.forEach(function(e,t){if(g=a[t],m=s[t],0===t){if(g>=-255&&255>=g){if(e+=n.XSHORT,g>=0)e+=n.XSAME;g=Math.abs(g)}if(m>=-255&&255>=m){if(e+=n.YSHORT,m>=0)e+=n.YSAME;m=Math.abs(m)}v.push(y=e),x.push(g),w.push(m)}else{if(0===g)e+=n.XSAME;else{if(g>=-255&&255>=g){if(e+=n.XSHORT,g>0)e+=n.XSAME;g=Math.abs(g)}x.push(g)}if(0===m)e+=n.YSAME;else{if(m>=-255&&255>=m){if(e+=n.YSHORT,m>0)e+=n.YSAME;m=Math.abs(m)}w.push(m)}if(e===y)if(-1===b)b=v.length-1,v[b]|=n.REPEAT,v.push(1);else++v[b+1];else b=-1,v.push(y=e)}}),t.flags=v,t.xCoord=x,t.yCoord=w,t}var n=require("../enum/glyFlag"),r=require("../enum/componentFlag");return{write:function(e,t){return t.glyf.forEach(function(i,n){if(i.compound||i.contours&&0!==i.contours.length){e.writeInt16(i.compound?-1:i.contours.length),e.writeInt16(i.xMin),e.writeInt16(i.yMin),e.writeInt16(i.xMax),e.writeInt16(i.yMax);var o,a,s;if(i.compound)for(o=0,a=i.glyfs.length;a>o;o++){if(s=r.ARGS_ARE_XY_VALUES+r.ROUND_XY_TO_GRID,a-1>o)s+=r.MORE_COMPONENTS;var u=i.glyfs[o];s+=u.useMyMetrics?r.USE_MY_METRICS:0,s+=u.overlapCompound?r.OVERLAP_COMPOUND:0;var f=u.transform,h=f.a,c=f.b,d=f.c,l=f.d,p=f.e,g=f.f;if(0>p||p>127||0>g||g>127)s+=r.ARG_1_AND_2_ARE_WORDS;if(c||d)s+=r.WE_HAVE_A_TWO_BY_TWO;else if(1!==h||1!==l&&h===l)s+=r.WE_HAVE_A_SCALE;else if(1!==h||1!==l)s+=r.WE_HAVE_AN_X_AND_Y_SCALE;if(e.writeUint16(s),e.writeUint16(u.glyphIndex),r.ARG_1_AND_2_ARE_WORDS&s)e.writeInt16(p),e.writeInt16(g);else e.writeUint8(p),e.writeUint8(g);if(r.WE_HAVE_A_SCALE&s)e.writeInt16(Math.round(16384*h));else if(r.WE_HAVE_AN_X_AND_Y_SCALE&s)e.writeInt16(Math.round(16384*h)),e.writeInt16(Math.round(16384*l));else if(r.WE_HAVE_A_TWO_BY_TWO&s)e.writeInt16(Math.round(16384*h)),e.writeInt16(Math.round(16384*c)),e.writeInt16(Math.round(16384*d)),e.writeInt16(Math.round(16384*l))}else{var m=-1;for(i.contours.forEach(function(t){m+=t.length,e.writeUint16(m)}),e.writeUint16(0),s=t.support.glyf[n].flags,o=0,a=s.length;a>o;o++)e.writeUint8(s[o]);var y=t.support.glyf[n].xCoord;for(o=0,a=y.length;a>o;o++)if(0<=y[o]&&y[o]<=255)e.writeUint8(y[o]);else e.writeInt16(y[o]);var v=t.support.glyf[n].yCoord;for(o=0,a=v.length;a>o;o++)if(0<=v[o]&&v[o]<=255)e.writeUint8(v[o]);else e.writeInt16(v[o])}var x=t.support.glyf[n].glyfSize;if(x%4)e.writeEmpty(4-x%4)}}),e},size:function(n){n.support.glyf=[];var r=0;return n.glyf.forEach(function(o){var a={};a=o.compound?a:i(o,a);var s=o.compound?t(o):e(o,a),u=s;if(u%4)u+=4-u%4;a.glyfSize=s,a.size=u,n.support.glyf.push(a),r+=u}),n.support.glyf.tableSize=r,n.head.indexToLocFormat=r>65536?1:0,n.support.glyf.tableSize}}}),define("ttf/table/glyf",["require","./table","./glyfcontour","./glyfwriter"],function(require){var e=require("./table"),t=require("./glyfcontour"),i=require("./glyfwriter"),n=e.create("glyf",[],{read:function(e,i){var n=this.offset,r=i.loca,o=i.maxp.numGlyphs,a=[],s=new t;e.seek(n);for(var u=0,f=o;f>u;u++){var h=n+r[u];if(f>u+1&&r[u]===r[u+1])a[u]=t.empty();else s.offset=h,a[u]=s.read(e,i)}return a},write:i.write,size:i.size});return n}),define("ttf/util/readWindowsAllCodes",["require"],function(){function e(e){var t,i,n,r,o={},a=e.filter(function(e){return 0===e.format});if(a.length)for(a=a[0],t=0,i=a.glyphIdArray.length;i>t;t++)if(a.glyphIdArray[t])o[t]=a.glyphIdArray[t];var s=e.filter(function(e){return 3===e.platformID&&10===e.encodingID&&12===e.format});if(s.length)for(s=s[0],t=0,i=s.nGroups;i>t;t++){var u=s.groups[t],f=u.startId;for(n=u.start,r=u.end;r>=n;)o[n++]=f++}else{var h=e.filter(function(e){return 3===e.platformID&&1===e.encodingID&&4===e.format});if(h.length){h=h[0];var c=h.segCountX2/2,d=(h.glyphIdArrayOffset-h.idRangeOffsetOffset)/2;for(t=0;c>t;++t)for(n=h.startCode[t],r=h.endCode[t];r>=n;++n)if(0===h.idRangeOffset[t])o[n]=(n+h.idDelta[t])%65536;else{var l=t+h.idRangeOffset[t]/2+(n-h.startCode[t])-d,p=h.glyphIdArray[l];if(0!==p)o[n]=(p+h.idDelta[t])%65536;else o[n]=0}}}return o}return e}),define("ttf/table/cmapwriter",["require"],function(){function e(e){return e>32767?e-65536:-32767>e?e+65536:e}function t(t,i){var n=null,r=[],o={};if(t.forEach(function(t){if(void 0===i||t.unicode<=i){if(null===n||t.unicode!==n.unicode+1||t.id!==n.id+1)if(null!==n)o.end=n.unicode,r.push(o),o={start:t.unicode,startId:t.id,delta:e(t.id-t.unicode)};else o.start=t.unicode,o.startId=t.id,o.delta=e(t.id-t.unicode);n=t}}),null!==n)o.end=n.unicode,r.push(o);return r}function i(e){var t=[];return e.forEach(function(e){if(void 0!==e.unicode&&e.unicode<256)t.push([e.unicode,e.id])}),t.sort(function(e,t){return e[0]-t[0]}),t}function n(e,t){e.writeUint16(0),e.writeUint16(262),e.writeUint16(0);for(var i,n=-1;i=t.shift();){for(;++n<i[0];)e.writeUint8(0);e.writeUint8(i[1]),n=i[0]}for(;++n<256;)e.writeUint8(0);return e}function r(e,t){e.writeUint16(4),e.writeUint16(24+8*t.length),e.writeUint16(0);var i=t.length+1,n=Math.floor(Math.log(i)/Math.LN2),r=2*Math.pow(2,n);e.writeUint16(2*i),e.writeUint16(r),e.writeUint16(n),e.writeUint16(2*i-r),t.forEach(function(t){e.writeUint16(t.end)}),e.writeUint16(65535),e.writeUint16(0),t.forEach(function(t){e.writeUint16(t.start)}),e.writeUint16(65535),t.forEach(function(t){e.writeUint16(t.delta)}),e.writeUint16(1);for(var o=0,a=t.length;a>o;o++)e.writeUint16(0);return e.writeUint16(0),e}function o(e,t){return e.writeUint16(12),e.writeUint16(0),e.writeUint32(16+12*t.length),e.writeUint32(0),e.writeUint32(t.length),t.forEach(function(t){e.writeUint32(t.start),e.writeUint32(t.end),e.writeUint32(t.startId)}),e}function a(e,t,i,n){return e.writeUint16(t),e.writeUint16(i),e.writeUint32(n),e}var s={write:function(e,t){var i=t.support.cmap.hasGLyphsOver2Bytes;e.writeUint16(0),e.writeUint16(i?4:3);var s=4+(i?32:24),u=t.support.cmap.format4Size,f=t.support.cmap.format0Size;if(a(e,0,3,s),a(e,1,0,s+u),a(e,3,1,s),i)a(e,3,10,s+u+f);if(r(e,t.support.cmap.format4Segments),n(e,t.support.cmap.format0Segments),i)o(e,t.support.cmap.format12Segments);return e},size:function(e){e.support.cmap={};var n=[];e.glyf.forEach(function(e,t){var i=e.unicode;if("number"==typeof e.unicode)i=[e.unicode];if(i&&i.length)i.forEach(function(e){n.push({unicode:e,id:65535!==e?t:0})})}),n=n.sort(function(e,t){return e.unicode-t.unicode}),e.support.cmap.unicodes=n;var r=n;e.support.cmap.format4Segments=t(r,65535),e.support.cmap.format4Size=24+8*e.support.cmap.format4Segments.length,e.support.cmap.format0Segments=i(n),e.support.cmap.format0Size=262;var o=r.some(function(e){return e.unicode>65535});if(o){e.support.cmap.hasGLyphsOver2Bytes=o;var a=n;e.support.cmap.format12Segments=t(a),e.support.cmap.format12Size=16+12*e.support.cmap.format12Segments.length}var s=4+(o?32:24)+e.support.cmap.format0Size+e.support.cmap.format4Size+(o?e.support.cmap.format12Size:0);return s}};return s}),define("ttf/table/cmap",["require","./table","../util/readWindowsAllCodes","./cmapwriter"],function(require){function e(e,t,i,n){var r,o,a,s=n+i.offset;if(i.format=e.readUint16(s),0===i.format){var u=i;for(u.length=e.readUint16(),u.language=e.readUint16(),a=[],r=0,o=u.length-6;o>r;r++)a.push(e.readUint8());u.glyphIdArray=a}else if(4===i.format){var f=i;f.length=e.readUint16(),f.language=e.readUint16(),f.segCountX2=e.readUint16(),f.searchRange=e.readUint16(),f.entrySelector=e.readUint16(),f.rangeShift=e.readUint16();var h=f.segCountX2/2,c=[];for(r=0;h>r;++r)c.push(e.readUint16());f.endCode=c,f.reservedPad=e.readUint16();var d=[];for(r=0;h>r;++r)d.push(e.readUint16());f.startCode=d;var l=[];for(r=0;h>r;++r)l.push(e.readUint16());f.idDelta=l,f.idRangeOffsetOffset=e.offset;var p=[];for(r=0;h>r;++r)p.push(e.readUint16());f.idRangeOffset=p;var g=(f.length-(e.offset-s))/2;for(f.glyphIdArrayOffset=e.offset,a=[],r=0;g>r;++r)a.push(e.readUint16());f.glyphIdArray=a}else if(6===i.format){var m=i;m.length=e.readUint16(),m.language=e.readUint16(),m.firstCode=e.readUint16(),m.entryCount=e.readUint16(),m.glyphIdArrayOffset=e.offset;var y=[],v=m.entryCount;for(r=0;v>r;++r)y.push(e.readUint16());m.glyphIdArray=y}else if(12===i.format){var x=i;x.reserved=e.readUint16(),x.length=e.readUint32(),x.language=e.readUint32(),x.nGroups=e.readUint32();var w=[],b=x.nGroups;for(r=0;b>r;++r){var S={};S.start=e.readUint32(),S.end=e.readUint32(),S.startId=e.readUint32(),w.push(S)}x.groups=w}else throw"not support cmap format:"+i.format}var t=require("./table"),i=require("../util/readWindowsAllCodes"),n=require("./cmapwriter"),r=t.create("cmap",[],{read:function(t,n){var r={},o=this.offset;t.seek(o),r.version=t.readUint16();for(var a=r.numberSubtables=t.readUint16(),s=r.tables=[],u=t.offset,f=0,h=a;h>f;f++){var c={};c.platformID=t.readUint16(u),c.encodingID=t.readUint16(u+2),c.offset=t.readUint32(u+4),e(t,n,c,o),s.push(c),u+=8}var d=i(s);return d},write:n.write,size:n.size});return r}),define("ttf/enum/nameId",["require"],function(){var e={0:"copyright",1:"fontFamily",2:"fontSubFamily",3:"uniqueSubFamily",4:"fullName",5:"version",6:"postScriptName",7:"tradeMark",8:"manufacturer",9:"designer",10:"description",11:"urlOfFontVendor",12:"urlOfFontDesigner",13:"licence",14:"urlOfLicence",16:"preferredFamily",17:"preferredSubFamily",18:"compatibleFull",19:"sampleText"},t={};return Object.keys(e).forEach(function(i){t[e[i]]=+i}),e.names=t,e}),define("ttf/enum/platform",["require"],function(){var e={Unicode:0,Macintosh:1,reserved:2,Microsoft:3};return e}),define("ttf/enum/encoding",["require"],function(){var e={Default:0,"Version1.1":1,ISO10646:2,UnicodeBMP:3,UnicodenonBMP:4,UnicodeVariationSequences:5,FullUnicodecoverage:6},t={Symbol:0,UCS2:1,ShiftJIS:2,PRC:3,BigFive:4,Johab:5,UCS4:6};return{mac:e,win:t}}),define("ttf/table/name",["require","./table","../enum/nameId","../util/string","../enum/platform","../enum/encoding"],function(require){var e=require("./table"),t=require("../enum/nameId"),i=require("../util/string"),n=require("../enum/platform"),r=require("../enum/encoding"),o=e.create("name",[],{read:function(e){var o=this.offset;e.seek(o);var a={};a.format=e.readUint16(),a.count=e.readUint16(),a.stringOffset=e.readUint16();var s,u,f=[],h=a.count;for(s=0;h>s;++s)u={},u.platform=e.readUint16(),u.encoding=e.readUint16(),u.language=e.readUint16(),u.nameId=e.readUint16(),u.length=e.readUint16(),u.offset=e.readUint16(),f.push(u);for(o+=a.stringOffset,s=0;h>s;++s)u=f[s],u.name=e.readString(o+u.offset,u.length);var c={},d=n.Microsoft,l=r.win.UCS2;for(s=0;h>s;++s)if(u=f[s],u.platform===d&&u.encoding===l&&t[u.nameId])c[t[u.nameId]]=i.stringify(u.name);return c},write:function(e,t){var i=t.support.name;e.writeUint16(0),e.writeUint16(i.length),e.writeUint16(6+12*i.length);var n=0;return i.forEach(function(t){e.writeUint16(t.platform),e.writeUint16(t.encoding),e.writeUint16(t.language),e.writeUint16(t.nameId),e.writeUint16(t.name.length),e.writeUint16(n),n+=t.name.length}),i.forEach(function(t){e.writeBytes(t.name)}),e},size:function(e){var n=e.name,r=[],o=6;Object.keys(n).forEach(function(e){var a=t.names[e],s=i.toUTF8Bytes(n[e]),u=i.toUCS2Bytes(n[e]);if(void 0!==a)r.push({nameId:a,platform:1,encoding:0,language:0,name:s}),r.push({nameId:a,platform:3,encoding:1,language:1033,name:u}),o+=24+s.length+u.length});var a=["platform","encoding","language","nameId"];return r=r.sort(function(e,t){var i=0;return a.some(function(n){var r=e[n]-t[n];if(r)return i=r,!0;else return void 0}),i}),e.support.name=r,o}});return o}),define("ttf/table/hhea",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct"),i=e.create("hhea",[["version",t.Fixed],["ascent",t.Int16],["descent",t.Int16],["lineGap",t.Int16],["advanceWidthMax",t.Uint16],["minLeftSideBearing",t.Int16],["minRightSideBearing",t.Int16],["xMaxExtent",t.Int16],["caretSlopeRise",t.Int16],["caretSlopeRun",t.Int16],["caretOffset",t.Int16],["reserved0",t.Int16],["reserved1",t.Int16],["reserved2",t.Int16],["reserved3",t.Int16],["metricDataFormat",t.Int16],["numOfLongHorMetrics",t.Uint16]]);return i}),define("ttf/table/hmtx",["require","./table"],function(require){var e=require("./table"),t=e.create("hmtx",[],{read:function(e,t){var i=this.offset;e.seek(i);var n,r,o=t.hhea.numOfLongHorMetrics,a=[];for(n=0;o>n;++n)r={},r.advanceWidth=e.readUint16(),r.leftSideBearing=e.readInt16(),a.push(r);var s=a[o-1].advanceWidth,u=t.maxp.numGlyphs-o;for(n=0;u>n;++n)r={},r.advanceWidth=s,r.leftSideBearing=e.readInt16(),a.push(r);return a},write:function(e,t){var i,n=t.hhea.numOfLongHorMetrics;for(i=0;n>i;++i)e.writeUint16(t.glyf[i].advanceWidth),e.writeInt16(t.glyf[i].leftSideBearing);var r=t.glyf.length-n;for(i=0;r>i;++i)e.writeInt16(t.glyf[n+i].leftSideBearing);return e},size:function(e){for(var t=0,i=e.glyf[e.glyf.length-1].advanceWidth,n=e.glyf.length-2;n>=0&&i===e.glyf[n].advanceWidth;n--)t++;return e.hhea.numOfLongHorMetrics=e.glyf.length-t,4*e.hhea.numOfLongHorMetrics+2*t}});return t}),define("ttf/table/post",["require","./table","./struct","../util/string","../enum/unicodeName"],function(require){var e=require("./table"),t=require("./struct"),i=require("../util/string"),n=require("../enum/unicodeName"),r=e.create("posthead",[["format",t.Fixed],["italicAngle",t.Fixed],["underlinePosition",t.Int16],["underlineThickness",t.Int16],["isFixedPitch",t.Uint32],["minMemType42",t.Uint32],["maxMemType42",t.Uint32],["minMemType1",t.Uint32],["maxMemType1",t.Uint32],["numberOfGlyphs",t.Uint16]]),o=e.create("post",[],{read:function(e,t){var n=null,o=e.readFixed(this.offset);if(2===o){n=new r(this.offset).read(e,t),n.format=o;for(var a=t.maxp.numGlyphs,s=[],u=0;a>u;++u)s.push(e.readUint16());var f=e.offset,h=t.tables.post.length-(f-this.offset),c=e.readBytes(e.offset,h);n.glyphNameIndex=s,n.names=i.readPascalString(c)}else n={format:o};return n},write:function(e,t){var i=t.glyf.length,n=t.post||{};e.writeFixed(2),e.writeFixed(n.italicAngle||0),e.writeInt16(n.underlinePosition||0),e.writeInt16(n.underlineThickness||0),e.writeUint32(n.isFixedPitch||0),e.writeUint32(n.minMemType42||0),e.writeUint32(n.maxMemType42||0),e.writeUint32(n.minMemType1||0),e.writeUint32(n.maxMemType1||0),e.writeUint16(i);for(var r=t.support.post.nameIndexs,o=0,a=r.length;a>o;o++)e.writeUint16(r[o]);t.support.post.glyphNames.forEach(function(t){e.writeBytes(t)})},size:function(e){for(var t=e.glyf.length,r=[],o=[],a=34+2*t,s=0,u=0;t>u;u++)if(0===u)o.push(0);else{var f=e.glyf[u],h=f.unicode?f.unicode[0]:0,c=n[h];if(void 0!==c)o.push(c);else{var d=f.name;if(!d||d.charCodeAt(0)<32)d=i.getUnicodeName(h);o.push(258+s++);var l=i.getPascalStringBytes(d);r.push(l),a+=l.length}}return e.post=e.post||{},e.post.format=e.post.format||2,e.post.maxMemType1=t,e.support.post={nameIndexs:o,glyphNames:r},a}});return o}),define("ttf/table/OS2",["require","./table","./struct","common/lang"],function(require){var e=require("./table"),t=require("./struct"),i=require("common/lang"),n=e.create("OS/2",[["version",t.Uint16],["xAvgCharWidth",t.Int16],["usWeightClass",t.Uint16],["usWidthClass",t.Uint16],["fsType",t.Uint16],["ySubscriptXSize",t.Uint16],["ySubscriptYSize",t.Uint16],["ySubscriptXOffset",t.Uint16],["ySubscriptYOffset",t.Uint16],["ySuperscriptXSize",t.Uint16],["ySuperscriptYSize",t.Uint16],["ySuperscriptXOffset",t.Uint16],["ySuperscriptYOffset",t.Uint16],["yStrikeoutSize",t.Uint16],["yStrikeoutPosition",t.Uint16],["sFamilyClass",t.Uint16],["bFamilyType",t.Uint8],["bSerifStyle",t.Uint8],["bWeight",t.Uint8],["bProportion",t.Uint8],["bContrast",t.Uint8],["bStrokeVariation",t.Uint8],["bArmStyle",t.Uint8],["bLetterform",t.Uint8],["bMidline",t.Uint8],["bXHeight",t.Uint8],["ulUnicodeRange1",t.Uint32],["ulUnicodeRange2",t.Uint32],["ulUnicodeRange3",t.Uint32],["ulUnicodeRange4",t.Uint32],["achVendID",t.String,4],["fsSelection",t.Uint16],["usFirstCharIndex",t.Uint16],["usLastCharIndex",t.Uint16],["sTypoAscender",t.Int16],["sTypoDescender",t.Int16],["sTypoLineGap",t.Int16],["usWinAscent",t.Uint16],["usWinDescent",t.Uint16],["ulCodePageRange1",t.Uint32],["ulCodePageRange2",t.Uint32],["sxHeight",t.Int16],["sCapHeight",t.Int16],["usDefaultChar",t.Uint16],["usBreakChar",t.Uint16],["usMaxContext",t.Uint16]],{read:function(t,n){var r=t.readUint16(this.offset),o=this.struct;if(0===r)o=o.slice(0,39);else if(1===r)o=o.slice(0,41);var a=e.create("os2head",o),s=new a(this.offset).read(t,n),u={ulCodePageRange1:1,ulCodePageRange2:0,sxHeight:0,sCapHeight:0,usDefaultChar:0,usBreakChar:32,usMaxContext:0};return i.extend(u,s)},size:function(t){var n=16384,r=16384,o=-16384,a=-16384,s=-1,u=16384,f=16384,h=-16384,c=0,d=65535,l=-1,p=0,g=0,m=0,y=0,v=0,x=0,w=0;return t.glyf.forEach(function(e){if(e.compound){var v=0,b=0;e.glyfs.forEach(function(e){var i=t.glyf[e.glyphIndex];if(v+=i.contours?i.contours.length:0,i.contours&&i.contours.length)i.contours.forEach(function(e){b+=e.length})}),x++,m=Math.max(m,b),y=Math.max(y,v)}else if(e.contours&&e.contours.length){g=Math.max(g,e.contours.length);var S=0;e.contours.forEach(function(e){S+=e.length}),p=Math.max(p,S)}if(e.compound||e.contours&&e.contours.length){if(e.xMin<n)n=e.xMin;if(e.yMin<r)r=e.yMin;if(e.xMax>o)o=e.xMax;if(e.yMax>a)a=e.yMax;s=Math.max(s,e.advanceWidth),u=Math.min(u,e.leftSideBearing),f=Math.min(f,e.advanceWidth-e.xMax),h=Math.max(h,e.xMax),c+=e.advanceWidth,w++}var M=e.unicode;if("number"==typeof e.unicode)M=[e.unicode];if(i.isArray(M))M.forEach(function(e){if(65535!==e)d=Math.min(d,e),l=Math.max(l,e)})}),t["OS/2"].version=4,t["OS/2"].achVendID=(t["OS/2"].achVendID+"    ").slice(0,4),t["OS/2"].xAvgCharWidth=c/(w||1),t["OS/2"].ulUnicodeRange2=268435456,t["OS/2"].usFirstCharIndex=d,t["OS/2"].usLastCharIndex=l,t.hhea.version=t.hhea.version||1,t.hhea.advanceWidthMax=s,t.hhea.minLeftSideBearing=u,t.hhea.minRightSideBearing=f,t.hhea.xMaxExtent=h,t.head.version=t.head.version||1,t.head.lowestRecPPEM=t.head.lowestRecPPEM||8,t.head.xMin=n,t.head.yMin=r,t.head.xMax=o,t.head.yMax=a,t.support.maxp={version:1,numGlyphs:t.glyf.length,maxPoints:p,maxContours:g,maxCompositePoints:m,maxCompositeContours:y,maxZones:2,maxTwilightPoints:0,maxStorage:0,maxFunctionDefs:0,maxStackElements:0,maxSizeOfInstructions:v,maxComponentElements:x,maxComponentDepth:x?1:0},e.size.call(this,t)}});return n}),define("ttf/table/support",["require","./head","./maxp","./loca","./glyf","./cmap","./name","./hhea","./hmtx","./post","./OS2"],function(require){var e={head:require("./head"),maxp:require("./maxp"),loca:require("./loca"),glyf:require("./glyf"),cmap:require("./cmap"),name:require("./name"),hhea:require("./hhea"),hmtx:require("./hmtx"),post:require("./post"),"OS/2":require("./OS2")};return e}),define("ttf/reader",["require","common/lang","./error"],function(require){function e(e,t,i){if(void 0===t)t=this.offset;if(void 0===i)i=this.littleEndian;if(void 0===o[e])return this["read"+e](t,i);var n=o[e];return this.offset=t+n,this.view["get"+e](t,i)}function t(e,t,i,n){var r=e.byteLength||e.length;this.offset=t||0,this.length=i||r-this.offset,this.littleEndian=n||!1,this.view=new DataView(e,this.offset,this.length)}var i=require("common/lang").extend,n=require("common/lang").curry,r=require("./error");if("undefined"==typeof ArrayBuffer||"undefined"==typeof DataView)throw"not support ArrayBuffer and DataView";var o={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8},a={};return Object.keys(o).forEach(function(t){a["read"+t]=n(e,t)}),t.prototype={constructor:t,read:e,readBytes:function(e,t){if(1===arguments.length)t=arguments[0],e=this.offset;if(0>t||e+t>this.length)r.raise(10001,this.length,e+t);for(var i=[],n=0;t>n;++n)i.push(this.view.getUint8(e+n));return this.offset=e+t,i},readString:function(e,t){if(1===arguments.length)t=arguments[0],e=this.offset;if(0>t||e+t>this.length)r.raise(10001,this.length,e+t);for(var i="",n=0;t>n;++n){var o=this.readUint8(e+n);i+=String.fromCharCode(o)}return this.offset=e+t,i},readChar:function(e){return this.readString(e,1)},readFixed:function(e){if(void 0===e)e=this.offset;var t=this.readInt32(e,!1)/65536;return Math.ceil(1e5*t)/1e5},readLongDateTime:function(e){if(void 0===e)e=this.offset;var t=-20775456e5,i=this.readUint32(e+4,!1),n=new Date;return n.setTime(1e3*i+t),n},seek:function(e){if(void 0===e)this.offset=0;if(0>e||e>this.length)r.raise(10001,this.length,e);return this.offset=e,this},dispose:function(){delete this.view}},i(t.prototype,a),t}),define("ttf/ttfreader",["require","./table/directory","./table/support","./reader","./enum/postName","./error"],function(require){function e(e){var t=new a(e,0,e.byteLength,!1),i={};if(i.version=t.readFixed(0),1!==i.version)u.raise(10101);if(i.numTables=t.readUint16(),i.numTables<=0||i.numTables>100)u.raise(10101);if(i.searchRenge=t.readUint16(),i.entrySelector=t.readUint16(),i.rengeShift=t.readUint16(),i.tables=new r(t.offset).read(t,i),!(i.tables.glyf&&i.tables.head&&i.tables.cmap&&i.tables.hmtx))u.raise(10204);if(Object.keys(o).forEach(function(e){if(i.tables[e]){var n=i.tables[e].offset;i[e]=new o[e](n).read(t,i)}}),!i.glyf)u.raise(10201);return t.dispose(),i}function t(e){var t=e.cmap,i=e.glyf;if(Object.keys(t).forEach(function(e){var n=t[e];if(!i[n].unicode)i[n].unicode=[];i[n].unicode.push(+e)}),e.hmtx.forEach(function(e,t){i[t].advanceWidth=e.advanceWidth,i[t].leftSideBearing=e.leftSideBearing}),e.post&&2===e.post.format){var n=e.post.glyphNameIndex,r=e.post.names;n.forEach(function(e,t){if(257>=e)i[t].name=s[e];else i[t].name=r[e-258]||""})}}function i(e){delete e.tables,delete e.DSIG,delete e.GDEF,delete e.GPOS,delete e.GSUB,delete e.gasp,delete e.hmtx,delete e.loca,delete e.post.glyphNameIndex,delete e.post.names,delete e.maxp}function n(){}var r=require("./table/directory"),o=require("./table/support"),a=require("./reader"),s=require("./enum/postName"),u=require("./error");return n.prototype.read=function(n){return this.ttf=e.call(this,n),t.call(this,this.ttf),i.call(this,this.ttf),this.ttf},n.prototype.dispose=function(){delete this.ttf},n}),define("ttf/writer",["require","common/lang","./error"],function(require){function e(e,t,i,n){if(void 0===i)i=this.offset;if(void 0===n)n=this.littleEndian;if(void 0===o[e])return this["write"+e](t,i,n);var r=o[e];return this.offset=i+r,this.view["set"+e](i,t,n),this}function t(e,t,i,n){var r=e.byteLength||e.length;this.offset=t||0,this.length=i||r-this.offset,this.littleEndian=n||!1,this.view=new DataView(e,this.offset,this.length)}var i=require("common/lang").extend,n=require("common/lang").curry,r=require("./error");
if("undefined"==typeof ArrayBuffer||"undefined"==typeof DataView)throw"not support ArrayBuffer and DataView";var o={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8},a={};return Object.keys(o).forEach(function(t){a["write"+t]=n(e,t)}),t.prototype={constructor:t,write:e,writeBytes:function(e,t,i){t=t||e.byteLength||e.length;var n;if(!t)return this;if(void 0===i)i=this.offset;if(0>t||i+t>this.length)r.raise(10002,this.length,i+t);if(e instanceof ArrayBuffer){var o=new DataView(e,0,t),a=this.littleEndian;for(n=0;t>n;++n)this.view.setUint8(i+n,o.getUint8(n,a),a)}else for(n=0;t>n;++n)this.view.setUint8(i+n,e[n],a);return this.offset=i+t,this},writeEmpty:function(e,t){if(0>e)r.raise(10002,this.length,e);if(void 0===t)t=this.offset;for(var i=this.littleEndian,n=0;e>n;++n)this.view.setUint8(t+n,0,i);return this.offset=t+e,this},writeString:function(e,t,i){if(e=e||"",void 0===i)i=this.offset;if(t=t||e.replace(/[^\x00-\xff]/g,"11").length,0>t||i+t>this.length)r.raise(10002,this.length,i+t);this.seek(i);for(var n,o=0,a=e.length;a>o;++o)if(n=e.charCodeAt(o)||0,n>127)this.writeUint16(n);else this.writeUint8(n);return this.offset=i+t,this},writeChar:function(e,t){return this.writeString(e,t)},writeFixed:function(e,t){if(void 0===t)t=this.offset;return this.writeInt32(Math.round(65536*e),t),this},writeLongDateTime:function(e,t){if(void 0===t)t=this.offset;var i=-20775456e5;if("undefined"==typeof e)e=i;else if("function"==typeof e.getTime)e=e.getTime();else if(/^\d+$/.test(e))e=+e;else e=Date.parse(e);var n=Math.round((e-i)/1e3);return this.writeUint32(0,t),this.writeUint32(n,t+4),this},seek:function(e){if(void 0===e)this.offset=0;if(0>e||e>this.length)r.raise(10002,this.length,e);return this._offset=this.offset,this.offset=e,this},head:function(){return this.offset=this._offset||0,this},getBuffer:function(){return this.view.buffer},dispose:function(){delete this.view}},i(t.prototype,a),t}),define("ttf/woff2ttf",["require","./reader","./writer","./error"],function(require){function e(e,r){r=r||{};var o=new t(e),a=o.readUint32(0),s=o.readUint32(4);if(2001684038!==a||65536!==s)o.dispose(),n.raise(10102);var u,f,h,c=o.readUint16(12),d=o.readUint32(16),l=[];for(f=0;c>f;++f){o.seek(44+20*f),u={tag:o.readString(o.offset,4),offset:o.readUint32(),compLength:o.readUint32(),length:o.readUint32(),checkSum:o.readUint32()};var p=o.readBytes(u.offset,u.compLength);if(p.length<u.length){if(!r.inflate)o.dispose(),n.raise(10105);u.data=r.inflate(p)}else u.data=p;u.length=u.data.length,l.push(u)}var g=new i(new ArrayBuffer(d)),m=Math.floor(Math.log(c)/Math.LN2),y=16*Math.pow(2,m),v=16*c-y;g.writeFixed(1),g.writeUint16(c),g.writeUint16(y),g.writeUint16(m),g.writeUint16(v);var x=12+16*l.length;for(f=0,h=l.length;h>f;++f)u=l[f],g.writeString(u.tag),g.writeUint32(u.checkSum),g.writeUint32(x),g.writeUint32(u.length),x+=u.length+(u.length%4?4-u.length%4:0);for(f=0,h=l.length;h>f;++f)if(u=l[f],g.writeBytes(u.data),u.length%4)g.writeEmpty(4-u.length%4);return g.getBuffer()}var t=require("./reader"),i=require("./writer"),n=require("./error");return e}),define("ttf/eot2ttf",["require","./reader","./error","./writer"],function(require){function e(e,n){n=n||{};var r=new t(e,0,e.byteLength,!0),o=r.readUint16(34);if(20556!==o)i.raise(10110);var a=r.readUint32(8);if(131073!==a&&65536!==a&&131074!==a)i.raise(10110);var s=e.byteLength||e.length,u=r.readUint32(4),f=82,h=r.readUint16(f);f+=4+h;var c=r.readUint16(f);f+=4+c;var d=r.readUint16(f);f+=4+d;var l=r.readUint16(f);if(f+=2+l,131073===a||131074===a){var p=r.readUint16(f+2);f+=4+p}if(131074===a){f+=10;var g=r.readUint16(f);f+=2+g,f+=4;var m=r.readUint32(f);f+=4+m}if(f+u>s)i.raise(10001);if(e.slice)return e.slice(f,f+u);var y=require("./writer"),v=r.readBytes(f,u);return new y(new ArrayBuffer(u)).writeBytes(v).getBuffer()}var t=require("./reader"),i=require("./error");return e}),define("math/bezierCubic2Q2",["require"],function(){function e(e,t,i,n){var r=(3*i.x-n.x+3*t.x-e.x)/4,o=(3*i.y-n.y+3*t.y-e.y)/4;return[e,{x:r,y:o},n]}function t(t,i,n,r){var o=r.x-3*n.x+3*i.x-t.x,a=r.y-3*n.y+3*i.y-t.y;if(4>=o*o+a*a)return[e(t,i,n,r)];var s={x:(r.x+3*n.x+3*i.x+t.x)/8,y:(r.y+3*n.y+3*i.y+t.y)/8};return[e(t,{x:(t.x+i.x)/2,y:(t.y+i.y)/2},{x:(t.x+2*i.x+n.x)/4,y:(t.y+2*i.y+n.y)/4},s),e(s,{x:(r.x+i.x+2*n.x)/4,y:(r.y+i.y+2*n.y)/4},{x:(r.x+n.x)/2,y:(r.y+n.y)/2},r)]}return t}),define("graphics/getArc",["require","./computeBoundingBox","./join/pathSplit","./pathAdjust","./pathRotate","./pathUtil","./join/getSegmentPathJoint","common/lang"],function(require){function e(e,t,n,a){var s=h.clone(c),u=i.computePath(s),f=e/u.width;if(r(s,1,1,-(u.x+u.width/2),-(u.y+u.height/2)),r(s,f,f*t/e),0!==n)o(s,n);return r(s,1,1,a.x,a.y),s}function t(t,i,o,a,h,c,d){if(0===t||0===i)return[c,d];var l=o%360*Math.PI/180,p=Math.sin(l),g=Math.cos(l);if(0>t)t=-t;if(0>i)i=-i;var m=c.x,y=c.y,v=d.x,x=d.y,w=(m-v)/2,b=(y-x)/2,S=g*w+p*b,M=-p*w+g*b,C=Math.sqrt(Math.pow(S/t,2)+Math.pow(M/i,2));if(C>1)t=C*t,i=C*i;if(w=t*t*M*M+i*i*S*S,0===w)return[];if(w=Math.sqrt(Math.abs(t*t*i*i/w-1)),h===a)w=-w;var E=w*t*M/i,L=-w*i*S/t,k=g*E-p*L+(m+v)/2,B=p*E+g*L+(y+x)/2,U={x:m,y:y},P={x:v,y:x};r([U,P],1.1,1.1,-(m+v)/2,-(y+x)/2),r([U,P],1,1,(m+v)/2,(y+x)/2);var q=s(e(2*t,2*i,l>=0?l:l+Math.PI,{x:k,y:B})),A=f(q,U,P);if(A&&A.length>1){var I=n(q,A.map(function(e){return e.index=e.index1,e})),T=y>x?1:x>y?-1:m>v?1:-1;if(Math.abs(k-(m+v)/2)<.01&&Math.abs(B-(y+x)/2)<.01)if(h&&1===T||0===h&&-1===T)q=I[0];else q=I[1];else if(a&&I[1].length>I[0].length)q=I[1];else if(1===T)q=I[0];else q=I[1];q=u(q);var z=q[q.length-1];if(Math.abs(c.x-z.x)<1&&Math.abs(c.y-z.y)<1)q=q.reverse();return q}return[c,d]}var i=require("./computeBoundingBox"),n=require("./join/pathSplit"),r=require("./pathAdjust"),o=require("./pathRotate"),a=require("./pathUtil"),s=a.interpolate,u=a.deInterpolate,f=require("./join/getSegmentPathJoint"),h=require("common/lang"),c=[{x:582,y:0},{x:758,y:75},{x:890,y:208},{x:965,y:384},{x:965,y:583},{x:890,y:760},{x:758,y:891},{x:582,y:966},{x:383,y:966},{x:207,y:891},{x:75,y:760},{x:0,y:583},{x:0,y:384},{x:75,y:208},{x:207,y:75},{x:383,y:0}];return t}),define("ttf/util/svg2contours",["require","math/bezierCubic2Q2","graphics/getArc"],function(require){function e(e,t){var i=[];e.forEach(function(e){i=i.concat(n(e[0],e[1],e[2],e[3]))});for(var r,o,a=0,s=i.length;s>a;a++)if(r=i[a],0===a)t.push({x:r[1].x,y:r[1].y}),t.push({x:r[2].x,y:r[2].y,onCurve:!0});else{if(o=i[a-1],o[1].x+r[1].x===2*r[0].x&&o[1].y+r[1].y===2*r[0].y)t.pop();t.push({x:r[1].x,y:r[1].y})}return t.push({x:r[2].x,y:r[2].y,onCurve:!0}),t}function t(t){for(var i,n,o,a,s,u,f,h,c,d,l,p,g,m=[],y=[],v=0,x=0,w=0,b=t.length;b>w;w++)if(i=t[w],n=i.cmd,o=i.relative,"Z"===n)m.push(y),y=[];else if("M"===n){if(o)v+=i.args[0],x+=i.args[1];else v=i.args[0],x=i.args[1];y.push({x:v,y:x,onCurve:!0})}else if("H"===n){if(o)v+=i.args[0];else v=i.args[0];y.push({x:v,y:x,onCurve:!0})}else if("V"===n){if(o)x+=i.args[0];else x=i.args[0];y.push({x:v,y:x,onCurve:!0})}else if("L"===n){if(o)u=v,f=x;else u=0,f=0;for(a=0,s=i.args.length;s>a;a+=2){if(o)u+=i.args[a],f+=i.args[a+1];else u=i.args[a],f=i.args[a+1];y.push({x:u,y:f,onCurve:!0})}v=u,x=f}else if("Q"===n){if(o)u=v,f=x;else u=0,f=0;for(a=0,s=i.args.length;s>a;a+=4)if(y.push({x:u+i.args[a],y:f+i.args[a+1]}),y.push({x:u+i.args[a+2],y:f+i.args[a+3],onCurve:!0}),o)u+=i.args[a+2],f+=i.args[a+3];else u=0,f=0;if(o)v=u,x=f;else v=i.args[s-2],x=i.args[s-1]}else if("T"===n){var S=y.pop(),M=y[y.length-1];for(y.push(M={x:2*S.x-M.x,y:2*S.y-M.y}),u=v,f=x,a=0,s=i.args.length-2;s>a;a+=2){if(o)u+=i.args[a],f+=i.args[a+1];else u=i.args[a],f=i.args[a+1];S={x:u,y:f},y.push(M={x:2*S.x-M.x,y:2*S.y-M.y})}if(o)v=u+i.args[s],x=f+i.args[s+1];else v=i.args[s],x=i.args[s+1];y.push({x:v,y:x,onCurve:!0})}else if("C"===n){if(h=[],o)u=v,f=x;else u=0,f=0;for(c={x:v,y:x},a=0,s=i.args.length;s>a;a+=6)if(l={x:u+i.args[a],y:f+i.args[a+1]},p={x:u+i.args[a+2],y:f+i.args[a+3]},d={x:u+i.args[a+4],y:f+i.args[a+5]},h.push([c,l,p,d]),c=d,o)u+=i.args[a+4],f+=i.args[a+5];else u=0,f=0;if(o)v=u,x=f;else v=i.args[s-2],x=i.args[s-1];e(h,y),g=h[h.length-1][2]}else if("S"===n){if(h=[],o)u=v,f=x;else u=0,f=0;for(c=y.pop(),l={x:2*c.x-g.x,y:2*c.y-g.y},a=0,s=i.args.length;s>a;a+=4)if(p={x:u+i.args[a],y:f+i.args[a+1]},d={x:u+i.args[a+2],y:f+i.args[a+3]},h.push([c,l,p,d]),c=d,l={x:2*c.x-p.x,y:2*c.y-p.y},o)u+=i.args[a+2],f+=i.args[a+3];else u=0,f=0;if(o)v=u,x=f;else v=i.args[s-2],x=i.args[s-1];e(h,y),g=h[h.length-1][2]}else if("A"===n){if(7!==i.args.length)throw"arc command params error:"+i.args.join(",");var C=i.args[5],E=i.args[6];if(o)C=v+C,E=x+E;var L=r(i.args[0],i.args[1],i.args[2],i.args[3],i.args[4],{x:v,y:x},{x:C,y:E});if(L&&L.length>1)for(a=1,s=L.length;s>a;a++)y.push(L[a]);v=C,x=E}return m}function i(e){if(!e||!e.length)return null;if(e=e.trim(),"M"!==e[0]&&"m"!==e[0])e="M 0 0"+e;var i=e.length-1;if("Z"!==e[i]&&"z"!==e[i])e+="Z";for(var n,r,o,a=function(e){return+e.trim()},s=[],u=!1,f=/\-?\d+(?:\.\d+)?\b/g,h=0,c=e.length;c>h;h++){var d=e[h].toUpperCase(),l=d!==e[h];switch(d){case"M":if(0===h){n=d,r=1;break}case"Q":case"T":case"C":case"S":case"H":case"V":case"L":case"A":case"Z":if("Z"===n)s.push({cmd:"Z"});else o=e.slice(r,h),s.push({cmd:n,relative:u,args:o.match(f).map(a)});n=d,u=l,r=h+1}}return s.push({cmd:"Z"}),t(s)}var n=require("math/bezierCubic2Q2"),r=require("graphics/getArc");return i}),define("ttf/svg2ttfobject",["require","common/string","./util/svg2contours","graphics/computeBoundingBox","./error"],function(require){function e(e){if(document.implementation&&document.implementation.createDocument)try{var t=new DOMParser,i=t.parseFromString(e,"text/xml");return i}catch(n){h.raise(10103)}h.raise(10004)}function t(){return{from:"svg","OS/2":{},name:{},hhea:{},head:{},post:{},glyf:[]}}function i(e){var t=1;if(e.head.unitsPerEm&&e.head.unitsPerEm<256)t=1024/e.head.unitsPerEm,e.head.unitsPerEm=1024;if(e.glyf.forEach(function(e){if(e.contours&&e.contours.length){var i=function(e){e.x=Math.round(e.x*t),e.y=Math.round(e.y*t)},n=function(e){e.forEach(i)};e.contours.forEach(n);var r=f.computePathBox.apply(null,e.contours);if(e.xMin=r.x,e.xMax=r.x+r.width,e.yMin=r.y,e.yMax=r.y+r.height,e.leftSideBearing)e.leftSideBearing=Math.round(e.leftSideBearing*t);else e.leftSideBearing=e.xMin;if(e.advanceWidth)e.advanceWidth=Math.round(e.advanceWidth*t);else e.advanceWidth=e.xMax+Math.abs(e.xMin)}}),void 0!==e.head.xMin&&void 0!==e.head.yMax)e.head.xMin=Math.round(e.head.xMin*t),e.head.xMax=Math.round(e.head.xMax*t),e.head.yMin=Math.round(e.head.yMin*t),e.head.yMax=Math.round(e.head.yMax*t);return e.head.unitsPerEm=e.head.unitsPerEm?Math.round(e.head.unitsPerEm):1024,e}function n(e,t){var i=e.getElementsByTagName("metadata")[0],n=e.getElementsByTagName("font")[0],r=e.getElementsByTagName("font-face")[0];if(i&&i.textContent)t.metadata=s.decodeHTML(i.textContent.trim());if(n)t.id=n.getAttribute("id")||"",t.hhea.advanceWidthMax=+(n.getAttribute("horiz-adv-x")||0);if(r){var o=t["OS/2"];t.name.fontFamily=r.getAttribute("font-family")||"",o.usWeightClass=+(r.getAttribute("font-weight")||0),t.head.unitsPerEm=+(r.getAttribute("units-per-em")||0);var a=(r.getAttribute("panose-1")||"").split(" ");["bFamilyType","bSerifStyle","bWeight","bProportion","bContrast","bStrokeVariation","bArmStyle","bLetterform","bMidline","bXHeight"].forEach(function(e,t){o[e]=+(a[t]||0)}),t.hhea.ascent=+(r.getAttribute("ascent")||0),t.hhea.descent=+(r.getAttribute("descent")||0),o.bXHeight=+(r.getAttribute("x-height")||0);var u=(r.getAttribute("bbox")||"").split(" ");["xMin","yMin","xMax","yMax"].forEach(function(e,i){t.head[e]=+(u[i]||"")}),t.post.underlineThickness=+(r.getAttribute("underline-thickness")||0),t.post.underlinePosition=+(r.getAttribute("underline-position")||0);var f=r.getAttribute("unicode-range");if(f)f.replace(/u\+([0-9A-Z]+)(\-[0-9A-Z]+)?/i,function(e,t,i){o.usFirstCharIndex=Number("0x"+t),o.usLastCharIndex=i?Number("0x"+i.slice(1)):4294967295})}var h=e.getElementsByTagName("svg")[0];if(!t.head.unitsPerEm&&h.getAttribute("viewBox")){var c=h.getAttribute("viewBox").split(" ");if(4===c.length)t.head.unitsPerEm=+c[2]}return t}function r(e,t){var i,n,r=e.getElementsByTagName("missing-glyph")[0];if(r){var o={name:".notdef"};if(r.getAttribute("horiz-adv-x"))o.advanceWidth=+r.getAttribute("horiz-adv-x");if(i=r.getAttribute("d"))o.contours=u(i);t.glyf.push(o)}var a=e.getElementsByTagName("glyph");if(!a.length)a=e.getElementsByTagName("path");if(a.length)for(var s=function(e){return e.charCodeAt(0)},f=0,h=a.length;h>f;f++){var c=a[f],d={name:c.getAttribute("glyph-name")||c.getAttribute("name")||""};if(c.getAttribute("horiz-adv-x"))d.advanceWidth=+c.getAttribute("horiz-adv-x");if(n=c.getAttribute("unicode"))d.unicode=n.split("").map(s);if(i=c.getAttribute("d"))d.contours=u(i);t.glyf.push(d)}return t}function o(e){var i=t();if(!e.getElementsByTagName("svg").length)h.raise(10106);if(n(e,i),r(e,i),!i.glyf.length)h.raise(10201);return i}function a(t){var n=t;if("string"==typeof t)n=e(t);var r=o(n);return i(r)}var s=require("common/string"),u=require("./util/svg2contours"),f=require("graphics/computeBoundingBox"),h=require("./error");return a}),define("fonteditor/widget/loader",["require","ttf/ttfreader","ttf/woff2ttf","ttf/eot2ttf","ttf/svg2ttfobject","inflate","./loading"],function(require){function e(e,t){f.show();var i=new FileReader;i.onload=function(e){try{var n=e.target.result;if("woff"===t.type)n=o(n,h);else if("eot"===t.type)n=a(n,h);var s=new r,u=s.read(n);s.dispose(),i=null,t.success&&t.success(u)}catch(c){throw alert(c.message),c}f.hide()},i.onerror=function(e){f.hide(),i=null,alert("读取文件出错!"),t.error&&t.error(e)},i.readAsArrayBuffer(e)}function t(e,t){f.show();try{if("woff"===t.type)e=o(e,h);else if("eot"===t.type)e=a(e,h);var i=new r,n=i.read(e);i.dispose(),t.success&&t.success(n)}catch(s){throw alert(s.message),s}f.hide()}function i(e,t){f.show();var i=new FileReader;i.onload=function(e){try{var n=e.target.result,r=s(n);i=null,t.success&&t.success(r)}catch(o){throw alert(o.message),o}f.hide()},i.onerror=function(e){f.hide(),i=null,alert("读取文件出错!"),t.error&&t.error(e)},i.readAsText(e)}function n(e,t){f.show();try{var i=s(e);f.hide(),t.success&&t.success(i)}catch(n){throw f.hide(),alert(n.message),n}}var r=require("ttf/ttfreader"),o=require("ttf/woff2ttf"),a=require("ttf/eot2ttf"),s=require("ttf/svg2ttfobject"),u=require("inflate"),f=require("./loading"),h={inflate:u.inflate},c={load:function(r,o){if("svg"===o.type)if("string"==typeof r||r instanceof window.XMLDocument)n(r,o);else i(r,o);else if("ttf"===o.type||"woff"===o.type||"eot"===o.type)if(r instanceof ArrayBuffer)t(r,o);else e(r,o);else o.error&&o.error({message:"不支持的文件类型"})},supportLoad:function(e){return!!e.match(/(\.ttf|\.woff|\.eot)$/i)},supportImport:function(e){return!!e.match(/(\.ttf|\.woff|\.svg|\.eot)$/i)}};return c}),define("ttf/util/checkSum",["require"],function(){function e(e,t,i){if(t=t||0,i=i||e.byteLength,t+i>e.byteLength)throw"check sum out of bound";for(var n=Math.floor(i/4),r=new DataView(e,t,i),o=0,a=0;n>a;)o+=r.getUint32(4*a++,!1);var s=i-4*n;if(s)for(t=4*n;s>0;)o+=r.getUint8(t,!1)<<8*s,t++,s--;return o%4294967296}function t(e,t,i){if(t=t||0,i=i||e.length,t+i>e.length)throw"check sum out of bound";for(var n=Math.floor(i/4),r=0,o=0;n>o;)r+=(e[o++]<<24)+(e[o++]<<16)+(e[o++]<<8)+e[o++];var a=i-4*n;if(a)for(t=4*n;a>0;)r+=e[t]<<8*a,t++,a--;return r%4294967296}function i(i,n,r){if(i instanceof ArrayBuffer)return e(i,n,r);else if(i instanceof Array)return t(i,n,r);throw"not support checksum buffer type"}return i}),define("ttf/util/reduceGlyf",["require","graphics/reducePath"],function(require){function e(e){for(var i,n,r=e.contours,o=r.length-1;o>=0;o--)if(i=r[o],t(i),n=i.length,0!==n&&2!==n);else r.splice(o,1);if(0===e.contours.length)delete e.contours;return e}var t=require("graphics/reducePath");return e}),define("ttf/ttfwriter",["require","./writer","./table/directory","./table/support","./util/checkSum","./error","./util/reduceGlyf","graphics/pathCeil"],function(require){function e(e){if(e.version=e.version||1,e.numTables=h.length,e.entrySelector=Math.floor(Math.log(h.length)/Math.LN2),e.searchRange=16*Math.pow(2,e.entrySelector),e.rangeShift=16*h.length-e.searchRange,e.head.checkSumAdjustment=0,e.head.magickNumber=1594834165,"string"==typeof e.head.created)e.head.created=/^\d+$/.test(e.head.created)?+e.head.created:Date.parse(e.head.created);if(e.head.modified=Date.now(),!e.glyf||0===e.glyf.length)s.raise(10201);var t={};e.glyf.forEach(function(e,i){if(e.unicode)e.unicode=e.unicode.sort(),e.unicode.forEach(function(e){if(t[e])s.raise(10200,i);else t[e]=!0});if(!e.compound&&e.contours)e.contours.forEach(function(e){f(e)}),u(e);e.xMin=Math.round(e.xMin||0),e.xMax=Math.round(e.xMax||0),e.yMin=Math.round(e.yMin||0),e.yMax=Math.round(e.yMax||0),e.leftSideBearing=Math.round(e.leftSideBearing||0),e.advanceWidth=Math.round(e.advanceWidth||0)})}function t(e){e.support={};var t=12+16*h.length,i=0;e.support.tables=[],h.forEach(function(n){var r=t,a=(new o[n]).size(e),s=a;if("head"===n)i=r;if(s%4)s+=4-s%4;e.support.tables.push({name:n,checkSum:0,offset:r,length:a,size:s}),t+=s});var s=new n(new ArrayBuffer(t));s.writeFixed(e.version),s.writeUint16(e.numTables),s.writeUint16(e.searchRange),s.writeUint16(e.entrySelector),s.writeUint16(e.rangeShift),!(new r).write(s,e),e.support.tables.forEach(function(t){var i=s.offset;if(!(new o[t.name]).write(s,e),t.length%4)s.writeEmpty(4-t.length%4);t.checkSum=a(s.getBuffer(),i,t.size)}),e.support.tables.forEach(function(e,t){var i=12+16*t+4;s.writeUint32(e.checkSum,i)});var u=(2981146554-a(s.getBuffer())+4294967296)%4294967296;s.writeUint32(u,i+8),delete e.support;var f=s.getBuffer();return s.dispose(),f}function i(){}var n=require("./writer"),r=require("./table/directory"),o=require("./table/support"),a=require("./util/checkSum"),s=require("./error"),u=require("./util/reduceGlyf"),f=require("graphics/pathCeil"),h=["OS/2","cmap","glyf","head","hhea","hmtx","loca","maxp","name","post"];return i.prototype.write=function(i){e.call(this,i);var n=t.call(this,i);return n},i.prototype.dispose=function(){},i}),define("ttf/ttf2woff",["require","./reader","./writer","common/string","./error","./util/string"],function(require){function e(e){var t='<?xml version="1.0" encoding="UTF-8"?><metadata version="1.0">';if(e.uniqueid=e.uniqueid||"fonteditor."+Date.now(),t+='<uniqueid id="'+r.encodeHTML(e.uniqueid)+'" />',e.vendor)t+='<vendor name="'+r.encodeHTML(e.vendor.name)+'" url="'+r.encodeHTML(e.vendor.url)+'" />';if(e.credit){t+="<credits>";var i=e.credit instanceof Array?e.credit:[e.credit];i.forEach(function(e){t+='<credit name="'+r.encodeHTML(e.name)+'" url="'+r.encodeHTML(e.url)+'" role="'+r.encodeHTML(e.role||"Contributor")+'" />'}),t+="</credits>"}if(e.description)t+='<description><text xml:lang="en">'+r.encodeHTML(e.description)+"</text></description>";if(e.license)t+='<license url="'+r.encodeHTML(e.license.url)+'" id="'+r.encodeHTML(e.license.id)+'"><text xml:lang="en">',t+=r.encodeHTML(e.license.text),t+="</text></license>";if(e.copyright)t+='<copyright><text xml:lang="en">',t+=r.encodeHTML(e.copyright),t+="</text></copyright>";if(e.trademark)t+='<trademark><text xml:lang="en">'+r.encodeHTML(e.trademark)+"</text></trademark>";if(e.licensee)t+='<licensee name="'+r.encodeHTML(e.licensee)+'"/>';return t+="</metadata>"}function t(t,r){r=r||{};var a,s,u,f,h={signature:2001684038,flavor:65536,length:0,numTables:0,reserved:0,totalSfntSize:0,majorVersion:0,minorVersion:0,metaOffset:0,metaLength:0,metaOrigLength:0,privOffset:0,privLength:0},c=new i(t),d=[],l=c.readUint16(4);if(0>=l||l>100)o.raise(10101);for(c.seek(12),u=0;l>u;++u){a={tag:c.readString(c.offset,4),checkSum:c.readUint32(),offset:c.readUint32(),length:c.readUint32()};var p=c.offset;if("head"===a.tag)h.majorVersion=c.readUint16(a.offset+4),h.minorVersion=c.readUint16(a.offset+6);var g=c.readBytes(a.offset,a.length);if(r.deflate)if(s=r.deflate(g),s.length<g.length)a.data=s,a.deflated=!0;else a.data=g;else a.data=g;a.compLength=a.data.length,d.push(a),c.seek(p)}if(!d.length)o.raise(10204);d=d.sort(function(e,t){return e.tag===t.tag?0:e.tag<t.tag?-1:1});var m=44+20*l,y=12+16*l;for(u=0,f=d.length;f>u;++u)a=d[u],a.offset=m,m+=a.compLength+(a.compLength%4?4-a.compLength%4:0),y+=a.length+(a.length%4?4-a.length%4:0);var v=null;if(r.metadata){var x=require("./util/string").toUTF8Bytes(e(r.metadata));if(r.deflate)if(s=r.deflate(x),s.length<x.length)v=s;else v=x;else v=x;h.metaLength=v.length,h.metaOrigLength=x.length,h.metaOffset=m,m+=h.metaLength+(h.metaLength%4?4-h.metaLength%4:0)}h.numTables=d.length,h.length=m,h.totalSfntSize=y;var w=new n(new ArrayBuffer(m));for(w.writeUint32(h.signature),w.writeUint32(h.flavor),w.writeUint32(h.length),w.writeUint16(h.numTables),w.writeUint16(h.reserved),w.writeUint32(h.totalSfntSize),w.writeUint16(h.majorVersion),w.writeUint16(h.minorVersion),w.writeUint32(h.metaOffset),w.writeUint32(h.metaLength),w.writeUint32(h.metaOrigLength),w.writeUint32(h.privOffset),w.writeUint32(h.privLength),u=0,f=d.length;f>u;++u)a=d[u],w.writeString(a.tag),w.writeUint32(a.offset),w.writeUint32(a.compLength),w.writeUint32(a.length),w.writeUint32(a.checkSum);for(u=0,f=d.length;f>u;++u)if(a=d[u],w.writeBytes(a.data),a.compLength%4)w.writeEmpty(4-a.compLength%4);if(v)if(w.writeBytes(v),h.metaLength%4)w.writeEmpty(4-h.metaLength%4);return w.getBuffer()}var i=require("./reader"),n=require("./writer"),r=require("common/string"),o=require("./error");return t}),define("ttf/ttf2eot",["require","./reader","./writer","./util/string","./error","./table/table","./table/struct","./table/name"],function(require){function e(e,o){o=o||{};var a=new u,f=a.size(),h={};h.head=a.read(new t(new ArrayBuffer(f))),h.head.FontDataSize=e.byteLength||e.length,h.head.Version=131073,h.head.Flags=0,h.head.Charset=1,h.head.MagicNumber=20556,h.head.Padding1=0;var c=new t(e),d=c.readUint16(4);if(0>=d||d>100)r.raise(10101);c.seek(12);for(var l=0,p=0;d>p&&7!==l;++p){var g={tag:c.readString(c.offset,4),checkSum:c.readUint32(),offset:c.readUint32(),length:c.readUint32()},m=c.offset;if("head"===g.tag)h.head.CheckSumAdjustment=c.readUint32(g.offset+8),l+=1;else if("OS/2"===g.tag)h.head.PANOSE=c.readBytes(g.offset+32,10),h.head.Italic=c.readUint16(g.offset+62),h.head.Weight=c.readUint16(g.offset+4),h.head.fsType=c.readUint16(g.offset+8),h.head.UnicodeRange=c.readBytes(g.offset+42,16),h.head.CodePageRange=c.readBytes(g.offset+78,8),l+=2;else if("name"===g.tag){var y=new s(g.offset).read(c);h.FamilyName=n.toUCS2Bytes(y.fontFamily||""),h.FamilyNameSize=h.FamilyName.length,h.StyleName=n.toUCS2Bytes(y.fontStyle||""),h.StyleNameSize=h.StyleName.length,h.VersionName=n.toUCS2Bytes(y.version||""),h.VersionNameSize=h.VersionName.length,h.FullName=n.toUCS2Bytes(y.fullName||""),h.FullNameSize=h.FullName.length,l+=3}c.seek(m)}h.head.EOTSize=f+4+h.FamilyNameSize+4+h.StyleNameSize+4+h.VersionNameSize+4+h.FullNameSize+2+h.head.FontDataSize;var v=new i(new ArrayBuffer(h.head.EOTSize),0,h.head.EOTSize,!0);return a.write(v,h),v.writeUint16(h.FamilyNameSize),v.writeBytes(h.FamilyName,h.FamilyNameSize),v.writeUint16(0),v.writeUint16(h.StyleNameSize),v.writeBytes(h.StyleName,h.StyleNameSize),v.writeUint16(0),v.writeUint16(h.VersionNameSize),v.writeBytes(h.VersionName,h.VersionNameSize),v.writeUint16(0),v.writeUint16(h.FullNameSize),v.writeBytes(h.FullName,h.FullNameSize),v.writeUint16(0),v.writeUint16(0),v.writeBytes(e,h.head.FontDataSize),v.getBuffer()}var t=require("./reader"),i=require("./writer"),n=require("./util/string"),r=require("./error"),o=require("./table/table"),a=require("./table/struct"),s=require("./table/name"),u=o.create("head",[["EOTSize",a.Uint32],["FontDataSize",a.Uint32],["Version",a.Uint32],["Flags",a.Uint32],["PANOSE",a.Bytes,10],["Charset",a.Uint8],["Italic",a.Uint8],["Weight",a.Uint32],["fsType",a.Uint16],["MagicNumber",a.Uint16],["UnicodeRange",a.Bytes,16],["CodePageRange",a.Bytes,8],["CheckSumAdjustment",a.Uint32],["Reserved",a.Bytes,16],["Padding1",a.Uint16]]);return e}),define("ttf/util/unicode2xml",["require","common/string"],function(require){function e(e){if("number"==typeof e)e=[e];return e.map(function(e){if(32>e)return"";else return e>=32&&255>=e?t.encodeHTML(String.fromCharCode(e).toLowerCase()):"&#x"+e.toString(16)+";"}).join("")}var t=require("common/string");return e}),define("ttf/ttf2svg",["require","common/string","./ttfreader","./util/contours2svg","./util/unicode2xml","./error"],function(require){function e(e,t){var n=e["OS/2"],a={id:s,metadata:i.encodeHTML(t.metadata||""),advanceWidth:e.hhea.advanceWidthMax,fontFamily:e.name.fontFamily,fontWeight:n.usWeightClass,unitsPerEm:e.head.unitsPerEm,panose:[n.bFamilyType,n.bSerifStyle,n.bWeight,n.bProportion,n.bContrast,n.bStrokeVariation,n.bArmStyle,n.bLetterform,n.bMidline,n.bXHeight].join(" "),ascent:e.hhea.ascent,descent:e.hhea.descent,xHeight:n.bXHeight,bbox:[e.head.xMin,e.head.yMin,e.head.xMax,e.head.yMax].join(" "),underlineThickness:e.post.underlineThickness,underlinePosition:e.post.underlinePosition,unicodeRange:"U+"+i.pad(n.usFirstCharIndex.toString(16),4)+"-"+i.pad(n.usLastCharIndex.toString(16),4)};a.missing={},a.missing.advanceWidth=e.glyf[0].advanceWidth||0,a.missing.d=e.glyf[0].contours&&e.glyf[0].contours.length?'d="'+r(e.glyf[0].contours)+'"':"";for(var h="",c=1,d=e.glyf.length;d>c;c++){var l=e.glyf[c];if(!l.compound&&l.contours&&l.unicode&&l.unicode.length){var p={name:l.name,unicode:o(l.unicode),d:r(l.contours)};h+=i.format(f,p)}}return a.glyphList=h,i.format(u,a)}function t(t,i){if(i=i||{},t instanceof ArrayBuffer){var r=new n,o=r.read(t);return r.dispose(),e(o,i)}else if(t.version&&t.glyf)return e(t,i);a.raise(10109)}var i=require("common/string"),n=require("./ttfreader"),r=require("./util/contours2svg"),o=require("./util/unicode2xml"),a=require("./error"),s="fonteditor",u='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" ><svg xmlns="http://www.w3.org/2000/svg"><metadata>${metadata}</metadata><defs><font id="${id}" horiz-adv-x="${advanceWidth}"><font-face font-family="${fontFamily}" font-weight="${fontWeight}" font-stretch="normal" units-per-em="${unitsPerEm}" panose-1="${panose}" ascent="${ascent}" descent="${descent}" x-height="${xHeight}" bbox="${bbox}" underline-thickness="${underlineThickness}" underline-position="${underlinePosition}" unicode-range="${unicodeRange}" /><missing-glyph horiz-adv-x="${missing.advanceWidth}" ${missing.d} />${glyphList}</font></defs></svg>',f='<glyph glyph-name="${name}" unicode="${unicode}" d="${d}" />';return t}),define("ttf/util/bytes2base64",["require"],function(){function e(e){var t,i,n="";if(e instanceof ArrayBuffer){t=e.byteLength;var r=new DataView(e,0,t);for(i=0;t>i;i++)n+=String.fromCharCode(r.getUint8(i,!1))}else if(e instanceof Array)for(t=e.length,i=0;t>i;i++)n+=String.fromCharCode(e[i]);return btoa(n)}return e}),define("fonteditor/widget/exporter",["require","ttf/ttfwriter","ttf/ttf2woff","ttf/ttf2eot","ttf/ttf2svg","ttf/util/bytes2base64","deflate","JSZip"],function(require){function e(e,t){var a=null;if("woff"===t.type)a=n((new i).write(e),s);else if("eot"===t.type)a=r((new i).write(e));else if("svg"===t.type)a=o(e);else a=(new i).write(e),t.type="ttf";return a}function t(t,i){if(t)try{var n="",r=i.fileName||t.name.fontFamily||"export";if("zip"===i.type){var o=new u,s=o.folder("fonteditor");["woff","eot","svg","ttf"].forEach(function(i){s.file(r+"."+i,e(t,{type:i}))}),n="data:application/zip;base64,"+o.generate({type:"base64"})}else{var f=e(t,i);if("svg"===i.type)n=btoa(f);else n=a(f);n="data:font/"+i.type+";charset=utf-8;base64,"+n}var h=$(i.target);if(h.attr("download",r+"."+i.type),h.attr("href",n),i.success)i.success(n)}catch(c){if($(i.target).removeAttr("download"),alert(c.message),i.error)i.error(c)}return i.target}var i=require("ttf/ttfwriter"),n=require("ttf/ttf2woff"),r=require("ttf/ttf2eot"),o=require("ttf/ttf2svg"),a=require("ttf/util/bytes2base64"),s=require("deflate"),u=require("JSZip"),f={"export":t};return f}),define("ttf/ttf2base64",["require","./util/bytes2base64"],function(require){function e(e){return"data:font/ttf;charset=utf-8;base64,"+t(e)}var t=require("./util/bytes2base64");return e}),define("ttf/woff2base64",["require","./util/bytes2base64"],function(require){function e(e){return"data:font/woff;charset=utf-8;base64,"+t(e)}var t=require("./util/bytes2base64");return e}),define("ttf/eot2base64",["require","./util/bytes2base64"],function(require){function e(e){return"data:font/eot;charset=utf-8;base64,"+t(e)}var t=require("./util/bytes2base64");return e}),define("ttf/svg2base64",["require"],function(){function e(e){return"data:font/svg;charset=utf-8;base64,"+btoa(e)}return e}),define("fonteditor/widget/previewer",["require","ttf/ttfwriter","ttf/ttf2woff","ttf/ttf2eot","ttf/ttf2svg","ttf/ttf2base64","ttf/woff2base64","ttf/eot2base64","ttf/svg2base64","utpl"],function(require){function e(e){return e.map(function(e){return"\\"+e.toString(16)}).join(",")}function t(t,h){h=!h||"ttf"===h?"truetype":h;var d,l="",p=t.name.fontFamily||"fonteditor",g=[];if("woff"===h)d=(new i).write(t),l=s(n(d));else if("eot"===h)d=(new i).write(t),l=u(r(d));else if("svg"===h)l=f(o(t));else d=(new i).write(t),l=a(d);var m=t.glyf.filter(function(e){return".notdef"!==e.name&&".null"!==e.name&&"nonmarkingreturn"!==e.name&&e.unicode&&e.unicode.length});return m.forEach(function(t){g.push({code:"&#x"+t.unicode[0].toString(16)+";",codeName:e(t.unicode),name:t.name})}),c({fontData:l,fontFormat:h,fontFamily:p,glyfList:g})}var i=require("ttf/ttfwriter"),n=require("ttf/ttf2woff"),r=require("ttf/ttf2eot"),o=require("ttf/ttf2svg"),a=require("ttf/ttf2base64"),s=require("ttf/woff2base64"),u=require("ttf/eot2base64"),f=require("ttf/svg2base64"),h=require("utpl"),c=null,d=!!window.ActiveXObject||"ActiveXObject"in window,l={init:function(){if(!c)$.get("./template/preview-ttf.html",function(e){c=h.template(e)})},load:function(e,i){try{var n=t(e,i),r=window.open("./empty.html");if(d&&r.document&&r.document.body)r.document.body.innerHTML=n,r.focus();else r.onload=function(){r.document.body.innerHTML=n,r.focus(),r=null,n=null}}catch(o){alert(o.message)}}};return l.init(),l}),define("fonteditor/main",["require","./widget/glyfviewer","./widget/glyfeditor","./widget/projectviewer","./widget/ttfmanager","./widget/program","./widget/commandmenu","./widget/pager","./controller/default","./controller/actions","./widget/settingmanager","./menu/viewer","./menu/editor","./widget/project","./widget/loader","./widget/exporter","./widget/previewer"],function(require){function e(e){var t=e.target.files[0];if("open"===a.data.action&&a.loader.supportLoad(t.name))a.loader.load(t,{type:t.name.slice(t.name.lastIndexOf(".")+1).toLowerCase(),success:function(e){a.viewer.clearSelected(),a.ttfManager.set(e),a.data.projectId=null}});else if("import"===a.data.action&&a.loader.supportImport(t.name)){if(a.ttfManager.get()){var i=t.name.slice(t.name.lastIndexOf(".")+1).toLowerCase(),n=new RegExp("."+i+"$","i"),r=Array.prototype.slice.call(e.target.files).filter(function(e){return n.test(e.name)});r.forEach(function(e){a.loader.load(e,{type:i,success:function(e){if(e.glyf.length)a.ttfManager.merge(e,{scale:!0})}})})}}else alert("无法识别文件类型!");e.target.value=""}function t(){$(".action-groups").delegate("[data-action]","click",function(e){var t=$(this).attr("data-action");if(h[t])a.data.action=t,h[t].call(this,e)}),$("#export-btn").on("mouseup",h["export-file"]),$("#export-btn-woff").on("mouseup",h["export-file"]),$("#export-btn-svg").on("mouseup",h["export-file"]),$("#export-btn-eot").on("mouseup",h["export-file"]),$("#export-btn-zip").on("mouseup",h["export-file"]),document.getElementById("font-import").addEventListener("change",e)}var i=require("./widget/glyfviewer"),n=require("./widget/glyfeditor"),r=require("./widget/projectviewer"),o=require("./widget/ttfmanager"),a=require("./widget/program"),s=require("./widget/commandmenu"),u=require("./widget/pager"),f=require("./controller/default"),h=require("./controller/actions"),c={init:function(){if(t(),location.hostname.indexOf("baidu.com")>-1)a.fontUrl="/getfont?url=${0}";
a.setting=require("./widget/settingmanager");var e=new s($("#glyf-list-commandmenu"),{commands:require("./menu/viewer")});a.viewerPager=new u($("#glyf-list-pager")),a.viewer=new i($("#glyf-list"),{commandMenu:e});var h=new s($("#editor-commandmenu"),{commands:require("./menu/editor")});if(a.editor=new n($("#glyf-editor"),{commandMenu:h}),a.project=require("./widget/project"),a.projectViewer=new r($("#project-list")),a.ttfManager=new o,a.loader=require("./widget/loader"),a.exporter=require("./widget/exporter"),a.previewer=require("./widget/previewer"),f.init(a),a.projectViewer.show(a.project.items()),a.setting.isStored("editor")){var c=a.setting.get("editor");a.viewer.setSetting(c.viewer),a.editor.setSetting(c.editor)}}};return c.init(),c});